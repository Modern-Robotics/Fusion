var _0x25ef=['c3online.edu','c3online.edu/backend','https://10.200.200.1','virtual.c3edu.online','otherdemokey','./../../../config/serial','serialId','info','Current\x20network:\x20','wifi','ssid','./../sockets/','connected','status','wifiInterface','Error\x20accessing\x20wifi\x20dongle','Wifi\x20dongle\x20found','globalUrl','message','partOfCommunity','Fusion\x20is\x20part\x20of\x20community','Fusion\x20not\x20part\x20of\x20this\x20community','Could\x20not\x20access\x20classroom\x20environment','Connecting\x20to\x20hidden\x20network','Connecting\x20to\x20classroom\x20network','POST','http://localhost:8080/api/admin/wirelessConnections','serverMessage','Can\x20reach\x20community','Community\x20unreachable','winston','request-promise','wireless-tools/wpa_cli','config'];(function(_0x878c8d,_0x4e0694){var _0x426be3=function(_0x476070){while(--_0x476070){_0x878c8d['push'](_0x878c8d['shift']());}};_0x426be3(++_0x4e0694);}(_0x25ef,0x1b6));var _0x5ca9=function(_0x574cb9,_0x3a4f7d){_0x574cb9=_0x574cb9-0x0;var _0x451ca9=_0x25ef[_0x574cb9];return _0x451ca9;};const winston=require(_0x5ca9('0x0'));const rp=require(_0x5ca9('0x1'));const wpa_cli=require(_0x5ca9('0x2'));const config=require(_0x5ca9('0x3'));const settings={'wifiInterface':config['get']('Wifi_NIC')};const classroomConnection={'url':_0x5ca9('0x4'),'classroomBackend':_0x5ca9('0x5'),'classroomAPI':'c3online.edu:8443','globalUrl':_0x5ca9('0x6'),'connected':![],'hiddenSSID':_0x5ca9('0x7'),'hiddenPassword':_0x5ca9('0x8')};classroomConnection['attemptConnection']=function(){return new Promise(async function(_0x56aec8,_0x22f5ff){try{const _0x24d063=await require(_0x5ca9('0x9'));const _0x5447a2=_0x24d063[_0x5ca9('0xa')];await checkHasWirelessDongle();let _0x346b73=await communityReachable();if(!_0x346b73)await connectToHiddenClassroomNetwork();let _0xfea328=await determineCommunityAccess(_0x5447a2);if(_0xfea328['partOfCommunity']){let _0x439be5=await getConnectedNetworkName();winston[_0x5ca9('0xb')](_0x5ca9('0xc')+_0x439be5);if(_0x439be5!=_0xfea328[_0x5ca9('0xd')]['ssid'])await connectToClassroomNetwork(_0xfea328['wifi'][_0x5ca9('0xe')],_0xfea328[_0x5ca9('0xd')]['passphrase']);await updateIPAddress(_0x5447a2);await require(_0x5ca9('0xf'));classroomConnection[_0x5ca9('0x10')]=!![];}return _0x56aec8();}catch(_0xfb6f16){winston[_0x5ca9('0xb')](_0xfb6f16);return _0x56aec8();}});};function checkHasWirelessDongle(){return new Promise(function(_0x341b16,_0x50e8a2){wpa_cli[_0x5ca9('0x11')](settings[_0x5ca9('0x12')],function(_0x3ff124,_0x541c1e){if(_0x3ff124){return _0x50e8a2(_0x5ca9('0x13'));}winston['info']('Wireless\x20dongle\x20detected');return _0x341b16(_0x5ca9('0x14'));});});};function determineCommunityAccess(_0x2c6c59){return new Promise(async function(_0x21d6b5,_0x29a31d){let _0x3fe364={'uri':classroomConnection[_0x5ca9('0x15')]+':8443/api/v1/connect/'+_0x2c6c59,'rejectUnauthorized':![],'json':!![],'timeout':0x7d0};try{let _0x24db48=await rp(_0x3fe364);if(_0x24db48[_0x5ca9('0x16')]!='Fusion\x20not\x20part\x20of\x20community'){_0x24db48[_0x5ca9('0x17')]=!![];winston[_0x5ca9('0xb')](_0x5ca9('0x18'));}else{_0x24db48[_0x5ca9('0x17')]=![];winston[_0x5ca9('0xb')](_0x5ca9('0x19'));}return _0x21d6b5(_0x24db48);}catch(_0x208610){return _0x29a31d(_0x5ca9('0x1a'));}});};function connectToHiddenClassroomNetwork(){return new Promise(async function(_0x2401bc,_0x273121){try{winston[_0x5ca9('0xb')](_0x5ca9('0x1b'));let _0x2c90b8={'method':'POST','uri':'http://localhost:8080/api/admin/wirelessConnections','body':{'ssid':classroomConnection['hiddenSSID'],'password':classroomConnection['hiddenPassword'],'hiddenNetwork':!![]},'json':!![]};let _0xdfb44d=await rp(_0x2c90b8);winston[_0x5ca9('0xb')](_0xdfb44d['serverMessage']);return _0x2401bc(_0xdfb44d);}catch(_0x28e40a){winston[_0x5ca9('0xb')]('Error\x20connecting\x20to\x20hidden\x20network');winston[_0x5ca9('0xb')](_0x28e40a);return _0x273121(_0x28e40a);}});};function connectToClassroomNetwork(_0x5a6e3c,_0x448d14){return new Promise(async function(_0x5315ee,_0x1f9a8b){try{winston[_0x5ca9('0xb')](_0x5ca9('0x1c'));let _0x4af526={'method':_0x5ca9('0x1d'),'uri':_0x5ca9('0x1e'),'body':{'ssid':_0x5a6e3c,'password':_0x448d14},'json':!![]};let _0x504e10=await rp(_0x4af526);winston[_0x5ca9('0xb')](_0x504e10[_0x5ca9('0x1f')]);return _0x5315ee(_0x504e10);}catch(_0x1f2a5c){winston['info']('Error\x20connecting\x20to\x20classroom\x20network');winston['info'](_0x1f2a5c);return _0x1f9a8b(_0x1f2a5c);}});};function getConnectedNetworkName(){return new Promise(function(_0x317551,_0x21e16d){wpa_cli[_0x5ca9('0x11')](settings[_0x5ca9('0x12')],function(_0x5dc586,_0x2ade60){if(_0x5dc586)return _0x21e16d(_0x5dc586);return _0x317551(_0x2ade60[_0x5ca9('0xe')]);});});};function updateIPAddress(_0x5a3ab2){return new Promise(async function(_0x19e676,_0x3e414e){try{let _0x55881e={'uri':classroomConnection[_0x5ca9('0x15')]+':8443/api/v1/connect/'+_0x5a3ab2,'rejectUnauthorized':![],'json':!![]};await rp(_0x55881e);return _0x19e676();}catch(_0x8c1f9d){return _0x3e414e(_0x8c1f9d);}});};function communityReachable(){return new Promise(async function(_0x543fc2,_0x45ecb2){try{let _0x1dc133={'uri':classroomConnection[_0x5ca9('0x15')],'rejectUnauthorized':![],'json':!![],'timeout':0x7d0};await rp(_0x1dc133);winston[_0x5ca9('0xb')](_0x5ca9('0x20'));return _0x543fc2(!![]);}catch(_0x2d8cc9){winston[_0x5ca9('0xb')](_0x5ca9('0x21'));return _0x543fc2(![]);}});};module['exports']=classroomConnection;