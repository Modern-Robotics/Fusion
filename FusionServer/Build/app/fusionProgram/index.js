const _0x59df=['SocketVariables','program-running','sockets','Blockly\x20Program\x20is\x20now\x20running','close','imp.load_source(\x27util\x27,\x20r\x27','kill','fusion_gamepad_available','User','SocketId','stdout','path','import\x20os\x0a','KillProgram','../socket','StopProgram','autonomous','SIGINT','lastIndexOf','Cannot\x20stop\x20another\x20user\x27s\x20program.','gamepad-available','stderr','substring','/Editor\x27)\x0a','emit','>\x20Program\x20Finished!\x0a','stdin','python','sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN','No\x20program\x20running','Program\x20is\x20now\x20running','blockly-console-output','pipe','win32','console-output','shelljs','verbose','data','os.chdir(\x27./app/filesystem/','>\x20Program\x20Finished!','exec','sendInput','fusion_program_running','Program\x20already\x20running','Cannot\x20stop\x20another\x20user\x20program','exports','import\x20imp\x0a','resolve','platform'];(function(_0x9d6eeb,_0x59dfad){const _0x3cb8bf=function(_0x59228a){while(--_0x59228a){_0x9d6eeb['push'](_0x9d6eeb['shift']());}};_0x3cb8bf(++_0x59dfad);}(_0x59df,0x8d));const _0x3cb8=function(_0x9d6eeb,_0x59dfad){_0x9d6eeb=_0x9d6eeb-0x0;let _0x3cb8bf=_0x59df[_0x9d6eeb];return _0x3cb8bf;};const logger=require('../utils/logger');const io=require(_0x3cb8('0x14'));const FusionSettings=require('../global/fusionSettings');const spawn=require('child_process')['spawn'];const shell=require(_0x3cb8('0x29'));const os=require('os');const path=require(_0x3cb8('0x11'));let python_process=null;module[_0x3cb8('0x2')]=function(){var _0x4890e8=function(){};_0x4890e8['StartProgram']=function(_0x47ccef,_0x254ad4,_0x341512){if(!FusionSettings['SocketVariables']['fusion_program_running']){FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]={'Code':null,'Program':_0x254ad4,'SocketId':_0x341512,'User':_0x47ccef};_0x15304a(_0x254ad4,_0x47ccef);logger[_0x3cb8('0x2a')](_0x3cb8('0x24'));return{'status':0xc8,'message':'Program\x20is\x20now\x20running'};}else{if(FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')][_0x3cb8('0xe')]==_0x47ccef||FusionSettings['SocketVariables'][_0x3cb8('0x30')]['SocketId']=='autonomous'){try{python_process[_0x3cb8('0xc')]('SIGINT');}catch(_0x1ec826){}FusionSettings['SocketVariables'][_0x3cb8('0x30')]={'Code':null,'Program':_0x254ad4,'SocketId':_0x341512,'User':_0x47ccef};_0x15304a(_0x254ad4,_0x47ccef);logger[_0x3cb8('0x2a')](_0x3cb8('0x24'));return{'status':0xc8,'message':_0x3cb8('0x24')};}else{logger[_0x3cb8('0x2a')](_0x3cb8('0x0'));return{'status':0x1f4,'message':_0x3cb8('0x0')};}}};_0x4890e8[_0x3cb8('0x15')]=function(_0x48aa2c){if(FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]){if(FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')][_0x3cb8('0xe')]==_0x48aa2c||FusionSettings['SocketVariables']['fusion_program_running']['SocketId']==_0x3cb8('0x16')){FusionSettings['SocketVariables'][_0x3cb8('0x30')]=null;try{python_process[_0x3cb8('0xc')](_0x3cb8('0x17'));}catch(_0xe68de1){}logger['verbose']('Program\x20is\x20now\x20stopped');return{'status':0xc8,'message':'Program\x20Successfully\x20Stopped'};}else{logger['verbose'](_0x3cb8('0x1'));return{'status':0x1f4,'message':_0x3cb8('0x19')};}}else{logger['verbose'](_0x3cb8('0x23'));return{'status':0x1f4,'message':'No\x20Program\x20Running'};}};_0x4890e8[_0x3cb8('0x13')]=function(){FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]=null;try{python_process[_0x3cb8('0xc')](_0x3cb8('0x17'));}catch(_0x1a8d40){}logger[_0x3cb8('0x2a')]('Program\x20is\x20now\x20stopped');};_0x4890e8['StartBlocklyProgram']=function(_0x353926,_0xb55c2f,_0x59f3bf){if(!FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]){FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]={'Code':_0x353926,'Program':null,'SocketId':_0x59f3bf,'User':_0xb55c2f};_0x257575(_0x353926,_0xb55c2f);logger['verbose'](_0x3cb8('0x9'));return{'status':0xc8,'message':_0x3cb8('0x9')};}else{if(FusionSettings['SocketVariables'][_0x3cb8('0x30')]['User']==_0xb55c2f||FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')][_0x3cb8('0xf')]==_0x3cb8('0x16')){try{python_process[_0x3cb8('0xc')](_0x3cb8('0x17'));}catch(_0x25482d){}FusionSettings[_0x3cb8('0x6')]['fusion_program_running']={'Code':_0x353926,'Program':null,'SocketId':_0x59f3bf,'User':_0xb55c2f};_0x257575(_0x353926,_0xb55c2f);logger[_0x3cb8('0x2a')]('Blockly\x20Program\x20is\x20now\x20running');return{'status':0xc8,'message':'Blockly\x20Program\x20is\x20now\x20running'};}else{logger[_0x3cb8('0x2a')](_0x3cb8('0x0'));return{'status':0x1f4,'message':_0x3cb8('0x0')};}}};_0x4890e8[_0x3cb8('0x2f')]=function(_0x42f769){python_process[_0x3cb8('0x20')]['write'](_0x42f769+'\x0a');};function _0x15304a(_0x148938,_0x23bc81){let _0x26b368='import\x20os\x0a'+('os.chdir(\x27./app/filesystem/'+_0x23bc81+_0x3cb8('0x1d'))+_0x3cb8('0x3')+(_0x3cb8('0xb')+path[_0x3cb8('0x4')](_0x148938)+'\x27)');python_process=spawn(_0x3cb8('0x21'),['-u','-B','-c',_0x26b368],{'stdio':'pipe'});io['sockets']['emit'](_0x3cb8('0x7'),FusionSettings[_0x3cb8('0x6')]['fusion_program_running']);_0x4a92a7();python_process[_0x3cb8('0x10')]['on']('data',function(_0x246534){logger[_0x3cb8('0x2a')](String(_0x246534)['substring'](0x0,_0x246534['lastIndexOf']('\x0a')));io[_0x3cb8('0x1e')](_0x3cb8('0x28'),{'output':String(_0x246534)});});python_process[_0x3cb8('0x1b')]['on'](_0x3cb8('0x2b'),function(_0x368153){logger['verbose'](String(_0x368153)[_0x3cb8('0x1c')](0x0,_0x368153[_0x3cb8('0x18')]('\x0a')));io[_0x3cb8('0x1e')](_0x3cb8('0x28'),{'output':String(_0x368153)});io['sockets']['emit']('program-running',FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]);io[_0x3cb8('0x8')][_0x3cb8('0x1e')](_0x3cb8('0x1a'),![]);});python_process[_0x3cb8('0x10')]['on'](_0x3cb8('0xa'),function(_0xa78bd4){FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]=null;logger[_0x3cb8('0x2a')](String(_0x3cb8('0x2d')));io[_0x3cb8('0x1e')](_0x3cb8('0x28'),{'output':String(_0x3cb8('0x1f'))});io[_0x3cb8('0x8')][_0x3cb8('0x1e')](_0x3cb8('0x7'),FusionSettings['SocketVariables']['fusion_program_running']);io[_0x3cb8('0x8')]['emit'](_0x3cb8('0x1a'),![]);});}function _0x257575(_0x8168ce,_0x583075){let _0x1110ed=_0x3cb8('0x12')+(_0x3cb8('0x2c')+_0x583075+'/Blockly\x27)\x0a')+_0x3cb8('0x3')+(''+_0x8168ce);if(os[_0x3cb8('0x5')]()!=_0x3cb8('0x27')){python_process=spawn(_0x3cb8('0x21'),['-u','-B','-c',_0x1110ed],{'stdio':_0x3cb8('0x26')});}else{python_process=spawn('python',['-u','-B','-c',_0x1110ed],{'stdio':_0x3cb8('0x26')});}io[_0x3cb8('0x8')][_0x3cb8('0x1e')](_0x3cb8('0x7'),FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]);_0x4a92a7();python_process[_0x3cb8('0x10')]['on'](_0x3cb8('0x2b'),function(_0x13a0f6){logger[_0x3cb8('0x2a')](String(_0x13a0f6)[_0x3cb8('0x1c')](0x0,_0x13a0f6[_0x3cb8('0x18')]('\x0a')));io[_0x3cb8('0x1e')](_0x3cb8('0x25'),{'output':String(_0x13a0f6)});});python_process[_0x3cb8('0x1b')]['on'](_0x3cb8('0x2b'),function(_0x1ac799){logger[_0x3cb8('0x2a')](String(_0x1ac799)[_0x3cb8('0x1c')](0x0,_0x1ac799[_0x3cb8('0x18')]('\x0a')));io[_0x3cb8('0x1e')](_0x3cb8('0x25'),{'output':String(_0x1ac799)});io[_0x3cb8('0x8')]['emit'](_0x3cb8('0x7'),FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]);io['sockets'][_0x3cb8('0x1e')](_0x3cb8('0x1a'),![]);});python_process['stdout']['on']('close',function(_0x210bff){FusionSettings['SocketVariables'][_0x3cb8('0x30')]=null;logger['verbose'](String(_0x3cb8('0x2d')));io['emit'](_0x3cb8('0x25'),{'output':String(_0x3cb8('0x1f'))});io[_0x3cb8('0x8')][_0x3cb8('0x1e')](_0x3cb8('0x7'),FusionSettings[_0x3cb8('0x6')][_0x3cb8('0x30')]);io[_0x3cb8('0x8')][_0x3cb8('0x1e')](_0x3cb8('0x1a'),![]);});}function _0x4a92a7(){if(os[_0x3cb8('0x5')]()!='win32'){setTimeout(function(){var _0x55f95d=shell[_0x3cb8('0x2e')](_0x3cb8('0x22'),{'silent':!![]})['stdout'];if(!_0x55f95d)FusionSettings[_0x3cb8('0x6')][_0x3cb8('0xd')]=![];else FusionSettings[_0x3cb8('0x6')]['fusion_gamepad_available']=!![];io['sockets']['emit']('gamepad-available',FusionSettings['SocketVariables'][_0x3cb8('0xd')]);},0x3e8);}}return _0x4890e8;}();