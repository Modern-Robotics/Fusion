const _0x5e2a=['SocketVariables','catch','stderr','exec','connectedClients','internet-available','\x20because\x20\x22','wireless-tools/wpa_cli','win32','wifi-fusion_storage_type','sockets','../fusionProgram','statusCode','Build','config','stringify','fusion_latest_SHA','fusion_wifi_access','python','join','child_process','fusion_current_SHA','http://localhost:8080/api/diagnostics/stop','diagnostics_running','fusion_battery_level','git\x20rev-list\x20--tags\x20--max-count=1','socket','debug','pop','internet-access','connection','fusion_current_version','shelljs','error','fusion_gamepad_available','update-available','global-message','battery-level','fusion_internet_access','split','version-number','emit','fusion_latest_version','fusion_diagnostics_running','git\x20rev-parse\x20HEAD','KillProgram','type','../global/fusionSettings','data','spawn','path','platform','wifi-connection','success','disconnect','Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client','git\x20describe\x20--tags\x20','dirname','splice','Error\x20reading\x20battery\x20:\x20\x0a','stdout','gamepad-available','trim','program-running','pipe','fusion_program_running','Connected\x20to\x20server','process','Error\x20terminating\x20diagnostic\x20tools\x20:\x20','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','verbose','sep','sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN','Client\x20connected:\x20','fusion_update_available','Socket\x20error\x20-\x20'];(function(_0x2e9975,_0x5e2aa9){const _0x1cda88=function(_0x466e05){while(--_0x466e05){_0x2e9975['push'](_0x2e9975['shift']());}};_0x1cda88(++_0x5e2aa9);}(_0x5e2a,0x127));const _0x1cda=function(_0x2e9975,_0x5e2aa9){_0x2e9975=_0x2e9975-0x0;let _0x1cda88=_0x5e2a[_0x2e9975];return _0x1cda88;};const config=require(_0x1cda('0x17'));const logger=require('../utils/logger');const io=require('.');const FusionSettings=require(_0x1cda('0x38'));const fusionProgram=require(_0x1cda('0x14'));const spawn=require(_0x1cda('0x1d'))[_0x1cda('0x3a')];const internetAvailable=require(_0x1cda('0xe'));const wpa_cli=require(_0x1cda('0x10'));const os=require('os');const shell=require(_0x1cda('0x29'));const path=require(_0x1cda('0x3b'));const request=require('request');module['exports']=async function(){logger[_0x1cda('0x3')]('Configuring\x20socket\x20communication');FusionSettings[_0x1cda('0xd')]=[];var _0x426bc4=path[_0x1cda('0x42')](__dirname)[_0x1cda('0x30')](path[_0x1cda('0x4')])[_0x1cda('0x25')]();var _0x246d25=0x0;var _0x181a7f=0xb;io['on'](_0x1cda('0x27'),function(_0x12efa4){FusionSettings[_0x1cda('0xd')]['push'](_0x12efa4);logger[_0x1cda('0x24')](_0x1cda('0x6')+_0x12efa4['id']);_0x3f8310();_0x12efa4['on'](_0x1cda('0x1c'),function(_0x5a513f){_0x12efa4['emit'](_0x1cda('0x2d'),{'message':_0x1cda('0x4b'),'type':_0x1cda('0x3e')});});_0x12efa4['on'](_0x1cda('0x3f'),function(_0x4a73f6){logger[_0x1cda('0x24')]('Client\x20disconnected:\x20'+_0x12efa4['id']+_0x1cda('0xf')+_0x4a73f6+'\x22');if(FusionSettings[_0x1cda('0x9')][_0x1cda('0x4a')])if(FusionSettings[_0x1cda('0x9')]['fusion_program_running']['SocketId']==_0x12efa4['id'])fusionProgram[_0x1cda('0x36')]();if(FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')])if(FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')][_0x1cda('0x23')]==_0x12efa4['id']){logger['verbose'](_0x1cda('0x40'));request({'url':_0x1cda('0x1f'),'method':'GET'},function(_0x23ebf2,_0x4486ec,_0x25c8a9){if(_0x23ebf2)logger[_0x1cda('0x2a')](_0x1cda('0x1')+_0x23ebf2);else{if(_0x4486ec[_0x1cda('0x15')]==0xc8){FusionSettings[_0x1cda('0x9')]['fusion_diagnostics_running']=null;}}io[_0x1cda('0x13')]['emit']('diagnostics_running',FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')]);});}var _0xb87218=FusionSettings[_0x1cda('0xd')]['indexOf'](_0x12efa4);FusionSettings[_0x1cda('0xd')][_0x1cda('0x43')](_0xb87218,0x1);});_0x12efa4['on'](_0x1cda('0x2a'),function(_0x162b62){logger['error'](_0x1cda('0x8')+_0x162b62);});});function _0x675fdf(){_0x2534c8();_0x437e02();_0x570ccd();_0x59d8bc();_0x4ff504();_0x3e5788();_0x3d3c71();}function _0x426e67(){if(_0x246d25>=_0x181a7f){logger[_0x1cda('0x24')](JSON[_0x1cda('0x18')](FusionSettings['SocketVariables']));io[_0x1cda('0x13')]['emit'](_0x1cda('0x2e'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x21')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x26'),FusionSettings[_0x1cda('0x9')]['fusion_internet_access']);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x31'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x28')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x2c'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x7')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x46'),FusionSettings['SocketVariables'][_0x1cda('0x2b')]);io['sockets'][_0x1cda('0x32')](_0x1cda('0x20'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')]);io[_0x1cda('0x13')]['emit'](_0x1cda('0x3d'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x1a')]);io['sockets']['emit'](_0x1cda('0x12'),FusionSettings['Storage'][_0x1cda('0x37')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x48'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x4a')]);_0x246d25=0x0;}else{setTimeout(_0x426e67,0x7d0);}}function _0x3f8310(){io[_0x1cda('0x13')][_0x1cda('0x32')]('battery-level',FusionSettings['SocketVariables'][_0x1cda('0x21')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x26'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x2f')]);io['sockets'][_0x1cda('0x32')](_0x1cda('0x31'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x28')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x2c'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x7')]);io['sockets'][_0x1cda('0x32')]('gamepad-available',FusionSettings['SocketVariables'][_0x1cda('0x2b')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x20'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')]);io[_0x1cda('0x13')]['emit'](_0x1cda('0x3d'),FusionSettings[_0x1cda('0x9')][_0x1cda('0x1a')]);io[_0x1cda('0x13')][_0x1cda('0x32')](_0x1cda('0x48'),FusionSettings['SocketVariables']['fusion_program_running']);}function _0x2534c8(){if(os[_0x1cda('0x3c')]()!=_0x1cda('0x11')){var _0x9dfdbb='./scripts/ReadBatt.py';var _0x37cbb2=spawn(_0x1cda('0x1b'),[_0x9dfdbb],{'stdio':_0x1cda('0x49')});_0x37cbb2[_0x1cda('0x45')]['on']('data',function(_0x3b058a){FusionSettings[_0x1cda('0x9')][_0x1cda('0x21')]=String(_0x3b058a)[_0x1cda('0x47')]();_0x246d25++;});_0x37cbb2[_0x1cda('0xb')]['on'](_0x1cda('0x39'),function(_0x1c7641){logger['error'](_0x1cda('0x44')+String(_0x1c7641));});}else{_0x246d25++;}}function _0x437e02(){internetAvailable({'timeout':0x2710,'retries':0x5})['then'](function(){FusionSettings[_0x1cda('0x9')]['fusion_internet_access']=!![];_0x246d25++;})[_0x1cda('0xa')](function(){FusionSettings[_0x1cda('0x9')]['fusion_internet_access']=![];_0x246d25++;});}function _0x570ccd(){shell[_0x1cda('0xc')](_0x1cda('0x35'),{'silent':!![]},function(_0x5a5a9a,_0x313086,_0x11895f){(function(_0x5b964d){FusionSettings['SocketVariables'][_0x1cda('0x1e')]=_0x5b964d[_0x1cda('0x47')]();_0x246d25++;_0x54cfa3();}(_0x313086[_0x1cda('0x47')]()));});}function _0x54cfa3(){shell[_0x1cda('0xc')](_0x1cda('0x41')+FusionSettings[_0x1cda('0x9')][_0x1cda('0x1e')],{'silent':!![]},function(_0x5a1222,_0x2e7bf4,_0x595adb){(function(_0x585fc2){FusionSettings[_0x1cda('0x9')][_0x1cda('0x28')]=_0x585fc2[_0x1cda('0x47')]();_0x246d25++;_0x54a073();}(_0x2e7bf4[_0x1cda('0x47')]()));});}function _0x54a073(){if(_0x426bc4==_0x1cda('0x16')){shell['exec']('git\x20fetch',{'silent':!![]},function(_0xa43190,_0x4dfd19,_0x3cecaa){(function(_0x212cf0){_0x246d25++;_0x33087d();}(_0x4dfd19[_0x1cda('0x47')]()));});}else{_0x246d25++;_0x33087d();}}function _0x33087d(){shell[_0x1cda('0xc')](_0x1cda('0x22'),{'silent':!![]},function(_0x4ae9ca,_0x3a6fb4,_0x1e798c){(function(_0x3ba4a6){FusionSettings[_0x1cda('0x9')][_0x1cda('0x19')]=_0x3ba4a6[_0x1cda('0x47')]();_0x246d25++;_0x364ad7();}(_0x3a6fb4[_0x1cda('0x47')]()));});}function _0x364ad7(){shell['exec']('git\x20describe\x20--tags\x20'+FusionSettings['SocketVariables'][_0x1cda('0x19')],{'silent':!![]},function(_0x31db25,_0x49b6b6,_0x439644){(function(_0x19c29f){FusionSettings['SocketVariables'][_0x1cda('0x33')]=_0x19c29f[_0x1cda('0x47')]();_0x246d25++;}(_0x49b6b6[_0x1cda('0x47')]()));});}function _0x59d8bc(){if(FusionSettings[_0x1cda('0x9')][_0x1cda('0x1e')]!=FusionSettings[_0x1cda('0x9')]['fusion_latest_SHA']){FusionSettings[_0x1cda('0x9')][_0x1cda('0x7')]=!![];}else{FusionSettings[_0x1cda('0x9')][_0x1cda('0x7')]=![];}_0x246d25++;}function _0x4ff504(){if(os[_0x1cda('0x3c')]()!=_0x1cda('0x11')){shell['exec'](_0x1cda('0x5'),{'silent':!![]},function(_0x1ff5ec,_0x5ba677,_0x485cc5){(function(_0x19f93f){FusionSettings[_0x1cda('0x9')][_0x1cda('0x2b')]=_0x19f93f[_0x1cda('0x47')]();if(!FusionSettings[_0x1cda('0x9')][_0x1cda('0x2b')])FusionSettings['SocketVariables'][_0x1cda('0x2b')]=![];else FusionSettings[_0x1cda('0x9')][_0x1cda('0x2b')]=!![];_0x246d25++;}(_0x5ba677['trim']()));});}else{FusionSettings['SocketVariables'][_0x1cda('0x2b')]=![];_0x246d25++;}}function _0x3e5788(){if(os['platform']()!=_0x1cda('0x11')){shell[_0x1cda('0xc')](_0x1cda('0x2'),{'silent':!![]},function(_0x1acbc5,_0x29ea04,_0x497866){(function(_0xc26ec9){var _0x16ac72=_0xc26ec9['trim']();if(_0x16ac72){if(FusionSettings[_0x1cda('0x9')]['fusion_diagnostics_running'])FusionSettings[_0x1cda('0x9')]['fusion_diagnostics_running'][_0x1cda('0x0')]=_0x16ac72;else{FusionSettings[_0x1cda('0x9')]['fusion_diagnostics_running']={'process':_0x16ac72,'socket':-0x1};}}else FusionSettings[_0x1cda('0x9')][_0x1cda('0x34')]=null;_0x246d25++;}(_0x29ea04['trim']()));});}else{FusionSettings[_0x1cda('0x9')]['fusion_gamepad_available']=null;_0x246d25++;}}function _0x3d3c71(){wpa_cli['status'](config['get']('Wifi_NIC'),function(_0x26a1c4,_0x3aaa2b){if(_0x26a1c4){_0x3aaa2b={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0x1cda('0x9')]['fusion_wifi_access']=_0x3aaa2b;_0x246d25++;});}_0x426e67();_0x675fdf();setInterval(function(){_0x426e67();_0x675fdf();},0x2710);}();