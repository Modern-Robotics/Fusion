const _0x5891=['sep','Client\x20connected:\x20','data','../global/fusionSettings','fusion_gamepad_available','catch','diagnostics_running','join','http://localhost:8080/api/diagnostics/stop','version-number','splice','indexOf','push','update-available','git\x20rev-parse\x20HEAD','process','SocketId','fusion_wifi_access','pop','fusion_current_SHA','python','then','shelljs','trim','fusion_update_available','wifi-connection','status','Connected\x20to\x20server','wireless-tools/wpa_cli','global-message','request','socket','fusion_diagnostics_running','pipe','spawn','error','../fusionProgram','platform','type','emit','git\x20describe\x20--tags\x20','Socket\x20error\x20-\x20','stringify','program-running','get','connectedClients','sockets','win32','fusion_latest_SHA','path','connection','GET','internet-access','child_process','Error\x20terminating\x20diagnostic\x20tools\x20:\x20','Configuring\x20socket\x20communication','dirname','git\x20rev-list\x20--tags\x20--max-count=1','debug','fusion_internet_access','fusion_current_version','disconnect','stdout','success','fusion_battery_level','config','\x20because\x20\x22','exports','verbose','git\x20fetch','../utils/logger','exec','battery-level','fusion_program_running','SocketVariables','gamepad-available'];(function(_0x134d01,_0x589148){const _0x40b805=function(_0x1aec3f){while(--_0x1aec3f){_0x134d01['push'](_0x134d01['shift']());}};_0x40b805(++_0x589148);}(_0x5891,0xb5));const _0x40b8=function(_0x134d01,_0x589148){_0x134d01=_0x134d01-0x0;let _0x40b805=_0x5891[_0x134d01];return _0x40b805;};const config=require(_0x40b8('0x24'));const logger=require(_0x40b8('0x29'));const io=require('.');const FusionSettings=require(_0x40b8('0x32'));const fusionProgram=require(_0x40b8('0x7'));const spawn=require(_0x40b8('0x18'))[_0x40b8('0x5')];const internetAvailable=require('internet-available');const wpa_cli=require(_0x40b8('0x4b'));const os=require('os');const shell=require(_0x40b8('0x45'));const path=require(_0x40b8('0x14'));const request=require(_0x40b8('0x1'));module[_0x40b8('0x26')]=async function(){logger[_0x40b8('0x27')](_0x40b8('0x1a'));FusionSettings['connectedClients']=[];var _0x3db27d=path[_0x40b8('0x1b')](__dirname)['split'](path[_0x40b8('0x2f')])[_0x40b8('0x41')]();var _0x41fbfc=0x0;var _0x3f61af=0xb;io['on'](_0x40b8('0x15'),function(_0x4f0541){FusionSettings['connectedClients'][_0x40b8('0x3b')](_0x4f0541);logger[_0x40b8('0x1d')](_0x40b8('0x30')+_0x4f0541['id']);_0x3e898f();_0x4f0541['on'](_0x40b8('0x36'),function(_0x183cf1){_0x4f0541[_0x40b8('0xa')](_0x40b8('0x0'),{'message':_0x40b8('0x4a'),'type':_0x40b8('0x22')});});_0x4f0541['on'](_0x40b8('0x20'),function(_0x34e139){logger[_0x40b8('0x1d')]('Client\x20disconnected:\x20'+_0x4f0541['id']+_0x40b8('0x25')+_0x34e139+'\x22');if(FusionSettings['SocketVariables'][_0x40b8('0x2c')])if(FusionSettings[_0x40b8('0x2d')][_0x40b8('0x2c')][_0x40b8('0x3f')]==_0x4f0541['id'])fusionProgram['KillProgram']();if(FusionSettings['SocketVariables'][_0x40b8('0x3')])if(FusionSettings[_0x40b8('0x2d')][_0x40b8('0x3')][_0x40b8('0x2')]==_0x4f0541['id']){logger[_0x40b8('0x27')]('Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client');request({'url':_0x40b8('0x37'),'method':_0x40b8('0x16')},function(_0x3a3823,_0x443576,_0x2fd82f){if(_0x3a3823)logger['error'](_0x40b8('0x19')+_0x3a3823);else{if(_0x443576['statusCode']==0xc8){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x3')]=null;}}io['sockets'][_0x40b8('0xa')](_0x40b8('0x35'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x3')]);});}var _0x1331b7=FusionSettings[_0x40b8('0x10')][_0x40b8('0x3a')](_0x4f0541);FusionSettings[_0x40b8('0x10')][_0x40b8('0x39')](_0x1331b7,0x1);});_0x4f0541['on'](_0x40b8('0x6'),function(_0x13905a){logger[_0x40b8('0x6')](_0x40b8('0xc')+_0x13905a);});});function _0x2db9cd(){_0x1454a7();_0x5c3d48();_0x38c649();_0x466af0();_0x45d302();_0x1fedb4();_0x128a83();}function _0xa93236(){if(_0x41fbfc>=_0x3f61af){logger['debug'](JSON[_0x40b8('0xd')](FusionSettings[_0x40b8('0x2d')]));io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x2b'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x23')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x17'),FusionSettings['SocketVariables']['fusion_internet_access']);io['sockets'][_0x40b8('0xa')](_0x40b8('0x38'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x1f')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x3c'),FusionSettings['SocketVariables'][_0x40b8('0x47')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x2e'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x35'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x3')]);io['sockets']['emit']('wifi-connection',FusionSettings[_0x40b8('0x2d')][_0x40b8('0x40')]);io[_0x40b8('0x11')][_0x40b8('0xa')]('wifi-fusion_storage_type',FusionSettings['Storage'][_0x40b8('0x9')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0xe'),FusionSettings['SocketVariables']['fusion_program_running']);_0x41fbfc=0x0;}else{setTimeout(_0xa93236,0x7d0);}}function _0x3e898f(){io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x2b'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x23')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x17'),FusionSettings['SocketVariables'][_0x40b8('0x1e')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x38'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x1f')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x3c'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x47')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x2e'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]);io[_0x40b8('0x11')]['emit']('diagnostics_running',FusionSettings['SocketVariables'][_0x40b8('0x3')]);io[_0x40b8('0x11')][_0x40b8('0xa')](_0x40b8('0x48'),FusionSettings[_0x40b8('0x2d')][_0x40b8('0x40')]);io[_0x40b8('0x11')][_0x40b8('0xa')]('program-running',FusionSettings[_0x40b8('0x2d')]['fusion_program_running']);}function _0x1454a7(){if(os['platform']()!=_0x40b8('0x12')){var _0x415adf='./scripts/ReadBatt.py';var _0x5e427e=spawn(_0x40b8('0x43'),[_0x415adf],{'stdio':_0x40b8('0x4')});_0x5e427e[_0x40b8('0x21')]['on'](_0x40b8('0x31'),function(_0x3792c1){FusionSettings['SocketVariables']['fusion_battery_level']=String(_0x3792c1)[_0x40b8('0x46')]();_0x41fbfc++;});_0x5e427e['stderr']['on'](_0x40b8('0x31'),function(_0x5916d5){logger[_0x40b8('0x6')]('Error\x20reading\x20battery\x20:\x20\x0a'+String(_0x5916d5));});}else{_0x41fbfc++;}}function _0x5c3d48(){internetAvailable({'timeout':0x2710,'retries':0x5})[_0x40b8('0x44')](function(){FusionSettings['SocketVariables'][_0x40b8('0x1e')]=!![];_0x41fbfc++;})[_0x40b8('0x34')](function(){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x1e')]=![];_0x41fbfc++;});}function _0x38c649(){shell[_0x40b8('0x2a')](_0x40b8('0x3d'),{'silent':!![]},function(_0x1e1a8b,_0x393055,_0x8efbef){(function(_0x2ee64b){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x42')]=_0x2ee64b[_0x40b8('0x46')]();_0x41fbfc++;_0x505970();}(_0x393055[_0x40b8('0x46')]()));});}function _0x505970(){shell['exec'](_0x40b8('0xb')+FusionSettings[_0x40b8('0x2d')][_0x40b8('0x42')],{'silent':!![]},function(_0x582686,_0x5684cc,_0x3e078f){(function(_0x3194ba){FusionSettings[_0x40b8('0x2d')]['fusion_current_version']=_0x3194ba['trim']();_0x41fbfc++;_0x58727f();}(_0x5684cc[_0x40b8('0x46')]()));});}function _0x58727f(){if(_0x3db27d=='Build'){shell[_0x40b8('0x2a')](_0x40b8('0x28'),{'silent':!![]},function(_0x482aae,_0x3aedd5,_0x56fb4b){(function(_0x4ddc2c){_0x41fbfc++;_0x4c337d();}(_0x3aedd5[_0x40b8('0x46')]()));});}else{_0x41fbfc++;_0x4c337d();}}function _0x4c337d(){shell[_0x40b8('0x2a')](_0x40b8('0x1c'),{'silent':!![]},function(_0xc029c6,_0x10ba8c,_0x479bbd){(function(_0x42886b){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x13')]=_0x42886b[_0x40b8('0x46')]();_0x41fbfc++;_0x17d9e2();}(_0x10ba8c['trim']()));});}function _0x17d9e2(){shell[_0x40b8('0x2a')]('git\x20describe\x20--tags\x20'+FusionSettings[_0x40b8('0x2d')][_0x40b8('0x13')],{'silent':!![]},function(_0x2f0803,_0x1ac395,_0x2a726d){(function(_0x224746){FusionSettings['SocketVariables']['fusion_latest_version']=_0x224746[_0x40b8('0x46')]();_0x41fbfc++;}(_0x1ac395['trim']()));});}function _0x466af0(){if(FusionSettings[_0x40b8('0x2d')][_0x40b8('0x42')]!=FusionSettings[_0x40b8('0x2d')][_0x40b8('0x13')]){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x47')]=!![];}else{FusionSettings[_0x40b8('0x2d')]['fusion_update_available']=![];}_0x41fbfc++;}function _0x45d302(){if(os['platform']()!=_0x40b8('0x12')){shell['exec']('sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN',{'silent':!![]},function(_0x28e39c,_0x34c4b6,_0xf5975d){(function(_0xa1cb39){FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]=_0xa1cb39[_0x40b8('0x46')]();if(!FusionSettings[_0x40b8('0x2d')]['fusion_gamepad_available'])FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]=![];else FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]=!![];_0x41fbfc++;}(_0x34c4b6[_0x40b8('0x46')]()));});}else{FusionSettings[_0x40b8('0x2d')][_0x40b8('0x33')]=![];_0x41fbfc++;}}function _0x1fedb4(){if(os[_0x40b8('0x8')]()!=_0x40b8('0x12')){shell['exec']('ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27',{'silent':!![]},function(_0x53f159,_0x1aa804,_0x31a74b){(function(_0x109c3f){var _0x49ccb3=_0x109c3f[_0x40b8('0x46')]();if(_0x49ccb3){if(FusionSettings[_0x40b8('0x2d')]['fusion_diagnostics_running'])FusionSettings[_0x40b8('0x2d')][_0x40b8('0x3')][_0x40b8('0x3e')]=_0x49ccb3;else{FusionSettings['SocketVariables']['fusion_diagnostics_running']={'process':_0x49ccb3,'socket':-0x1};}}else FusionSettings['SocketVariables'][_0x40b8('0x3')]=null;_0x41fbfc++;}(_0x1aa804[_0x40b8('0x46')]()));});}else{FusionSettings[_0x40b8('0x2d')]['fusion_gamepad_available']=null;_0x41fbfc++;}}function _0x128a83(){wpa_cli[_0x40b8('0x49')](config[_0x40b8('0xf')]('Wifi_NIC'),function(_0x371740,_0x4b42a5){if(_0x371740){_0x4b42a5={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0x40b8('0x2d')][_0x40b8('0x40')]=_0x4b42a5;_0x41fbfc++;});}_0xa93236();_0x2db9cd();setInterval(function(){_0xa93236();_0x2db9cd();},0x2710);}();