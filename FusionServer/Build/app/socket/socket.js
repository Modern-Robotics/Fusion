const _0x477e=['Build','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','connectedClients','platform','Client\x20connected:\x20','trim','shelljs','python','win32','git\x20rev-parse\x20HEAD','Error\x20reading\x20battery\x20:\x20\x0a','exports','statusCode','process','spawn','wireless-tools/wpa_cli','gamepad-available','child_process','fusion_update_available','Client\x20disconnected:\x20','wifi-connection','version-number','stringify','fusion_gamepad_available','fusion_battery_level','error','\x20because\x20\x22','internet-available','join','sockets','push','path','wifi-fusion_storage_type','success','get','../global/fusionSettings','Socket\x20error\x20-\x20','update-available','GET','internet-access','exec','emit','request','stdout','Storage','program-running','fusion_program_running','diagnostics_running','socket','pop','pipe','battery-level','verbose','splice','sep','data','config','debug','../fusionProgram','fusion_diagnostics_running','type','fusion_wifi_access','http://localhost:8080/api/diagnostics/stop','fusion_current_SHA','global-message','../utils/logger','SocketVariables','fusion_internet_access','status','KillProgram','disconnect','fusion_current_version','SocketId','Configuring\x20socket\x20communication','Wifi_NIC','Connected\x20to\x20server'];(function(_0x3be7a2,_0x477eb5){const _0x500c3f=function(_0x34dab5){while(--_0x34dab5){_0x3be7a2['push'](_0x3be7a2['shift']());}};_0x500c3f(++_0x477eb5);}(_0x477e,0x73));const _0x500c=function(_0x3be7a2,_0x477eb5){_0x3be7a2=_0x3be7a2-0x0;let _0x500c3f=_0x477e[_0x3be7a2];return _0x500c3f;};const config=require(_0x500c('0x11'));const logger=require(_0x500c('0x1a'));const io=require('.');const FusionSettings=require(_0x500c('0x48'));const fusionProgram=require(_0x500c('0x13'));const spawn=require(_0x500c('0x36'))[_0x500c('0x33')];const internetAvailable=require(_0x500c('0x40'));const wpa_cli=require(_0x500c('0x34'));const os=require('os');const shell=require(_0x500c('0x2b'));const path=require(_0x500c('0x44'));const request=require(_0x500c('0x3'));module[_0x500c('0x30')]=async function(){logger[_0x500c('0xd')](_0x500c('0x22'));FusionSettings[_0x500c('0x27')]=[];var _0x1e243e=path['dirname'](__dirname)['split'](path[_0x500c('0xf')])[_0x500c('0xa')]();var _0x26739f=0x0;var _0x1890c2=0xb;io['on']('connection',function(_0x29d38){FusionSettings[_0x500c('0x27')][_0x500c('0x43')](_0x29d38);logger[_0x500c('0x12')](_0x500c('0x29')+_0x29d38['id']);_0x19cca4();_0x29d38['on'](_0x500c('0x41'),function(_0x2c1f94){_0x29d38['emit'](_0x500c('0x19'),{'message':_0x500c('0x24'),'type':_0x500c('0x46')});});_0x29d38['on'](_0x500c('0x1f'),function(_0x312d46){logger['debug'](_0x500c('0x38')+_0x29d38['id']+_0x500c('0x3f')+_0x312d46+'\x22');if(FusionSettings[_0x500c('0x1b')][_0x500c('0x7')])if(FusionSettings[_0x500c('0x1b')]['fusion_program_running'][_0x500c('0x21')]==_0x29d38['id'])fusionProgram[_0x500c('0x1e')]();if(FusionSettings[_0x500c('0x1b')][_0x500c('0x14')])if(FusionSettings['SocketVariables']['fusion_diagnostics_running'][_0x500c('0x9')]==_0x29d38['id']){logger['verbose']('Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client');request({'url':_0x500c('0x17'),'method':_0x500c('0x4b')},function(_0x9ffa76,_0x3bc332,_0x16cd16){if(_0x9ffa76)logger[_0x500c('0x3e')]('Error\x20terminating\x20diagnostic\x20tools\x20:\x20'+_0x9ffa76);else{if(_0x3bc332[_0x500c('0x31')]==0xc8){FusionSettings[_0x500c('0x1b')][_0x500c('0x14')]=null;}}io['sockets'][_0x500c('0x2')]('diagnostics_running',FusionSettings[_0x500c('0x1b')][_0x500c('0x14')]);});}var _0x2f6b0a=FusionSettings[_0x500c('0x27')]['indexOf'](_0x29d38);FusionSettings[_0x500c('0x27')][_0x500c('0xe')](_0x2f6b0a,0x1);});_0x29d38['on'](_0x500c('0x3e'),function(_0x1f93d3){logger[_0x500c('0x3e')](_0x500c('0x49')+_0x1f93d3);});});function _0x49d36a(){_0x824670();_0x5e84f2();_0x52ae22();_0x5c052e();_0x191d45();_0x2cd594();_0x4b00ee();}function _0x4e372e(){if(_0x26739f>=_0x1890c2){logger[_0x500c('0x12')](JSON[_0x500c('0x3b')](FusionSettings[_0x500c('0x1b')]));io[_0x500c('0x42')][_0x500c('0x2')](_0x500c('0xc'),FusionSettings[_0x500c('0x1b')][_0x500c('0x3d')]);io[_0x500c('0x42')][_0x500c('0x2')](_0x500c('0x0'),FusionSettings['SocketVariables']['fusion_internet_access']);io[_0x500c('0x42')][_0x500c('0x2')](_0x500c('0x3a'),FusionSettings[_0x500c('0x1b')][_0x500c('0x20')]);io[_0x500c('0x42')][_0x500c('0x2')]('update-available',FusionSettings['SocketVariables'][_0x500c('0x37')]);io[_0x500c('0x42')]['emit']('gamepad-available',FusionSettings[_0x500c('0x1b')]['fusion_gamepad_available']);io[_0x500c('0x42')]['emit'](_0x500c('0x8'),FusionSettings[_0x500c('0x1b')]['fusion_diagnostics_running']);io[_0x500c('0x42')]['emit'](_0x500c('0x39'),FusionSettings[_0x500c('0x1b')][_0x500c('0x16')]);io['sockets'][_0x500c('0x2')](_0x500c('0x45'),FusionSettings[_0x500c('0x5')][_0x500c('0x15')]);io['sockets']['emit'](_0x500c('0x6'),FusionSettings[_0x500c('0x1b')][_0x500c('0x7')]);_0x26739f=0x0;}else{setTimeout(_0x4e372e,0x7d0);}}function _0x19cca4(){io[_0x500c('0x42')][_0x500c('0x2')]('battery-level',FusionSettings[_0x500c('0x1b')][_0x500c('0x3d')]);io['sockets'][_0x500c('0x2')]('internet-access',FusionSettings[_0x500c('0x1b')][_0x500c('0x1c')]);io['sockets'][_0x500c('0x2')]('version-number',FusionSettings[_0x500c('0x1b')][_0x500c('0x20')]);io[_0x500c('0x42')]['emit'](_0x500c('0x4a'),FusionSettings[_0x500c('0x1b')][_0x500c('0x37')]);io['sockets'][_0x500c('0x2')](_0x500c('0x35'),FusionSettings['SocketVariables'][_0x500c('0x3c')]);io[_0x500c('0x42')][_0x500c('0x2')](_0x500c('0x8'),FusionSettings[_0x500c('0x1b')][_0x500c('0x14')]);io[_0x500c('0x42')][_0x500c('0x2')](_0x500c('0x39'),FusionSettings[_0x500c('0x1b')][_0x500c('0x16')]);io['sockets'][_0x500c('0x2')](_0x500c('0x6'),FusionSettings[_0x500c('0x1b')][_0x500c('0x7')]);}function _0x824670(){if(os[_0x500c('0x28')]()!=_0x500c('0x2d')){var _0x1dce41='./scripts/ReadBatt.py';var _0x435412=spawn(_0x500c('0x2c'),[_0x1dce41],{'stdio':_0x500c('0xb')});_0x435412[_0x500c('0x4')]['on'](_0x500c('0x10'),function(_0x8689db){FusionSettings['SocketVariables'][_0x500c('0x3d')]=String(_0x8689db)['trim']();_0x26739f++;});_0x435412['stderr']['on'](_0x500c('0x10'),function(_0x53314f){logger[_0x500c('0x3e')](_0x500c('0x2f')+String(_0x53314f));});}else{_0x26739f++;}}function _0x5e84f2(){internetAvailable({'timeout':0x2710,'retries':0x5})['then'](function(){FusionSettings[_0x500c('0x1b')][_0x500c('0x1c')]=!![];_0x26739f++;})['catch'](function(){FusionSettings[_0x500c('0x1b')][_0x500c('0x1c')]=![];_0x26739f++;});}function _0x52ae22(){shell[_0x500c('0x1')](_0x500c('0x2e'),{'silent':!![]},function(_0x368289,_0x2f7ba3,_0x4078a5){(function(_0x3bf4aa){FusionSettings[_0x500c('0x1b')]['fusion_current_SHA']=_0x3bf4aa[_0x500c('0x2a')]();_0x26739f++;_0x1ce94a();}(_0x2f7ba3[_0x500c('0x2a')]()));});}function _0x1ce94a(){shell[_0x500c('0x1')]('git\x20describe\x20--tags\x20'+FusionSettings['SocketVariables'][_0x500c('0x18')],{'silent':!![]},function(_0x8509f,_0xc3355e,_0x35efd9){(function(_0x121069){FusionSettings[_0x500c('0x1b')][_0x500c('0x20')]=_0x121069[_0x500c('0x2a')]();_0x26739f++;_0x5e06d4();}(_0xc3355e[_0x500c('0x2a')]()));});}function _0x5e06d4(){if(_0x1e243e==_0x500c('0x25')){shell['exec']('git\x20fetch',{'silent':!![]},function(_0x5ec284,_0x5ea02a,_0x1b45fc){(function(_0x2834d5){_0x26739f++;_0x4c17fd();}(_0x5ea02a[_0x500c('0x2a')]()));});}else{_0x26739f++;_0x4c17fd();}}function _0x4c17fd(){shell[_0x500c('0x1')]('git\x20rev-list\x20--tags\x20--max-count=1',{'silent':!![]},function(_0x3d2ddc,_0x4c7302,_0x323d3f){(function(_0x31ea88){FusionSettings[_0x500c('0x1b')]['fusion_latest_SHA']=_0x31ea88[_0x500c('0x2a')]();_0x26739f++;_0x4b7856();}(_0x4c7302[_0x500c('0x2a')]()));});}function _0x4b7856(){shell[_0x500c('0x1')]('git\x20describe\x20--tags\x20'+FusionSettings[_0x500c('0x1b')]['fusion_latest_SHA'],{'silent':!![]},function(_0x456e10,_0x286f9e,_0x4428c4){(function(_0x490dd2){FusionSettings['SocketVariables']['fusion_latest_version']=_0x490dd2[_0x500c('0x2a')]();_0x26739f++;}(_0x286f9e[_0x500c('0x2a')]()));});}function _0x5c052e(){if(FusionSettings['SocketVariables'][_0x500c('0x18')]!=FusionSettings[_0x500c('0x1b')]['fusion_latest_SHA']){FusionSettings[_0x500c('0x1b')][_0x500c('0x37')]=!![];}else{FusionSettings[_0x500c('0x1b')][_0x500c('0x37')]=![];}_0x26739f++;}function _0x191d45(){if(os['platform']()!=_0x500c('0x2d')){shell[_0x500c('0x1')]('sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN',{'silent':!![]},function(_0x5bf688,_0x21c50b,_0x14fc9d){(function(_0x48e773){FusionSettings[_0x500c('0x1b')][_0x500c('0x3c')]=_0x48e773[_0x500c('0x2a')]();if(!FusionSettings[_0x500c('0x1b')][_0x500c('0x3c')])FusionSettings['SocketVariables'][_0x500c('0x3c')]=![];else FusionSettings[_0x500c('0x1b')][_0x500c('0x3c')]=!![];_0x26739f++;}(_0x21c50b[_0x500c('0x2a')]()));});}else{FusionSettings[_0x500c('0x1b')][_0x500c('0x3c')]=![];_0x26739f++;}}function _0x2cd594(){if(os[_0x500c('0x28')]()!=_0x500c('0x2d')){shell['exec'](_0x500c('0x26'),{'silent':!![]},function(_0x2639d3,_0x142e4a,_0x3a95d5){(function(_0x372cb1){var _0x1f8609=_0x372cb1[_0x500c('0x2a')]();if(_0x1f8609){if(FusionSettings[_0x500c('0x1b')][_0x500c('0x14')])FusionSettings[_0x500c('0x1b')][_0x500c('0x14')][_0x500c('0x32')]=_0x1f8609;else{FusionSettings['SocketVariables'][_0x500c('0x14')]={'process':_0x1f8609,'socket':-0x1};}}else FusionSettings['SocketVariables'][_0x500c('0x14')]=null;_0x26739f++;}(_0x142e4a[_0x500c('0x2a')]()));});}else{FusionSettings[_0x500c('0x1b')][_0x500c('0x3c')]=null;_0x26739f++;}}function _0x4b00ee(){wpa_cli[_0x500c('0x1d')](config[_0x500c('0x47')](_0x500c('0x23')),function(_0x2c61b3,_0x14ef0c){if(_0x2c61b3){_0x14ef0c={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0x500c('0x1b')][_0x500c('0x16')]=_0x14ef0c;_0x26739f++;});}_0x4e372e();_0x49d36a();setInterval(function(){_0x4e372e();_0x49d36a();},0x2710);}();