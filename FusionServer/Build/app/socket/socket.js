var _0x2a3e=['sockets','battery-level','fusion_internet_access','fusion_current_version','update-available','fusion_update_available','gamepad-available','fusion_gamepad_available','wifi-connection','fusion_wifi_access','wifi-fusion_storage_type','Storage','type','fusion_battery_level','internet-access','program-running','platform','win32','pipe','data','stderr','Error\x20reading\x20battery\x20:\x20\x0a','then','catch','exec','trim','git\x20describe\x20--tags\x20','Build','git\x20fetch','git\x20rev-list\x20--tags\x20--max-count=1','fusion_latest_SHA','fusion_latest_version','fusion_current_SHA','sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','status','Wifi_NIC','../global/fusionSettings','../fusionProgram','child_process','spawn','internet-available','wireless-tools/wpa_cli','shelljs','exports','Configuring\x20socket\x20communication','connectedClients','dirname','pop','connection','push','debug','join','emit','global-message','Connected\x20to\x20server','success','disconnect','SocketVariables','fusion_program_running','SocketId','KillProgram','fusion_diagnostics_running','verbose','Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client','http://localhost:8080/api/diagnostics/stop','GET','error','Error\x20terminating\x20diagnostic\x20tools\x20:\x20','statusCode','diagnostics_running','indexOf','client-disconnected','Socket\x20error\x20-\x20','stringify'];(function(_0x2256a5,_0x520218){var _0x191628=function(_0x5a27f3){while(--_0x5a27f3){_0x2256a5['push'](_0x2256a5['shift']());}};_0x191628(++_0x520218);}(_0x2a3e,0x151));var _0xbdd9=function(_0x262b17,_0x480bdd){_0x262b17=_0x262b17-0x0;var _0x14b99e=_0x2a3e[_0x262b17];return _0x14b99e;};const config=require('config');const logger=require('../utils/logger');const io=require('.');const FusionSettings=require(_0xbdd9('0x0'));const fusionProgram=require(_0xbdd9('0x1'));const spawn=require(_0xbdd9('0x2'))[_0xbdd9('0x3')];const internetAvailable=require(_0xbdd9('0x4'));const wpa_cli=require(_0xbdd9('0x5'));const os=require('os');const shell=require(_0xbdd9('0x6'));const path=require('path');const request=require('request');const eventEmitter=require('./../events');module[_0xbdd9('0x7')]=async function(){logger['verbose'](_0xbdd9('0x8'));FusionSettings[_0xbdd9('0x9')]=[];var _0x4cbbbc=path[_0xbdd9('0xa')](__dirname)['split'](path['sep'])[_0xbdd9('0xb')]();var _0x45705e=0x0;var _0x306b84=0xb;io['on'](_0xbdd9('0xc'),function(_0x2253c4){FusionSettings[_0xbdd9('0x9')][_0xbdd9('0xd')](_0x2253c4);logger[_0xbdd9('0xe')]('Client\x20connected:\x20'+_0x2253c4['id']);_0x2d5ea7();_0x2253c4['on'](_0xbdd9('0xf'),function(_0x345c91){_0x2253c4[_0xbdd9('0x10')](_0xbdd9('0x11'),{'message':_0xbdd9('0x12'),'type':_0xbdd9('0x13')});eventEmitter[_0xbdd9('0x10')]('client-connected');});_0x2253c4['on'](_0xbdd9('0x14'),function(_0x594deb){logger[_0xbdd9('0xe')]('Client\x20disconnected:\x20'+_0x2253c4['id']+'\x20because\x20\x22'+_0x594deb+'\x22');if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x16')])if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x16')][_0xbdd9('0x17')]==_0x2253c4['id'])fusionProgram[_0xbdd9('0x18')]();if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')])if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')]['socket']==_0x2253c4['id']){logger[_0xbdd9('0x1a')](_0xbdd9('0x1b'));request({'url':_0xbdd9('0x1c'),'method':_0xbdd9('0x1d')},function(_0x52202a,_0x441642,_0x20744e){if(_0x52202a)logger[_0xbdd9('0x1e')](_0xbdd9('0x1f')+_0x52202a);else{if(_0x441642[_0xbdd9('0x20')]==0xc8){FusionSettings[_0xbdd9('0x15')]['fusion_diagnostics_running']=null;}}io['sockets']['emit'](_0xbdd9('0x21'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')]);});}var _0x54bbfc=FusionSettings[_0xbdd9('0x9')][_0xbdd9('0x22')](_0x2253c4);FusionSettings[_0xbdd9('0x9')]['splice'](_0x54bbfc,0x1);eventEmitter[_0xbdd9('0x10')](_0xbdd9('0x23'));});_0x2253c4['on'](_0xbdd9('0x1e'),function(_0x1225bb){logger['error'](_0xbdd9('0x24')+_0x1225bb);});});function _0x73aea9(){_0x479ae3();_0xa11f26();_0x2acc94();_0x8501aa();_0xcc040d();_0x36003a();_0x944969();}function _0x69afe1(){if(_0x45705e>=_0x306b84){logger[_0xbdd9('0xe')](JSON[_0xbdd9('0x25')](FusionSettings[_0xbdd9('0x15')]));io[_0xbdd9('0x26')]['emit'](_0xbdd9('0x27'),FusionSettings['SocketVariables']['fusion_battery_level']);io[_0xbdd9('0x26')][_0xbdd9('0x10')]('internet-access',FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x28')]);io[_0xbdd9('0x26')][_0xbdd9('0x10')]('version-number',FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x29')]);io['sockets'][_0xbdd9('0x10')](_0xbdd9('0x2a'),FusionSettings['SocketVariables'][_0xbdd9('0x2b')]);io[_0xbdd9('0x26')][_0xbdd9('0x10')](_0xbdd9('0x2c'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2d')]);io['sockets']['emit'](_0xbdd9('0x21'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')]);io['sockets'][_0xbdd9('0x10')](_0xbdd9('0x2e'),FusionSettings['SocketVariables'][_0xbdd9('0x2f')]);io[_0xbdd9('0x26')][_0xbdd9('0x10')](_0xbdd9('0x30'),FusionSettings[_0xbdd9('0x31')][_0xbdd9('0x32')]);io[_0xbdd9('0x26')]['emit']('program-running',FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x16')]);_0x45705e=0x0;}else{setTimeout(_0x69afe1,0x7d0);}}function _0x2d5ea7(){io[_0xbdd9('0x26')][_0xbdd9('0x10')](_0xbdd9('0x27'),FusionSettings['SocketVariables'][_0xbdd9('0x33')]);io[_0xbdd9('0x26')][_0xbdd9('0x10')](_0xbdd9('0x34'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x28')]);io[_0xbdd9('0x26')]['emit']('version-number',FusionSettings['SocketVariables']['fusion_current_version']);io[_0xbdd9('0x26')][_0xbdd9('0x10')]('update-available',FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2b')]);io[_0xbdd9('0x26')]['emit'](_0xbdd9('0x2c'),FusionSettings[_0xbdd9('0x15')]['fusion_gamepad_available']);io[_0xbdd9('0x26')][_0xbdd9('0x10')](_0xbdd9('0x21'),FusionSettings[_0xbdd9('0x15')]['fusion_diagnostics_running']);io['sockets'][_0xbdd9('0x10')](_0xbdd9('0x2e'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2f')]);io['sockets'][_0xbdd9('0x10')](_0xbdd9('0x35'),FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x16')]);}function _0x479ae3(){if(os[_0xbdd9('0x36')]()!=_0xbdd9('0x37')){var _0x21ac60='./scripts/ReadBatt.py';var _0x254f62=spawn('python',[_0x21ac60],{'stdio':_0xbdd9('0x38')});_0x254f62['stdout']['on'](_0xbdd9('0x39'),function(_0x340ba0){FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x33')]=String(_0x340ba0)['trim']();_0x45705e++;});_0x254f62[_0xbdd9('0x3a')]['on'](_0xbdd9('0x39'),function(_0x1ff23e){logger[_0xbdd9('0x1e')](_0xbdd9('0x3b')+String(_0x1ff23e));});}else{_0x45705e++;}}function _0xa11f26(){internetAvailable({'timeout':0x2710,'retries':0x5})[_0xbdd9('0x3c')](function(){FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x28')]=!![];_0x45705e++;})[_0xbdd9('0x3d')](function(){FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x28')]=![];_0x45705e++;});}function _0x2acc94(){shell[_0xbdd9('0x3e')]('git\x20rev-parse\x20HEAD',{'silent':!![]},function(_0x41efd0,_0x4d1f02,_0x259bc6){(function(_0x2d615e){FusionSettings[_0xbdd9('0x15')]['fusion_current_SHA']=_0x2d615e[_0xbdd9('0x3f')]();_0x45705e++;_0x9386fb();}(_0x4d1f02[_0xbdd9('0x3f')]()));});}function _0x9386fb(){shell['exec'](_0xbdd9('0x40')+FusionSettings[_0xbdd9('0x15')]['fusion_current_SHA'],{'silent':!![]},function(_0x6246ba,_0x1c89d7,_0x326200){(function(_0x22d266){FusionSettings[_0xbdd9('0x15')]['fusion_current_version']=_0x22d266[_0xbdd9('0x3f')]();_0x45705e++;_0x3ea313();}(_0x1c89d7[_0xbdd9('0x3f')]()));});}function _0x3ea313(){if(_0x4cbbbc==_0xbdd9('0x41')){shell['exec'](_0xbdd9('0x42'),{'silent':!![]},function(_0x2c14ad,_0x4b5405,_0x4f4e86){(function(_0x5e1d01){_0x45705e++;_0x28f4c7();}(_0x4b5405[_0xbdd9('0x3f')]()));});}else{_0x45705e++;_0x28f4c7();}}function _0x28f4c7(){shell[_0xbdd9('0x3e')](_0xbdd9('0x43'),{'silent':!![]},function(_0x5aa804,_0x53c93a,_0x565774){(function(_0x876241){FusionSettings['SocketVariables'][_0xbdd9('0x44')]=_0x876241[_0xbdd9('0x3f')]();_0x45705e++;_0x499876();}(_0x53c93a[_0xbdd9('0x3f')]()));});}function _0x499876(){shell[_0xbdd9('0x3e')]('git\x20describe\x20--tags\x20'+FusionSettings[_0xbdd9('0x15')]['fusion_latest_SHA'],{'silent':!![]},function(_0x334642,_0x519f29,_0x26d79c){(function(_0x4623f6){FusionSettings['SocketVariables'][_0xbdd9('0x45')]=_0x4623f6[_0xbdd9('0x3f')]();_0x45705e++;}(_0x519f29[_0xbdd9('0x3f')]()));});}function _0x8501aa(){if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x46')]!=FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x44')]){FusionSettings[_0xbdd9('0x15')]['fusion_update_available']=!![];}else{FusionSettings['SocketVariables'][_0xbdd9('0x2b')]=![];}_0x45705e++;}function _0xcc040d(){if(os['platform']()!=_0xbdd9('0x37')){shell[_0xbdd9('0x3e')](_0xbdd9('0x47'),{'silent':!![]},function(_0x3177ef,_0x5c1bb2,_0x135035){(function(_0x29657c){FusionSettings['SocketVariables']['fusion_gamepad_available']=_0x29657c[_0xbdd9('0x3f')]();if(!FusionSettings['SocketVariables'][_0xbdd9('0x2d')])FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2d')]=![];else FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2d')]=!![];_0x45705e++;}(_0x5c1bb2[_0xbdd9('0x3f')]()));});}else{FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2d')]=![];_0x45705e++;}}function _0x36003a(){if(os['platform']()!=_0xbdd9('0x37')){shell[_0xbdd9('0x3e')](_0xbdd9('0x48'),{'silent':!![]},function(_0x19c2ae,_0x557fb0,_0x3bb534){(function(_0x4ccb4f){var _0x222c1d=_0x4ccb4f['trim']();if(_0x222c1d){if(FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')])FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')]['process']=_0x222c1d;else{FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x19')]={'process':_0x222c1d,'socket':-0x1};}}else FusionSettings['SocketVariables'][_0xbdd9('0x19')]=null;_0x45705e++;}(_0x557fb0[_0xbdd9('0x3f')]()));});}else{FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2d')]=null;_0x45705e++;}}function _0x944969(){wpa_cli[_0xbdd9('0x49')](config['get'](_0xbdd9('0x4a')),function(_0x3cc222,_0x43ad03){if(_0x3cc222){_0x43ad03={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0xbdd9('0x15')][_0xbdd9('0x2f')]=_0x43ad03;_0x45705e++;});}_0x69afe1();_0x73aea9();setInterval(function(){_0x69afe1();_0x73aea9();},0x2710);}();