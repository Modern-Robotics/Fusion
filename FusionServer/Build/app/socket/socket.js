const _0x3273=['SocketId','fusion_internet_access','http://localhost:8080/api/diagnostics/stop','exports','get','internet-available','fusion_diagnostics_running','error','wifi-fusion_storage_type','success','fusion_battery_level','then','trim','../fusionProgram','update-available','git\x20fetch','exec','Error\x20reading\x20battery\x20:\x20\x0a','splice','disconnect','verbose','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','shelljs','path','wireless-tools/wpa_cli','gamepad-available','Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client','diagnostics_running','emit','wifi-connection','win32','../global/fusionSettings','socket','catch','Error\x20terminating\x20diagnostic\x20tools\x20:\x20','pop','debug','version-number','battery-level','global-message','Build','spawn','fusion_gamepad_available','request','git\x20describe\x20--tags\x20','SocketVariables','split','pipe','sockets','process','stringify','fusion_wifi_access','data','fusion_latest_SHA','\x20because\x20\x22','fusion_current_version','./scripts/ReadBatt.py','program-running','statusCode','Client\x20disconnected:\x20','python','stdout','fusion_latest_version','child_process','indexOf','dirname','Socket\x20error\x20-\x20','push','fusion_program_running','Client\x20connected:\x20','sep','connectedClients','fusion_update_available','Wifi_NIC','join','platform','fusion_current_SHA','internet-access','status','stderr','git\x20rev-parse\x20HEAD'];(function(_0x1affdf,_0x3273d9){const _0x95c33=function(_0x5c8ba1){while(--_0x5c8ba1){_0x1affdf['push'](_0x1affdf['shift']());}};_0x95c33(++_0x3273d9);}(_0x3273,0xd5));const _0x95c3=function(_0x1affdf,_0x3273d9){_0x1affdf=_0x1affdf-0x0;let _0x95c33=_0x3273[_0x1affdf];return _0x95c33;};const config=require('config');const logger=require('../utils/logger');const io=require('.');const FusionSettings=require(_0x95c3('0x3d'));const fusionProgram=require(_0x95c3('0x2b'));const spawn=require(_0x95c3('0xc'))[_0x95c3('0x47')];const internetAvailable=require(_0x95c3('0x23'));const wpa_cli=require(_0x95c3('0x36'));const os=require('os');const shell=require(_0x95c3('0x34'));const path=require(_0x95c3('0x35'));const request=require(_0x95c3('0x49'));module[_0x95c3('0x21')]=async function(){logger[_0x95c3('0x32')]('Configuring\x20socket\x20communication');FusionSettings['connectedClients']=[];var _0x28107e=path[_0x95c3('0xe')](__dirname)[_0x95c3('0x4c')](path[_0x95c3('0x13')])[_0x95c3('0x41')]();var _0x3b7887=0x0;var _0x2fb841=0xb;io['on']('connection',function(_0xd68a05){FusionSettings[_0x95c3('0x14')][_0x95c3('0x10')](_0xd68a05);logger[_0x95c3('0x42')](_0x95c3('0x12')+_0xd68a05['id']);_0x20385e();_0xd68a05['on'](_0x95c3('0x17'),function(_0x54273e){_0xd68a05[_0x95c3('0x3a')](_0x95c3('0x45'),{'message':'Connected\x20to\x20server','type':_0x95c3('0x27')});});_0xd68a05['on'](_0x95c3('0x31'),function(_0x8b8288){logger[_0x95c3('0x42')](_0x95c3('0x8')+_0xd68a05['id']+_0x95c3('0x3')+_0x8b8288+'\x22');if(FusionSettings[_0x95c3('0x4b')]['fusion_program_running'])if(FusionSettings[_0x95c3('0x4b')][_0x95c3('0x11')][_0x95c3('0x1e')]==_0xd68a05['id'])fusionProgram['KillProgram']();if(FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')])if(FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')][_0x95c3('0x3e')]==_0xd68a05['id']){logger[_0x95c3('0x32')](_0x95c3('0x38'));request({'url':_0x95c3('0x20'),'method':'GET'},function(_0x817419,_0x342026,_0x13152d){if(_0x817419)logger[_0x95c3('0x25')](_0x95c3('0x40')+_0x817419);else{if(_0x342026[_0x95c3('0x7')]==0xc8){FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]=null;}}io[_0x95c3('0x4e')]['emit'](_0x95c3('0x39'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]);});}var _0x5c965c=FusionSettings['connectedClients'][_0x95c3('0xd')](_0xd68a05);FusionSettings[_0x95c3('0x14')][_0x95c3('0x30')](_0x5c965c,0x1);});_0xd68a05['on']('error',function(_0x4ba8fe){logger[_0x95c3('0x25')](_0x95c3('0xf')+_0x4ba8fe);});});function _0x2f71b9(){_0x20ad6e();_0x26f38e();_0xc2ae84();_0x5c9e6d();_0x3c3ba4();_0x5bedde();_0x43c84b();}function _0x1303bf(){if(_0x3b7887>=_0x2fb841){logger[_0x95c3('0x42')](JSON[_0x95c3('0x50')](FusionSettings[_0x95c3('0x4b')]));io['sockets'][_0x95c3('0x3a')](_0x95c3('0x44'),FusionSettings[_0x95c3('0x4b')]['fusion_battery_level']);io[_0x95c3('0x4e')][_0x95c3('0x3a')]('internet-access',FusionSettings[_0x95c3('0x4b')][_0x95c3('0x1f')]);io[_0x95c3('0x4e')][_0x95c3('0x3a')](_0x95c3('0x43'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x4')]);io[_0x95c3('0x4e')]['emit'](_0x95c3('0x2c'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x15')]);io[_0x95c3('0x4e')][_0x95c3('0x3a')]('gamepad-available',FusionSettings[_0x95c3('0x4b')][_0x95c3('0x48')]);io['sockets'][_0x95c3('0x3a')](_0x95c3('0x39'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]);io[_0x95c3('0x4e')][_0x95c3('0x3a')](_0x95c3('0x3b'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x0')]);io[_0x95c3('0x4e')][_0x95c3('0x3a')](_0x95c3('0x26'),FusionSettings['Storage']['type']);io[_0x95c3('0x4e')][_0x95c3('0x3a')](_0x95c3('0x6'),FusionSettings[_0x95c3('0x4b')]['fusion_program_running']);_0x3b7887=0x0;}else{setTimeout(_0x1303bf,0x7d0);}}function _0x20385e(){io[_0x95c3('0x4e')]['emit'](_0x95c3('0x44'),FusionSettings[_0x95c3('0x4b')]['fusion_battery_level']);io[_0x95c3('0x4e')]['emit'](_0x95c3('0x1a'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x1f')]);io[_0x95c3('0x4e')]['emit'](_0x95c3('0x43'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x4')]);io['sockets'][_0x95c3('0x3a')](_0x95c3('0x2c'),FusionSettings[_0x95c3('0x4b')][_0x95c3('0x15')]);io['sockets']['emit'](_0x95c3('0x37'),FusionSettings['SocketVariables'][_0x95c3('0x48')]);io[_0x95c3('0x4e')]['emit']('diagnostics_running',FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]);io['sockets'][_0x95c3('0x3a')]('wifi-connection',FusionSettings[_0x95c3('0x4b')][_0x95c3('0x0')]);io[_0x95c3('0x4e')][_0x95c3('0x3a')](_0x95c3('0x6'),FusionSettings['SocketVariables'][_0x95c3('0x11')]);}function _0x20ad6e(){if(os[_0x95c3('0x18')]()!=_0x95c3('0x3c')){var _0x1e5b4d=_0x95c3('0x5');var _0x3efe0d=spawn(_0x95c3('0x9'),[_0x1e5b4d],{'stdio':_0x95c3('0x4d')});_0x3efe0d[_0x95c3('0xa')]['on'](_0x95c3('0x1'),function(_0x70c4a8){FusionSettings[_0x95c3('0x4b')][_0x95c3('0x28')]=String(_0x70c4a8)[_0x95c3('0x2a')]();_0x3b7887++;});_0x3efe0d[_0x95c3('0x1c')]['on'](_0x95c3('0x1'),function(_0x2fd522){logger[_0x95c3('0x25')](_0x95c3('0x2f')+String(_0x2fd522));});}else{_0x3b7887++;}}function _0x26f38e(){internetAvailable({'timeout':0x2710,'retries':0x5})[_0x95c3('0x29')](function(){FusionSettings[_0x95c3('0x4b')]['fusion_internet_access']=!![];_0x3b7887++;})[_0x95c3('0x3f')](function(){FusionSettings[_0x95c3('0x4b')]['fusion_internet_access']=![];_0x3b7887++;});}function _0xc2ae84(){shell['exec'](_0x95c3('0x1d'),{'silent':!![]},function(_0x265fc9,_0x3f2a94,_0xf8aa28){(function(_0x2dd620){FusionSettings[_0x95c3('0x4b')][_0x95c3('0x19')]=_0x2dd620[_0x95c3('0x2a')]();_0x3b7887++;_0x4db873();}(_0x3f2a94[_0x95c3('0x2a')]()));});}function _0x4db873(){shell[_0x95c3('0x2e')](_0x95c3('0x4a')+FusionSettings['SocketVariables'][_0x95c3('0x19')],{'silent':!![]},function(_0x10e182,_0x2e2ab7,_0x3171b2){(function(_0x1bfa7b){FusionSettings[_0x95c3('0x4b')]['fusion_current_version']=_0x1bfa7b[_0x95c3('0x2a')]();_0x3b7887++;_0x5f336f();}(_0x2e2ab7[_0x95c3('0x2a')]()));});}function _0x5f336f(){if(_0x28107e==_0x95c3('0x46')){shell['exec'](_0x95c3('0x2d'),{'silent':!![]},function(_0x2790f7,_0x43ec34,_0x470746){(function(_0xa65885){_0x3b7887++;_0x1d9ad5();}(_0x43ec34[_0x95c3('0x2a')]()));});}else{_0x3b7887++;_0x1d9ad5();}}function _0x1d9ad5(){shell[_0x95c3('0x2e')]('git\x20rev-list\x20--tags\x20--max-count=1',{'silent':!![]},function(_0x3085b3,_0x3e0f92,_0x9a4e18){(function(_0x9a13f1){FusionSettings[_0x95c3('0x4b')][_0x95c3('0x2')]=_0x9a13f1[_0x95c3('0x2a')]();_0x3b7887++;_0x5f227e();}(_0x3e0f92['trim']()));});}function _0x5f227e(){shell[_0x95c3('0x2e')]('git\x20describe\x20--tags\x20'+FusionSettings['SocketVariables']['fusion_latest_SHA'],{'silent':!![]},function(_0x325536,_0xe79c7b,_0x5cdaa6){(function(_0x7c59bb){FusionSettings[_0x95c3('0x4b')][_0x95c3('0xb')]=_0x7c59bb[_0x95c3('0x2a')]();_0x3b7887++;}(_0xe79c7b['trim']()));});}function _0x5c9e6d(){if(FusionSettings['SocketVariables'][_0x95c3('0x19')]!=FusionSettings[_0x95c3('0x4b')][_0x95c3('0x2')]){FusionSettings[_0x95c3('0x4b')]['fusion_update_available']=!![];}else{FusionSettings[_0x95c3('0x4b')]['fusion_update_available']=![];}_0x3b7887++;}function _0x3c3ba4(){if(os[_0x95c3('0x18')]()!=_0x95c3('0x3c')){shell[_0x95c3('0x2e')]('sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN',{'silent':!![]},function(_0x22fe82,_0xf3f21f,_0x512399){(function(_0x433e83){FusionSettings['SocketVariables']['fusion_gamepad_available']=_0x433e83['trim']();if(!FusionSettings[_0x95c3('0x4b')]['fusion_gamepad_available'])FusionSettings[_0x95c3('0x4b')][_0x95c3('0x48')]=![];else FusionSettings[_0x95c3('0x4b')][_0x95c3('0x48')]=!![];_0x3b7887++;}(_0xf3f21f['trim']()));});}else{FusionSettings[_0x95c3('0x4b')][_0x95c3('0x48')]=![];_0x3b7887++;}}function _0x5bedde(){if(os['platform']()!=_0x95c3('0x3c')){shell[_0x95c3('0x2e')](_0x95c3('0x33'),{'silent':!![]},function(_0x348cb9,_0xb51d4a,_0x5bcc4c){(function(_0x42f759){var _0x2c2c22=_0x42f759[_0x95c3('0x2a')]();if(_0x2c2c22){if(FusionSettings['SocketVariables'][_0x95c3('0x24')])FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')][_0x95c3('0x4f')]=_0x2c2c22;else{FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]={'process':_0x2c2c22,'socket':-0x1};}}else FusionSettings[_0x95c3('0x4b')][_0x95c3('0x24')]=null;_0x3b7887++;}(_0xb51d4a[_0x95c3('0x2a')]()));});}else{FusionSettings[_0x95c3('0x4b')][_0x95c3('0x48')]=null;_0x3b7887++;}}function _0x43c84b(){wpa_cli[_0x95c3('0x1b')](config[_0x95c3('0x22')](_0x95c3('0x16')),function(_0x40c147,_0x574afd){if(_0x40c147){_0x574afd={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0x95c3('0x4b')]['fusion_wifi_access']=_0x574afd;_0x3b7887++;});}_0x1303bf();_0x2f71b9();setInterval(function(){_0x1303bf();_0x2f71b9();},0x2710);}();