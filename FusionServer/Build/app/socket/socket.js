const _0x7732=['request','KillProgram','update-available','Client\x20disconnected:\x20','push','stderr','error','fusion_program_running','1nCkEUh','child_process','then','shelljs','fusion_gamepad_available','7957tksFhX','verbose','platform','GET','wireless-tools/wpa_cli','4xyYXYS','\x20because\x20\x22','diagnostics_running','stringify','sockets','emit','47enchSy','Build','git\x20describe\x20--tags\x20','./scripts/ReadBatt.py','../global/fusionSettings','splice','483858ptOMkG','fusion_current_SHA','../utils/logger','fusion_latest_SHA','process','wifi-fusion_storage_type','960829uNCTXF','debug','fusion_diagnostics_running','SocketVariables','wifi-connection','./../events','29yGcVAm','git\x20rev-parse\x20HEAD','109214rmahMj','path','30077vYabQe','battery-level','client-connected','Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client','internet-available','http://localhost:8080/api/diagnostics/stop','global-message','Configuring\x20socket\x20communication','1JvVyYp','fusion_update_available','internet-access','disconnect','Socket\x20error\x20-\x20','795990dyZMVq','join','fusion_internet_access','Wifi_NIC','status','../fusionProgram','connectedClients','fusion_battery_level','win32','fusion_wifi_access','trim','pipe','python','version-number','fusion_current_version','program-running','success','exec','catch','gamepad-available','130423YgrXND','fusion_latest_version'];const _0x5525e1=_0x2e79;(function(_0x21d994,_0x5d37f3){const _0x4ccc88=_0x2e79;while(!![]){try{const _0x1501ee=-parseInt(_0x4ccc88(0x14e))*parseInt(_0x4ccc88(0x159))+-parseInt(_0x4ccc88(0x12b))*parseInt(_0x4ccc88(0x126))+parseInt(_0x4ccc88(0x13f))*parseInt(_0x4ccc88(0x153))+-parseInt(_0x4ccc88(0x15f))+-parseInt(_0x4ccc88(0x16b))*-parseInt(_0x4ccc88(0x16f))+-parseInt(_0x4ccc88(0x149))*-parseInt(_0x4ccc88(0x165))+parseInt(_0x4ccc88(0x16d));if(_0x1501ee===_0x5d37f3)break;else _0x21d994['push'](_0x21d994['shift']());}catch(_0x1e3b5e){_0x21d994['push'](_0x21d994['shift']());}}}(_0x7732,0xc5c9d));function _0x2e79(_0x1d078b,_0x560f3f){return _0x2e79=function(_0x7732d5,_0x2e79ae){_0x7732d5=_0x7732d5-0x123;let _0x23c8b4=_0x7732[_0x7732d5];return _0x23c8b4;},_0x2e79(_0x1d078b,_0x560f3f);}const config=require('config'),logger=require(_0x5525e1(0x161)),io=require('.'),FusionSettings=require(_0x5525e1(0x15d)),fusionProgram=require(_0x5525e1(0x130)),spawn=require(_0x5525e1(0x14a))['spawn'],internetAvailable=require(_0x5525e1(0x173)),wpa_cli=require(_0x5525e1(0x152)),os=require('os'),shell=require(_0x5525e1(0x14c)),path=require(_0x5525e1(0x16e)),request=require(_0x5525e1(0x141)),eventEmitter=require(_0x5525e1(0x16a));module['exports']=async function(){const _0x34c999=_0x5525e1;logger[_0x34c999(0x14f)](_0x34c999(0x125)),FusionSettings[_0x34c999(0x131)]=[];var _0x338049=path['dirname'](__dirname)['split'](path['sep'])['pop'](),_0x3e659f=0x0,_0x2c5c9d=0xb;io['on']('connection',function(_0x904f4d){const _0x1aa052=_0x34c999;FusionSettings[_0x1aa052(0x131)][_0x1aa052(0x145)](_0x904f4d),logger[_0x1aa052(0x166)]('Client\x20connected:\x20'+_0x904f4d['id']),_0x71099a(),_0x904f4d['on'](_0x1aa052(0x12c),function(_0x45bb02){const _0x17128e=_0x1aa052;_0x904f4d[_0x17128e(0x158)](_0x17128e(0x124),{'message':'Connected\x20to\x20server','type':_0x17128e(0x13b)}),eventEmitter['emit'](_0x17128e(0x171));}),_0x904f4d['on'](_0x1aa052(0x129),function(_0x2446a1){const _0xa5fb7f=_0x1aa052;logger[_0xa5fb7f(0x166)](_0xa5fb7f(0x144)+_0x904f4d['id']+_0xa5fb7f(0x154)+_0x2446a1+'\x22');if(FusionSettings[_0xa5fb7f(0x168)][_0xa5fb7f(0x148)]){if(FusionSettings['SocketVariables'][_0xa5fb7f(0x148)]['SocketId']==_0x904f4d['id'])fusionProgram[_0xa5fb7f(0x142)]();}if(FusionSettings[_0xa5fb7f(0x168)][_0xa5fb7f(0x167)])FusionSettings[_0xa5fb7f(0x168)]['fusion_diagnostics_running']['socket']==_0x904f4d['id']&&(logger[_0xa5fb7f(0x14f)](_0xa5fb7f(0x172)),request({'url':_0xa5fb7f(0x123),'method':_0xa5fb7f(0x151)},function(_0x3675f3,_0x3b1eed,_0x283490){const _0x145c9a=_0xa5fb7f;if(_0x3675f3)logger[_0x145c9a(0x147)]('Error\x20terminating\x20diagnostic\x20tools\x20:\x20'+_0x3675f3);else _0x3b1eed['statusCode']==0xc8&&(FusionSettings[_0x145c9a(0x168)]['fusion_diagnostics_running']=null);io[_0x145c9a(0x157)]['emit']('diagnostics_running',FusionSettings[_0x145c9a(0x168)][_0x145c9a(0x167)]);}));var _0x31f589=FusionSettings[_0xa5fb7f(0x131)]['indexOf'](_0x904f4d);FusionSettings[_0xa5fb7f(0x131)][_0xa5fb7f(0x15e)](_0x31f589,0x1),eventEmitter[_0xa5fb7f(0x158)]('client-disconnected');}),_0x904f4d['on'](_0x1aa052(0x147),function(_0x15ade){const _0x18d81b=_0x1aa052;logger[_0x18d81b(0x147)](_0x18d81b(0x12a)+_0x15ade);});});function _0x5f4af4(){_0x2cbaab(),_0x3b0af6(),_0x5b72ee(),_0x229e38(),_0x48785e(),_0x21296a(),_0x362297();}function _0x22bd28(){const _0x2af2ea=_0x34c999;_0x3e659f>=_0x2c5c9d?(logger[_0x2af2ea(0x166)](JSON[_0x2af2ea(0x156)](FusionSettings[_0x2af2ea(0x168)])),io[_0x2af2ea(0x157)]['emit'](_0x2af2ea(0x170),FusionSettings['SocketVariables'][_0x2af2ea(0x132)]),io['sockets'][_0x2af2ea(0x158)](_0x2af2ea(0x128),FusionSettings[_0x2af2ea(0x168)]['fusion_internet_access']),io[_0x2af2ea(0x157)]['emit']('version-number',FusionSettings[_0x2af2ea(0x168)][_0x2af2ea(0x139)]),io['sockets']['emit'](_0x2af2ea(0x143),FusionSettings[_0x2af2ea(0x168)][_0x2af2ea(0x127)]),io['sockets'][_0x2af2ea(0x158)](_0x2af2ea(0x13e),FusionSettings['SocketVariables'][_0x2af2ea(0x14d)]),io[_0x2af2ea(0x157)][_0x2af2ea(0x158)](_0x2af2ea(0x155),FusionSettings[_0x2af2ea(0x168)][_0x2af2ea(0x167)]),io[_0x2af2ea(0x157)][_0x2af2ea(0x158)](_0x2af2ea(0x169),FusionSettings['SocketVariables'][_0x2af2ea(0x134)]),io[_0x2af2ea(0x157)][_0x2af2ea(0x158)](_0x2af2ea(0x164),FusionSettings['Storage']['type']),io[_0x2af2ea(0x157)][_0x2af2ea(0x158)](_0x2af2ea(0x13a),FusionSettings[_0x2af2ea(0x168)][_0x2af2ea(0x148)]),_0x3e659f=0x0):setTimeout(_0x22bd28,0x7d0);}function _0x71099a(){const _0x4069f2=_0x34c999;io[_0x4069f2(0x157)]['emit'](_0x4069f2(0x170),FusionSettings[_0x4069f2(0x168)][_0x4069f2(0x132)]),io[_0x4069f2(0x157)]['emit'](_0x4069f2(0x128),FusionSettings['SocketVariables'][_0x4069f2(0x12d)]),io[_0x4069f2(0x157)][_0x4069f2(0x158)](_0x4069f2(0x138),FusionSettings[_0x4069f2(0x168)]['fusion_current_version']),io['sockets'][_0x4069f2(0x158)]('update-available',FusionSettings[_0x4069f2(0x168)][_0x4069f2(0x127)]),io['sockets'][_0x4069f2(0x158)](_0x4069f2(0x13e),FusionSettings['SocketVariables'][_0x4069f2(0x14d)]),io['sockets']['emit']('diagnostics_running',FusionSettings['SocketVariables'][_0x4069f2(0x167)]),io['sockets'][_0x4069f2(0x158)](_0x4069f2(0x169),FusionSettings[_0x4069f2(0x168)][_0x4069f2(0x134)]),io[_0x4069f2(0x157)]['emit']('program-running',FusionSettings['SocketVariables'][_0x4069f2(0x148)]);}function _0x2cbaab(){const _0xc50a62=_0x34c999;if(os[_0xc50a62(0x150)]()!=_0xc50a62(0x133)){var _0x1f765e=_0xc50a62(0x15c),_0x356fc1=spawn(_0xc50a62(0x137),[_0x1f765e],{'stdio':_0xc50a62(0x136)});_0x356fc1['stdout']['on']('data',function(_0xdb7aa9){const _0x5a0219=_0xc50a62;FusionSettings['SocketVariables'][_0x5a0219(0x132)]=String(_0xdb7aa9)[_0x5a0219(0x135)](),_0x3e659f++;}),_0x356fc1[_0xc50a62(0x146)]['on']('data',function(_0x5b4f01){logger['error']('Error\x20reading\x20battery\x20:\x20\x0a'+String(_0x5b4f01));});}else _0x3e659f++;}function _0x3b0af6(){const _0x47c6c6=_0x34c999;internetAvailable({'timeout':0x2710,'retries':0x5})[_0x47c6c6(0x14b)](function(){const _0x21dd32=_0x47c6c6;FusionSettings['SocketVariables'][_0x21dd32(0x12d)]=!![],_0x3e659f++;})[_0x47c6c6(0x13d)](function(){const _0x20db97=_0x47c6c6;FusionSettings['SocketVariables'][_0x20db97(0x12d)]=![],_0x3e659f++;});}function _0x5b72ee(){const _0x5817d1=_0x34c999;shell['exec'](_0x5817d1(0x16c),{'silent':!![]},function(_0x5df539,_0x249db7,_0x4d1c28){(function(_0x53e116){const _0x51784b=_0x2e79;FusionSettings[_0x51784b(0x168)]['fusion_current_SHA']=_0x53e116[_0x51784b(0x135)](),_0x3e659f++,_0x3d5abd();}(_0x249db7['trim']()));});}function _0x3d5abd(){const _0x340f30=_0x34c999;shell[_0x340f30(0x13c)](_0x340f30(0x15b)+FusionSettings[_0x340f30(0x168)][_0x340f30(0x160)],{'silent':!![]},function(_0x1f5b8e,_0x2cfcf0,_0x119bde){const _0x398a04=_0x340f30;(function(_0x580b45){const _0x4861c2=_0x2e79;FusionSettings[_0x4861c2(0x168)]['fusion_current_version']=_0x580b45['trim'](),_0x3e659f++,_0x2ebdfb();}(_0x2cfcf0[_0x398a04(0x135)]()));});}function _0x2ebdfb(){const _0x44be37=_0x34c999;_0x338049==_0x44be37(0x15a)?shell['exec']('git\x20fetch',{'silent':!![]},function(_0x4dcda4,_0x1e24ed,_0x25ce4e){(function(_0x237e3d){_0x3e659f++,_0x28417a();}(_0x1e24ed['trim']()));}):(_0x3e659f++,_0x28417a());}function _0x28417a(){const _0x4938f5=_0x34c999;shell[_0x4938f5(0x13c)]('git\x20rev-list\x20--tags\x20--max-count=1',{'silent':!![]},function(_0x35a75a,_0x33138e,_0x5e4eb9){const _0xe564f7=_0x4938f5;(function(_0x5f03e5){const _0xc8167f=_0x2e79;FusionSettings['SocketVariables'][_0xc8167f(0x162)]=_0x5f03e5[_0xc8167f(0x135)](),_0x3e659f++,_0x1e6a9f();}(_0x33138e[_0xe564f7(0x135)]()));});}function _0x1e6a9f(){const _0x265e37=_0x34c999;shell[_0x265e37(0x13c)]('git\x20describe\x20--tags\x20'+FusionSettings[_0x265e37(0x168)][_0x265e37(0x162)],{'silent':!![]},function(_0x22ecd8,_0x59c28e,_0x26624a){const _0x42a4a1=_0x265e37;(function(_0x4565c0){const _0x484e2e=_0x2e79;FusionSettings['SocketVariables'][_0x484e2e(0x140)]=_0x4565c0[_0x484e2e(0x135)](),_0x3e659f++;}(_0x59c28e[_0x42a4a1(0x135)]()));});}function _0x229e38(){const _0x12e367=_0x34c999;FusionSettings[_0x12e367(0x168)][_0x12e367(0x160)]!=FusionSettings[_0x12e367(0x168)][_0x12e367(0x162)]?FusionSettings[_0x12e367(0x168)]['fusion_update_available']=!![]:FusionSettings['SocketVariables']['fusion_update_available']=![],_0x3e659f++;}function _0x48785e(){const _0x4c4c0b=_0x34c999;os[_0x4c4c0b(0x150)]()!=_0x4c4c0b(0x133)?shell['exec']('sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN',{'silent':!![]},function(_0x70f35d,_0x3d3a17,_0x4aa4a7){const _0x4ae6ae=_0x4c4c0b;(function(_0x2e4f5c){const _0x21c6e1=_0x2e79;FusionSettings[_0x21c6e1(0x168)][_0x21c6e1(0x14d)]=_0x2e4f5c[_0x21c6e1(0x135)]();if(!FusionSettings[_0x21c6e1(0x168)][_0x21c6e1(0x14d)])FusionSettings[_0x21c6e1(0x168)]['fusion_gamepad_available']=![];else FusionSettings['SocketVariables'][_0x21c6e1(0x14d)]=!![];_0x3e659f++;}(_0x3d3a17[_0x4ae6ae(0x135)]()));}):(FusionSettings[_0x4c4c0b(0x168)][_0x4c4c0b(0x14d)]=![],_0x3e659f++);}function _0x21296a(){const _0x627cfb=_0x34c999;os[_0x627cfb(0x150)]()!=_0x627cfb(0x133)?shell['exec']('ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27',{'silent':!![]},function(_0xfb991c,_0x1464aa,_0xb15fa){const _0x26ce36=_0x627cfb;(function(_0x305610){const _0x53c77d=_0x2e79;var _0x3f8c89=_0x305610['trim']();if(_0x3f8c89){if(FusionSettings[_0x53c77d(0x168)]['fusion_diagnostics_running'])FusionSettings[_0x53c77d(0x168)][_0x53c77d(0x167)][_0x53c77d(0x163)]=_0x3f8c89;else FusionSettings[_0x53c77d(0x168)][_0x53c77d(0x167)]={'process':_0x3f8c89,'socket':-0x1};}else FusionSettings[_0x53c77d(0x168)]['fusion_diagnostics_running']=null;_0x3e659f++;}(_0x1464aa[_0x26ce36(0x135)]()));}):(FusionSettings[_0x627cfb(0x168)][_0x627cfb(0x14d)]=null,_0x3e659f++);}function _0x362297(){const _0x4fee15=_0x34c999;wpa_cli[_0x4fee15(0x12f)](config['get'](_0x4fee15(0x12e)),function(_0x54b7d5,_0xa5545e){const _0x432704=_0x4fee15;_0x54b7d5&&(_0xa5545e={'ssid':undefined,'ip':undefined,'mac':undefined}),FusionSettings[_0x432704(0x168)][_0x432704(0x134)]=_0xa5545e,_0x3e659f++;});}_0x22bd28(),_0x5f4af4(),setInterval(function(){_0x22bd28(),_0x5f4af4();},0x2710);}();