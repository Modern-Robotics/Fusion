const _0x3fad=['pop','process','Socket\x20error\x20-\x20','platform','connectedClients','exec','fusion_wifi_access','git\x20rev-list\x20--tags\x20--max-count=1','child_process','fusion_latest_version','connection','fusion_latest_SHA','diagnostics_running','gamepad-available','git\x20describe\x20--tags\x20','sudo\x20netstat\x20-panp\x20|\x20grep\x205000\x20|\x20grep\x20LISTEN','stderr','Wifi_NIC','emit','git\x20rev-parse\x20HEAD','wifi-fusion_storage_type','internet-access','../fusionProgram','GET','push','battery-level','dirname','stringify','version-number','git\x20fetch','fusion_program_running','Client\x20disconnected:\x20','join','verbose','fusion_diagnostics_running','split','socket','get','Error\x20reading\x20battery\x20:\x20\x0a','spawn','update-available','fusion_internet_access','type','Storage','SocketId','python','\x20because\x20\x22','fusion_current_SHA','http://localhost:8080/api/diagnostics/stop','program-running','../utils/logger','Connected\x20to\x20server','KillProgram','fusion_battery_level','fusion_gamepad_available','SocketVariables','fusion_update_available','debug','request','splice','Client\x20connected:\x20','sep','stdout','Configuring\x20socket\x20communication','trim','internet-available','win32','shelljs','wifi-connection','../global/fusionSettings','sockets','disconnect','pipe','exports','data','fusion_current_version','error'];(function(_0x12c6ba,_0x3fadac){const _0x5405d8=function(_0x59a906){while(--_0x59a906){_0x12c6ba['push'](_0x12c6ba['shift']());}};_0x5405d8(++_0x3fadac);}(_0x3fad,0xb2));const _0x5405=function(_0x12c6ba,_0x3fadac){_0x12c6ba=_0x12c6ba-0x0;let _0x5405d8=_0x3fad[_0x12c6ba];return _0x5405d8;};const config=require('config');const logger=require(_0x5405('0x1a'));const io=require('.');const FusionSettings=require(_0x5405('0x2d'));const fusionProgram=require(_0x5405('0x4b'));const spawn=require(_0x5405('0x3d'))[_0x5405('0xf')];const internetAvailable=require(_0x5405('0x29'));const wpa_cli=require('wireless-tools/wpa_cli');const os=require('os');const shell=require(_0x5405('0x2b'));const path=require('path');const request=require(_0x5405('0x22'));module[_0x5405('0x31')]=async function(){logger[_0x5405('0x9')](_0x5405('0x27'));FusionSettings[_0x5405('0x39')]=[];var _0x4756c0=path[_0x5405('0x2')](__dirname)[_0x5405('0xb')](path[_0x5405('0x25')])[_0x5405('0x35')]();var _0xbfab21=0x0;var _0x309184=0xb;io['on'](_0x5405('0x3f'),function(_0x3a21f3){FusionSettings['connectedClients'][_0x5405('0x0')](_0x3a21f3);logger['debug'](_0x5405('0x24')+_0x3a21f3['id']);_0x5725ee();_0x3a21f3['on'](_0x5405('0x8'),function(_0x5b027e){_0x3a21f3[_0x5405('0x47')]('global-message',{'message':_0x5405('0x1b'),'type':'success'});});_0x3a21f3['on'](_0x5405('0x2f'),function(_0x5162f0){logger[_0x5405('0x21')](_0x5405('0x7')+_0x3a21f3['id']+_0x5405('0x16')+_0x5162f0+'\x22');if(FusionSettings[_0x5405('0x1f')]['fusion_program_running'])if(FusionSettings[_0x5405('0x1f')][_0x5405('0x6')][_0x5405('0x14')]==_0x3a21f3['id'])fusionProgram[_0x5405('0x1c')]();if(FusionSettings['SocketVariables']['fusion_diagnostics_running'])if(FusionSettings[_0x5405('0x1f')][_0x5405('0xa')][_0x5405('0xc')]==_0x3a21f3['id']){logger[_0x5405('0x9')]('Terminating\x20diagnostic\x20tools\x20due\x20to\x20absent\x20client');request({'url':_0x5405('0x18'),'method':_0x5405('0x4c')},function(_0x26eecc,_0x54839d,_0x150e31){if(_0x26eecc)logger['error']('Error\x20terminating\x20diagnostic\x20tools\x20:\x20'+_0x26eecc);else{if(_0x54839d['statusCode']==0xc8){FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]=null;}}io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x41'),FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]);});}var _0x4dc384=FusionSettings[_0x5405('0x39')]['indexOf'](_0x3a21f3);FusionSettings[_0x5405('0x39')][_0x5405('0x23')](_0x4dc384,0x1);});_0x3a21f3['on'](_0x5405('0x34'),function(_0x473495){logger[_0x5405('0x34')](_0x5405('0x37')+_0x473495);});});function _0x3a395e(){_0x1eb73a();_0x28470e();_0x4c338d();_0x1e3f87();_0x4bca3f();_0x2df32e();_0x41fa3d();}function _0x459f87(){if(_0xbfab21>=_0x309184){logger[_0x5405('0x21')](JSON[_0x5405('0x3')](FusionSettings[_0x5405('0x1f')]));io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x1'),FusionSettings[_0x5405('0x1f')][_0x5405('0x1d')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x4a'),FusionSettings['SocketVariables'][_0x5405('0x11')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x4'),FusionSettings[_0x5405('0x1f')][_0x5405('0x33')]);io[_0x5405('0x2e')]['emit']('update-available',FusionSettings[_0x5405('0x1f')][_0x5405('0x20')]);io[_0x5405('0x2e')]['emit'](_0x5405('0x42'),FusionSettings[_0x5405('0x1f')][_0x5405('0x1e')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x41'),FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]);io[_0x5405('0x2e')][_0x5405('0x47')]('wifi-connection',FusionSettings[_0x5405('0x1f')]['fusion_wifi_access']);io[_0x5405('0x2e')]['emit'](_0x5405('0x49'),FusionSettings[_0x5405('0x13')][_0x5405('0x12')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x19'),FusionSettings['SocketVariables']['fusion_program_running']);_0xbfab21=0x0;}else{setTimeout(_0x459f87,0x7d0);}}function _0x5725ee(){io['sockets'][_0x5405('0x47')](_0x5405('0x1'),FusionSettings[_0x5405('0x1f')][_0x5405('0x1d')]);io['sockets'][_0x5405('0x47')](_0x5405('0x4a'),FusionSettings['SocketVariables']['fusion_internet_access']);io['sockets'][_0x5405('0x47')]('version-number',FusionSettings[_0x5405('0x1f')][_0x5405('0x33')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x10'),FusionSettings['SocketVariables'][_0x5405('0x20')]);io['sockets'][_0x5405('0x47')](_0x5405('0x42'),FusionSettings[_0x5405('0x1f')][_0x5405('0x1e')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x41'),FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]);io[_0x5405('0x2e')][_0x5405('0x47')](_0x5405('0x2c'),FusionSettings['SocketVariables'][_0x5405('0x3b')]);io[_0x5405('0x2e')][_0x5405('0x47')]('program-running',FusionSettings[_0x5405('0x1f')][_0x5405('0x6')]);}function _0x1eb73a(){if(os['platform']()!=_0x5405('0x2a')){var _0xf7a87a='./scripts/ReadBatt.py';var _0x15a0bc=spawn(_0x5405('0x15'),[_0xf7a87a],{'stdio':_0x5405('0x30')});_0x15a0bc[_0x5405('0x26')]['on'](_0x5405('0x32'),function(_0x32ebc2){FusionSettings['SocketVariables'][_0x5405('0x1d')]=String(_0x32ebc2)[_0x5405('0x28')]();_0xbfab21++;});_0x15a0bc[_0x5405('0x45')]['on'](_0x5405('0x32'),function(_0x32d0f3){logger['error'](_0x5405('0xe')+String(_0x32d0f3));});}else{_0xbfab21++;}}function _0x28470e(){internetAvailable({'timeout':0x2710,'retries':0x5})['then'](function(){FusionSettings[_0x5405('0x1f')][_0x5405('0x11')]=!![];_0xbfab21++;})['catch'](function(){FusionSettings['SocketVariables'][_0x5405('0x11')]=![];_0xbfab21++;});}function _0x4c338d(){shell[_0x5405('0x3a')](_0x5405('0x48'),{'silent':!![]},function(_0x58f091,_0x349252,_0x346c2d){(function(_0x66fcb3){FusionSettings[_0x5405('0x1f')][_0x5405('0x17')]=_0x66fcb3['trim']();_0xbfab21++;_0x12d9f9();}(_0x349252['trim']()));});}function _0x12d9f9(){shell[_0x5405('0x3a')](_0x5405('0x43')+FusionSettings[_0x5405('0x1f')][_0x5405('0x17')],{'silent':!![]},function(_0x3c08f1,_0x19c6e0,_0x1c4d7c){(function(_0x37c118){FusionSettings[_0x5405('0x1f')]['fusion_current_version']=_0x37c118[_0x5405('0x28')]();_0xbfab21++;_0x1cb437();}(_0x19c6e0[_0x5405('0x28')]()));});}function _0x1cb437(){if(_0x4756c0=='Build'){shell[_0x5405('0x3a')](_0x5405('0x5'),{'silent':!![]},function(_0x202f57,_0x491632,_0x51d502){(function(_0x26e607){_0xbfab21++;_0x526e93();}(_0x491632[_0x5405('0x28')]()));});}else{_0xbfab21++;_0x526e93();}}function _0x526e93(){shell[_0x5405('0x3a')](_0x5405('0x3c'),{'silent':!![]},function(_0x57452d,_0x45732e,_0x358c37){(function(_0x5e5ac5){FusionSettings[_0x5405('0x1f')][_0x5405('0x40')]=_0x5e5ac5['trim']();_0xbfab21++;_0x3dfbb1();}(_0x45732e[_0x5405('0x28')]()));});}function _0x3dfbb1(){shell[_0x5405('0x3a')](_0x5405('0x43')+FusionSettings['SocketVariables'][_0x5405('0x40')],{'silent':!![]},function(_0x5826a2,_0x1a1cc6,_0x16cc89){(function(_0x230419){FusionSettings[_0x5405('0x1f')][_0x5405('0x3e')]=_0x230419[_0x5405('0x28')]();_0xbfab21++;}(_0x1a1cc6[_0x5405('0x28')]()));});}function _0x1e3f87(){if(FusionSettings['SocketVariables'][_0x5405('0x17')]!=FusionSettings[_0x5405('0x1f')]['fusion_latest_SHA']){FusionSettings[_0x5405('0x1f')][_0x5405('0x20')]=!![];}else{FusionSettings[_0x5405('0x1f')][_0x5405('0x20')]=![];}_0xbfab21++;}function _0x4bca3f(){if(os[_0x5405('0x38')]()!=_0x5405('0x2a')){shell['exec'](_0x5405('0x44'),{'silent':!![]},function(_0xe48613,_0x2360e2,_0x5f3acb){(function(_0x210e19){FusionSettings['SocketVariables'][_0x5405('0x1e')]=_0x210e19[_0x5405('0x28')]();if(!FusionSettings['SocketVariables']['fusion_gamepad_available'])FusionSettings['SocketVariables'][_0x5405('0x1e')]=![];else FusionSettings[_0x5405('0x1f')]['fusion_gamepad_available']=!![];_0xbfab21++;}(_0x2360e2[_0x5405('0x28')]()));});}else{FusionSettings[_0x5405('0x1f')][_0x5405('0x1e')]=![];_0xbfab21++;}}function _0x2df32e(){if(os[_0x5405('0x38')]()!=_0x5405('0x2a')){shell['exec']('ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27',{'silent':!![]},function(_0x1c243a,_0x3465da,_0x2031b3){(function(_0x2e34a6){var _0x5f487d=_0x2e34a6[_0x5405('0x28')]();if(_0x5f487d){if(FusionSettings['SocketVariables'][_0x5405('0xa')])FusionSettings[_0x5405('0x1f')][_0x5405('0xa')][_0x5405('0x36')]=_0x5f487d;else{FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]={'process':_0x5f487d,'socket':-0x1};}}else FusionSettings[_0x5405('0x1f')][_0x5405('0xa')]=null;_0xbfab21++;}(_0x3465da['trim']()));});}else{FusionSettings[_0x5405('0x1f')][_0x5405('0x1e')]=null;_0xbfab21++;}}function _0x41fa3d(){wpa_cli['status'](config[_0x5405('0xd')](_0x5405('0x46')),function(_0x2426ad,_0x4f63e9){if(_0x2426ad){_0x4f63e9={'ssid':undefined,'ip':undefined,'mac':undefined};}FusionSettings[_0x5405('0x1f')]['fusion_wifi_access']=_0x4f63e9;_0xbfab21++;});}_0x459f87();_0x3a395e();setInterval(function(){_0x459f87();_0x3a395e();},0x2710);}();