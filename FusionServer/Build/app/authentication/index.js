!function(){const e=require("passport"),n=require("passport-local").Strategy,s=require("../models/user");module.exports=(e.serializeUser((function(e,n){n(null,e.id)})),e.deserializeUser((function(e,n){s.findById(e,(function(e,s){n(e,s)}))})),e.use("local-signup",new n({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(e,n,r,a){s.findOne({username:n.toLowerCase().trim()},(async function(i,u){if(i)return a(i);if(u)return a(null,u,{message:"REGISTER.ALREADY_EXISTS"});var o=new s(e.body);o.username=n,o.password=o.generateHash(r),o.filepath=await o.generateFileSystem(o.username),o.save((function(e){if(e)throw e;return a(null,o)}))}))}))),e.use("local-login",new n({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(e,n,r,a){s.findOne({username:n.toLowerCase().trim()},(function(e,n){return e?a(e):n&&n.validPassword(r)?a(null,n):a(null,!1,{message:"LOGIN.INVALID"})}))}))),void e.use("local-recovery",new n({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(e,n,r,a){s.findOne({username:n.toLowerCase().trim()},(function(n,s){return n?a(n):s&&s.validSecurityAnswer(e.body.securityanswer)?a(null,s):a(null,!1)}))}))))}();