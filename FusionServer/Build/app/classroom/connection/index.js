const _0x1e8e=['Already\x20connected\x20to\x20classroom\x20network','substr','Fallback\x20network\x20found:\x20','connected','../sockets','currentNetwork','stdout','exec','wifiStatus','Connecting\x20classroom\x20socket\x20communication','stringify','Gateway\x20found\x20at:\x20','community_access','status','passphrase','On\x20hidden\x20network,\x20rechecking\x20community\x20access','Checking\x20for\x20fallback\x20network','length','data','debug','Error\x20accessing\x20network\x20interface:\x20','trim','Not\x20part\x20of\x20the\x20classroom\x20community','Not\x20connected\x20to\x20classroom\x20network','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','config','CMMthgilxoBsecure','getMac','wifiInterface','warn','./../../utils/wireless','wifi','networks','fallBackNetwork','Unable\x20to\x20reach\x20classroom\x20community:\x20','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','../../utils/logger','Storing\x20fallback\x20network','fallbackNetwork','shelljs','No\x20fallback\x20network\x20found','eth0','wireless-tools/wpa_cli','serial','connectToNetwork','getmac','hiddenPassword','Next\x20network\x20is:\x20','Wifi\x20interface\x20status:\x20','ssid','\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27','Fusion\x20serial\x20number:\x20','hiddenSSID'];(function(_0x4ca003,_0x1e8ec0){const _0x37f1d3=function(_0x3fc451){while(--_0x3fc451){_0x4ca003['push'](_0x4ca003['shift']());}};_0x37f1d3(++_0x1e8ec0);}(_0x1e8e,0x1a6));const _0x37f1=function(_0x4ca003,_0x1e8ec0){_0x4ca003=_0x4ca003-0x0;let _0x37f1d3=_0x1e8e[_0x4ca003];return _0x37f1d3;};const config=require(_0x37f1('0x1b'));const logger=require(_0x37f1('0x26'));const rp=require('request-promise');const wpa_cli=require(_0x37f1('0x2c'));const mac=require(_0x37f1('0x2f'));const shell=require(_0x37f1('0x29'));const wireless=require(_0x37f1('0x20'));let classroomConnection={'wifiInterface':config['get']('Wifi_NIC'),'currentNetwork':0x0,'networks':[{'hiddenSSID':'MyBot_Gatekeeper_WiFi','hiddenPassword':_0x37f1('0x1c')}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection[_0x37f1('0x23')]=await getFallBackNetwork();classroomConnection[_0x37f1('0x2d')]=await getSerial();classroomConnection[_0x37f1('0xa')]=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x3cdeda,_0x270068)=>{mac[_0x37f1('0x1d')]({'iface':_0x37f1('0x2b')},function(_0x160e9f,_0xb9fe74){if(_0x160e9f){return _0x270068(_0x160e9f['message']);}else{let _0x3ef257=_0xb9fe74['split'](':')['join']('')[_0x37f1('0x3')](-0x6);logger[_0x37f1('0x15')](_0x37f1('0x0')+_0x3ef257);return _0x3cdeda(_0x3ef257);}});});};function getWifiStatus(){return new Promise((_0x62f635,_0x3665cc)=>{wpa_cli[_0x37f1('0xf')](classroomConnection[_0x37f1('0x1e')],function(_0x21e86a,_0x17d729){if(_0x21e86a){return _0x3665cc(_0x37f1('0x16')+_0x21e86a);}logger[_0x37f1('0x15')](_0x37f1('0x32')+JSON[_0x37f1('0xc')](_0x17d729));return _0x62f635(_0x17d729);});});};async function checkCommunityAccess(){const _0x2946e6=_0x37f1('0x1a')+classroomConnection[_0x37f1('0x1e')]+_0x37f1('0x34');const _0x9f9b36=await shell[_0x37f1('0x9')](_0x2946e6,{'silent':!![]})[_0x37f1('0x8')][_0x37f1('0x17')]();logger[_0x37f1('0x15')](_0x37f1('0xd')+_0x9f9b36);let _0x46a7d5={'uri':'https://'+_0x9f9b36+':8443/api/v1/connect/'+classroomConnection[_0x37f1('0x2d')],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0xec2ab9=await rp(_0x46a7d5);logger[_0x37f1('0x15')](JSON[_0x37f1('0xc')](_0xec2ab9));let _0x264def=![];if(_0xec2ab9['data']){_0x264def=_0xec2ab9[_0x37f1('0x14')][_0x37f1('0xe')];}if(_0x264def){let _0x27936e={'ssid':_0xec2ab9['wifi'][_0x37f1('0x33')],'passphrase':_0xec2ab9[_0x37f1('0x21')]['passphrase']};await checkIfOnClassroomNetwork(_0x27936e);}else{logger[_0x37f1('0x15')](_0x37f1('0x18'));await tryNextClassroomNetork();}}catch(_0x2c9a61){logger[_0x37f1('0x1f')](_0x37f1('0x24')+_0x2c9a61);await tryNextClassroomNetork();}};async function checkIfOnClassroomNetwork(_0xc11226){if(classroomConnection['wifiStatus']['ssid']==_0xc11226[_0x37f1('0x33')]){logger['debug'](_0x37f1('0x2'));await connectSockets();}else{logger[_0x37f1('0x15')](_0x37f1('0x19'));await connectToClassroomNetwork(_0xc11226);}};async function connectSockets(){logger[_0x37f1('0x15')](_0x37f1('0xb'));await require(_0x37f1('0x6'));connection[_0x37f1('0x5')]=!![];};async function connectToClassroomNetwork(_0x1478e5){try{logger[_0x37f1('0x15')]('Connecting\x20to\x20classroom:\x20'+_0x1478e5[_0x37f1('0x33')]);let _0x493dac={'ssid':_0x1478e5['ssid'],'password':_0x1478e5[_0x37f1('0x10')],'hidden':![]};await wireless[_0x37f1('0x2e')](_0x493dac);await connectSockets();}catch(_0x17bc7d){logger['warn']('Error\x20connecting\x20to\x20classroom\x20network:\x20'+_0x17bc7d);}};async function getFallBackNetwork(){return new Promise((_0xb85112,_0x4549eb)=>{let _0x1e90ca=null;if(_0x1e90ca){logger['debug'](_0x37f1('0x27'));}else{logger[_0x37f1('0x15')](_0x37f1('0x2a'));}return _0xb85112(null);});};async function restoreFallBackNetwork(){logger[_0x37f1('0x15')](_0x37f1('0x12'));if(classroomConnection[_0x37f1('0x28')]){logger[_0x37f1('0x15')](_0x37f1('0x4')+classroomConnection['fallbackNetwork']);}else{logger['debug'](_0x37f1('0x2a'));}};async function connectToHiddenClassroomNetwork(_0x5d773e){try{logger[_0x37f1('0x15')]('Connecting\x20to\x20hidden\x20classroom:\x20'+_0x5d773e[_0x37f1('0x1')]);let _0x32fdc4={'ssid':_0x5d773e[_0x37f1('0x1')],'password':_0x5d773e[_0x37f1('0x30')],'hidden':!![]};await wireless[_0x37f1('0x2e')](_0x32fdc4);logger[_0x37f1('0x15')](_0x37f1('0x11'));await checkCommunityAccess();}catch(_0x3e2bf5){logger[_0x37f1('0x1f')](_0x3e2bf5);await tryNextClassroomNetork();}};async function tryNextClassroomNetork(){logger[_0x37f1('0x15')]('Trying\x20next\x20hidden\x20classroom\x20network');let _0x183839=await getNextNetwork();if(_0x183839){logger[_0x37f1('0x15')](_0x37f1('0x31')+_0x183839[_0x37f1('0x1')]);await connectToHiddenClassroomNetwork(_0x183839);}else{logger[_0x37f1('0x15')](_0x37f1('0x25'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x50a5e0=null;if(classroomConnection[_0x37f1('0x7')]<classroomConnection[_0x37f1('0x22')][_0x37f1('0x13')])_0x50a5e0=classroomConnection['networks'][classroomConnection['currentNetwork']++];return _0x50a5e0;};module['exports']=connection;