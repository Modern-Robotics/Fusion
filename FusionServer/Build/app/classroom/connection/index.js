const _0x2cd8=['On\x20hidden\x20network,\x20rechecking\x20community\x20access','request-promise','Storing\x20fallback\x20network','exec','data','wifiStatus','fallbackNetwork','Error\x20connecting\x20to\x20classroom\x20network:\x20','Trying\x20next\x20hidden\x20classroom\x20network','Unable\x20to\x20reach\x20classroom\x20community:\x20','stringify','message','Connecting\x20to\x20classroom:\x20','Not\x20part\x20of\x20the\x20classroom\x20community','Already\x20connected\x20to\x20classroom\x20network','networks','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','wireless-tools/wpa_cli','join','No\x20fallback\x20network\x20found','Next\x20network\x20is:\x20','../../utils/logger','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','hiddenSSID','connectToNetwork','CMMthgilxoBsecure','Wifi\x20interface\x20status:\x20','currentNetwork','wifi','debug','Connecting\x20to\x20hidden\x20classroom:\x20','Fusion\x20serial\x20number:\x20','shelljs','config','./../../utils/wireless','Fallback\x20network\x20found:\x20','Checking\x20for\x20fallback\x20network','Gateway\x20found\x20at:\x20','stdout','hiddenPassword','Wifi_NIC','Not\x20connected\x20to\x20classroom\x20network','serial','https://','warn','get','ssid','../sockets'];(function(_0x5034ff,_0x2cd8a7){const _0x20f146=function(_0x36dfc6){while(--_0x36dfc6){_0x5034ff['push'](_0x5034ff['shift']());}};_0x20f146(++_0x2cd8a7);}(_0x2cd8,0x1b5));const _0x20f1=function(_0x5034ff,_0x2cd8a7){_0x5034ff=_0x5034ff-0x0;let _0x20f146=_0x2cd8[_0x5034ff];return _0x20f146;};const config=require(_0x20f1('0x1c'));const logger=require(_0x20f1('0x10'));const rp=require(_0x20f1('0x2c'));const wpa_cli=require(_0x20f1('0xc'));const mac=require('getmac');const shell=require(_0x20f1('0x1b'));const wireless=require(_0x20f1('0x1d'));let classroomConnection={'wifiInterface':config[_0x20f1('0x28')](_0x20f1('0x23')),'currentNetwork':0x0,'networks':[{'hiddenSSID':'MyBot_Gatekeeper_WiFi','hiddenPassword':_0x20f1('0x14')}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection['fallBackNetwork']=await getFallBackNetwork();classroomConnection[_0x20f1('0x25')]=await getSerial();classroomConnection[_0x20f1('0x0')]=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x14cc05,_0x3c5d7b)=>{mac['getMac']({'iface':'eth0'},function(_0x55a0c3,_0x2086d1){if(_0x55a0c3){return _0x3c5d7b(_0x55a0c3[_0x20f1('0x6')]);}else{let _0x3a0bba=_0x2086d1['split'](':')[_0x20f1('0xd')]('')['substr'](-0x6);logger[_0x20f1('0x18')](_0x20f1('0x1a')+_0x3a0bba);return _0x14cc05(_0x3a0bba);}});});};function getWifiStatus(){return new Promise((_0x4644a7,_0x26b007)=>{wpa_cli['status'](classroomConnection['wifiInterface'],function(_0x1d56f1,_0x39da53){if(_0x1d56f1){return _0x26b007('Error\x20accessing\x20network\x20interface:\x20'+_0x1d56f1);}logger['debug'](_0x20f1('0x15')+JSON['stringify'](_0x39da53));return _0x4644a7(_0x39da53);});});};async function checkCommunityAccess(){const _0x36d631=_0x20f1('0x11')+classroomConnection['wifiInterface']+'\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27';const _0x1db7c1=await shell[_0x20f1('0x2e')](_0x36d631,{'silent':!![]})[_0x20f1('0x21')]['trim']();logger[_0x20f1('0x18')](_0x20f1('0x20')+_0x1db7c1);let _0x437a4d={'uri':_0x20f1('0x26')+_0x1db7c1+':8443/api/v1/connect/'+classroomConnection[_0x20f1('0x25')],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x1e9d12=await rp(_0x437a4d);logger[_0x20f1('0x18')](JSON[_0x20f1('0x5')](_0x1e9d12));let _0x2f8832=![];if(_0x1e9d12[_0x20f1('0x2f')]){_0x2f8832=_0x1e9d12[_0x20f1('0x2f')]['community_access'];}if(_0x2f8832){let _0x5409c3={'ssid':_0x1e9d12['wifi']['ssid'],'passphrase':_0x1e9d12[_0x20f1('0x17')]['passphrase']};await checkIfOnClassroomNetwork(_0x5409c3);}else{logger[_0x20f1('0x18')](_0x20f1('0x8'));await tryNextClassroomNetork();}}catch(_0x3b2be7){logger[_0x20f1('0x27')](_0x20f1('0x4')+_0x3b2be7);await tryNextClassroomNetork();}};async function checkIfOnClassroomNetwork(_0x5c8150){if(classroomConnection['wifiStatus'][_0x20f1('0x29')]==_0x5c8150[_0x20f1('0x29')]){logger[_0x20f1('0x18')](_0x20f1('0x9'));await connectSockets();}else{logger[_0x20f1('0x18')](_0x20f1('0x24'));await connectToClassroomNetwork(_0x5c8150);}};async function connectSockets(){logger[_0x20f1('0x18')]('Connecting\x20classroom\x20socket\x20communication');await require(_0x20f1('0x2a'));connection['connected']=!![];};async function connectToClassroomNetwork(_0x3ded97){try{logger[_0x20f1('0x18')](_0x20f1('0x7')+_0x3ded97[_0x20f1('0x29')]);let _0x9e67e8={'ssid':_0x3ded97[_0x20f1('0x29')],'password':_0x3ded97['passphrase'],'hidden':![]};await wireless[_0x20f1('0x13')](_0x9e67e8);await connectSockets();}catch(_0x357d10){logger[_0x20f1('0x27')](_0x20f1('0x2')+_0x357d10);}};async function getFallBackNetwork(){return new Promise((_0x4d1431,_0x14fde2)=>{let _0x26edf7=null;if(_0x26edf7){logger[_0x20f1('0x18')](_0x20f1('0x2d'));}else{logger[_0x20f1('0x18')](_0x20f1('0xe'));}return _0x4d1431(null);});};async function restoreFallBackNetwork(){logger['debug'](_0x20f1('0x1f'));if(classroomConnection['fallbackNetwork']){logger['debug'](_0x20f1('0x1e')+classroomConnection[_0x20f1('0x1')]);}else{logger['debug']('No\x20fallback\x20network\x20found');}};async function connectToHiddenClassroomNetwork(_0x4b64c1){try{logger['debug'](_0x20f1('0x19')+_0x4b64c1['hiddenSSID']);let _0x553b19={'ssid':_0x4b64c1[_0x20f1('0x12')],'password':_0x4b64c1[_0x20f1('0x22')],'hidden':!![]};await wireless[_0x20f1('0x13')](_0x553b19);logger['debug'](_0x20f1('0x2b'));await checkCommunityAccess();}catch(_0x3ae921){logger[_0x20f1('0x27')](_0x3ae921);await tryNextClassroomNetork();}};async function tryNextClassroomNetork(){logger[_0x20f1('0x18')](_0x20f1('0x3'));let _0x455081=await getNextNetwork();if(_0x455081){logger[_0x20f1('0x18')](_0x20f1('0xf')+_0x455081[_0x20f1('0x12')]);await connectToHiddenClassroomNetwork(_0x455081);}else{logger[_0x20f1('0x18')](_0x20f1('0xb'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x185858=null;if(classroomConnection[_0x20f1('0x16')]<classroomConnection['networks']['length'])_0x185858=classroomConnection[_0x20f1('0xa')][classroomConnection[_0x20f1('0x16')]++];return _0x185858;};module['exports']=connection;