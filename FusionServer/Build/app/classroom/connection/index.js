const _0x3c04=['community_access','CMMthgilxoBsecure','warn','Trying\x20next\x20hidden\x20classroom\x20network','currentNetwork','getmac','hiddenSSID','split','stdout','fallbackNetwork','ssid','Checking\x20for\x20fallback\x20network','Connecting\x20classroom\x20socket\x20communication','request-promise','length',':8443/api/v1/connect/','join','MyBot_Gatekeeper_WiFi','connected','https://','eth0','debug','Not\x20connected\x20to\x20classroom\x20network','Wifi_NIC','../sockets','serial','passphrase','Error\x20accessing\x20network\x20interface:\x20','On\x20hidden\x20network,\x20rechecking\x20community\x20access','Connecting\x20to\x20hidden\x20classroom:\x20','trim','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','wifi','connectToNetwork','exec','status','No\x20fallback\x20network\x20found','Fusion\x20serial\x20number:\x20','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27','stringify','message','../../utils/logger','wifiInterface','networks','data','wireless-tools/wpa_cli','wifiStatus','Already\x20connected\x20to\x20classroom\x20network','Connecting\x20to\x20classroom:\x20','Error\x20connecting\x20to\x20classroom\x20network:\x20','shelljs','Not\x20part\x20of\x20the\x20classroom\x20community','./../../utils/wireless','Unable\x20to\x20reach\x20classroom\x20community:\x20'];(function(_0x36751c,_0x3c0444){const _0x308e3f=function(_0x4a0ad6){while(--_0x4a0ad6){_0x36751c['push'](_0x36751c['shift']());}};_0x308e3f(++_0x3c0444);}(_0x3c04,0x148));const _0x308e=function(_0x36751c,_0x3c0444){_0x36751c=_0x36751c-0x0;let _0x308e3f=_0x3c04[_0x36751c];return _0x308e3f;};const config=require('config');const logger=require(_0x308e('0x2c'));const rp=require(_0x308e('0xf'));const wpa_cli=require(_0x308e('0x30'));const mac=require(_0x308e('0x7'));const shell=require(_0x308e('0x35'));const wireless=require(_0x308e('0x0'));let classroomConnection={'wifiInterface':config['get'](_0x308e('0x19')),'currentNetwork':0x0,'networks':[{'hiddenSSID':_0x308e('0x13'),'hiddenPassword':_0x308e('0x3')}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection['fallBackNetwork']=await getFallBackNetwork();classroomConnection[_0x308e('0x1b')]=await getSerial();classroomConnection[_0x308e('0x31')]=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x224b1b,_0x2ebe94)=>{mac['getMac']({'iface':_0x308e('0x16')},function(_0x285d29,_0x26d9db){if(_0x285d29){return _0x2ebe94(_0x285d29[_0x308e('0x2b')]);}else{let _0x5508be=_0x26d9db[_0x308e('0x9')](':')[_0x308e('0x12')]('')['substr'](-0x6);logger[_0x308e('0x17')](_0x308e('0x27')+_0x5508be);return _0x224b1b(_0x5508be);}});});};function getWifiStatus(){return new Promise((_0x46f271,_0x7c353d)=>{wpa_cli[_0x308e('0x25')](classroomConnection[_0x308e('0x2d')],function(_0x39eb4e,_0x47f4f9){if(_0x39eb4e){return _0x7c353d(_0x308e('0x1d')+_0x39eb4e);}logger['debug']('Wifi\x20interface\x20status:\x20'+JSON[_0x308e('0x2a')](_0x47f4f9));return _0x46f271(_0x47f4f9);});});};async function checkCommunityAccess(){const _0x260c80=_0x308e('0x21')+classroomConnection[_0x308e('0x2d')]+_0x308e('0x29');const _0x50d35b=await shell[_0x308e('0x24')](_0x260c80,{'silent':!![]})[_0x308e('0xa')][_0x308e('0x20')]();logger[_0x308e('0x17')]('Gateway\x20found\x20at:\x20'+_0x50d35b);let _0x222c3d={'uri':_0x308e('0x15')+_0x50d35b+_0x308e('0x11')+classroomConnection['serial'],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x58011f=await rp(_0x222c3d);logger['debug'](JSON['stringify'](_0x58011f));let _0x3c1e73=![];if(_0x58011f[_0x308e('0x2f')]){_0x3c1e73=_0x58011f[_0x308e('0x2f')][_0x308e('0x2')];}if(_0x3c1e73){let _0x37e765={'ssid':_0x58011f[_0x308e('0x22')][_0x308e('0xc')],'passphrase':_0x58011f[_0x308e('0x22')][_0x308e('0x1c')]};await checkIfOnClassroomNetwork(_0x37e765);}else{logger['debug'](_0x308e('0x36'));await tryNextClassroomNetwork();}}catch(_0x29bc13){logger[_0x308e('0x4')](_0x308e('0x1')+_0x29bc13);await tryNextClassroomNetwork();}};async function checkIfOnClassroomNetwork(_0x4a8471){if(classroomConnection[_0x308e('0x31')][_0x308e('0xc')]==_0x4a8471[_0x308e('0xc')]){logger[_0x308e('0x17')](_0x308e('0x32'));await connectSockets();}else{logger[_0x308e('0x17')](_0x308e('0x18'));await connectToClassroomNetwork(_0x4a8471);}};async function connectSockets(){logger['debug'](_0x308e('0xe'));await require(_0x308e('0x1a'));connection[_0x308e('0x14')]=!![];};async function connectToClassroomNetwork(_0xdf95dd){try{logger[_0x308e('0x17')](_0x308e('0x33')+_0xdf95dd['ssid']);let _0x268622={'ssid':_0xdf95dd[_0x308e('0xc')],'password':_0xdf95dd[_0x308e('0x1c')],'hidden':![]};await wireless[_0x308e('0x23')](_0x268622);await connectSockets();}catch(_0x1b324d){logger[_0x308e('0x4')](_0x308e('0x34')+_0x1b324d);}};async function getFallBackNetwork(){return new Promise((_0x5118c4,_0x496289)=>{let _0x275449=null;if(_0x275449){logger['debug']('Storing\x20fallback\x20network');}else{logger[_0x308e('0x17')](_0x308e('0x26'));}return _0x5118c4(null);});};async function restoreFallBackNetwork(){logger['debug'](_0x308e('0xd'));if(classroomConnection[_0x308e('0xb')]){logger[_0x308e('0x17')]('Fallback\x20network\x20found:\x20'+classroomConnection['fallbackNetwork']);}else{logger[_0x308e('0x17')](_0x308e('0x26'));}};async function connectToHiddenClassroomNetwork(_0x354d4c){try{logger[_0x308e('0x17')](_0x308e('0x1f')+_0x354d4c[_0x308e('0x8')]);let _0x14166f={'ssid':_0x354d4c[_0x308e('0x8')],'password':_0x354d4c['hiddenPassword'],'hidden':!![]};await wireless[_0x308e('0x23')](_0x14166f);logger['debug'](_0x308e('0x1e'));await checkCommunityAccess();}catch(_0x5b82fa){logger['warn'](_0x5b82fa);await tryNextClassroomNetwork();}};async function tryNextClassroomNetwork(){logger[_0x308e('0x17')](_0x308e('0x5'));let _0x4e4371=await getNextNetwork();if(_0x4e4371){logger[_0x308e('0x17')]('Next\x20network\x20is:\x20'+_0x4e4371['hiddenSSID']);await connectToHiddenClassroomNetwork(_0x4e4371);}else{logger[_0x308e('0x17')](_0x308e('0x28'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x18c1e4=null;if(classroomConnection['currentNetwork']<classroomConnection[_0x308e('0x2e')][_0x308e('0x10')])_0x18c1e4=classroomConnection[_0x308e('0x2e')][classroomConnection[_0x308e('0x6')]++];return _0x18c1e4;};module['exports']=connection;