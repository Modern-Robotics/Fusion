const _0x5894=['data','hiddenSSID','hiddenPassword','trim','wifiInterface','message','Next\x20network\x20is:\x20','Gateway\x20found\x20at:\x20','wireless-tools/wpa_cli','debug','eth0','Not\x20part\x20of\x20the\x20classroom\x20community','networks','Connecting\x20classroom\x20socket\x20communication','./../../utils/wireless','Storing\x20fallback\x20network','shelljs','serial','CMMthgilxoBsecure','wifiStatus','MyBot_Gatekeeper_WiFi','Fusion\x20serial\x20number:\x20','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','Trying\x20next\x20hidden\x20classroom\x20network','length','community_access','status','exec','request-promise','fallBackNetwork','currentNetwork','join','passphrase','warn','stringify','../../utils/logger','No\x20fallback\x20network\x20found','Connecting\x20to\x20classroom:\x20','Wifi_NIC','connectToNetwork','Not\x20connected\x20to\x20classroom\x20network','Already\x20connected\x20to\x20classroom\x20network','wifi','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','config','Fallback\x20network\x20found:\x20','https://','ssid','Wifi\x20interface\x20status:\x20','Error\x20accessing\x20network\x20interface:\x20','fallbackNetwork','connected','split'];(function(_0x4d5a1d,_0x589420){const _0xea5e3=function(_0x236abd){while(--_0x236abd){_0x4d5a1d['push'](_0x4d5a1d['shift']());}};_0xea5e3(++_0x589420);}(_0x5894,0x1a9));const _0xea5e=function(_0x4d5a1d,_0x589420){_0x4d5a1d=_0x4d5a1d-0x0;let _0xea5e3=_0x5894[_0x4d5a1d];return _0xea5e3;};const config=require(_0xea5e('0x2b'));const logger=require(_0xea5e('0x22'));const rp=require(_0xea5e('0x1b'));const wpa_cli=require(_0xea5e('0x7'));const mac=require('getmac');const shell=require(_0xea5e('0xf'));const wireless=require(_0xea5e('0xd'));let classroomConnection={'wifiInterface':config['get'](_0xea5e('0x25')),'currentNetwork':0x0,'networks':[{'hiddenSSID':_0xea5e('0x13'),'hiddenPassword':_0xea5e('0x11')}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection[_0xea5e('0x1c')]=await getFallBackNetwork();classroomConnection[_0xea5e('0x10')]=await getSerial();classroomConnection[_0xea5e('0x12')]=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x5e0016,_0x9534ec)=>{mac['getMac']({'iface':_0xea5e('0x9')},function(_0x5557ac,_0x2b5994){if(_0x5557ac){return _0x9534ec(_0x5557ac[_0xea5e('0x4')]);}else{let _0x48c136=_0x2b5994[_0xea5e('0x33')](':')[_0xea5e('0x1e')]('')['substr'](-0x6);logger[_0xea5e('0x8')](_0xea5e('0x14')+_0x48c136);return _0x5e0016(_0x48c136);}});});};function getWifiStatus(){return new Promise((_0x5c62b1,_0x5665a7)=>{wpa_cli[_0xea5e('0x19')](classroomConnection[_0xea5e('0x3')],function(_0x3b0435,_0x5d4e46){if(_0x3b0435){return _0x5665a7(_0xea5e('0x30')+_0x3b0435);}logger['debug'](_0xea5e('0x2f')+JSON[_0xea5e('0x21')](_0x5d4e46));return _0x5c62b1(_0x5d4e46);});});};async function checkCommunityAccess(){const _0x1c47a0=_0xea5e('0x2a')+classroomConnection[_0xea5e('0x3')]+'\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27';const _0x2c74d1=await shell[_0xea5e('0x1a')](_0x1c47a0,{'silent':!![]})['stdout'][_0xea5e('0x2')]();logger[_0xea5e('0x8')](_0xea5e('0x6')+_0x2c74d1);let _0xbc14f5={'uri':_0xea5e('0x2d')+_0x2c74d1+':8443/api/v1/connect/'+classroomConnection['serial'],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x31f5f8=await rp(_0xbc14f5);logger[_0xea5e('0x8')](JSON['stringify'](_0x31f5f8));let _0x43bc58=![];if(_0x31f5f8[_0xea5e('0x34')]){_0x43bc58=_0x31f5f8['data'][_0xea5e('0x18')];}if(_0x43bc58){let _0x496cfe={'ssid':_0x31f5f8[_0xea5e('0x29')]['ssid'],'passphrase':_0x31f5f8['wifi'][_0xea5e('0x1f')]};await checkIfOnClassroomNetwork(_0x496cfe);}else{logger['debug'](_0xea5e('0xa'));await tryNextClassroomNetwork();}}catch(_0x5bf167){logger[_0xea5e('0x20')]('Unable\x20to\x20reach\x20classroom\x20community:\x20'+_0x5bf167);await tryNextClassroomNetwork();}};async function checkIfOnClassroomNetwork(_0x37bdf7){if(classroomConnection[_0xea5e('0x12')]['ssid']==_0x37bdf7[_0xea5e('0x2e')]){logger[_0xea5e('0x8')](_0xea5e('0x28'));await connectSockets();}else{logger[_0xea5e('0x8')](_0xea5e('0x27'));await connectToClassroomNetwork(_0x37bdf7);}};async function connectSockets(){logger[_0xea5e('0x8')](_0xea5e('0xc'));await require('../sockets');connection[_0xea5e('0x32')]=!![];};async function connectToClassroomNetwork(_0x52d714){try{logger[_0xea5e('0x8')](_0xea5e('0x24')+_0x52d714[_0xea5e('0x2e')]);let _0x3b98dd={'ssid':_0x52d714[_0xea5e('0x2e')],'password':_0x52d714[_0xea5e('0x1f')],'hidden':![]};await wireless[_0xea5e('0x26')](_0x3b98dd);await connectSockets();}catch(_0x373e08){logger['warn']('Error\x20connecting\x20to\x20classroom\x20network:\x20'+_0x373e08);}};async function getFallBackNetwork(){return new Promise((_0x5c5cfa,_0x247d85)=>{let _0x54c70d=null;if(_0x54c70d){logger[_0xea5e('0x8')](_0xea5e('0xe'));}else{logger[_0xea5e('0x8')](_0xea5e('0x23'));}return _0x5c5cfa(null);});};async function restoreFallBackNetwork(){logger[_0xea5e('0x8')]('Checking\x20for\x20fallback\x20network');if(classroomConnection[_0xea5e('0x31')]){logger[_0xea5e('0x8')](_0xea5e('0x2c')+classroomConnection[_0xea5e('0x31')]);}else{logger[_0xea5e('0x8')](_0xea5e('0x23'));}};async function connectToHiddenClassroomNetwork(_0x4abfc4){try{logger[_0xea5e('0x8')]('Connecting\x20to\x20hidden\x20classroom:\x20'+_0x4abfc4[_0xea5e('0x0')]);let _0x1146b4={'ssid':_0x4abfc4[_0xea5e('0x0')],'password':_0x4abfc4[_0xea5e('0x1')],'hidden':!![]};await wireless[_0xea5e('0x26')](_0x1146b4);logger['debug']('On\x20hidden\x20network,\x20rechecking\x20community\x20access');await checkCommunityAccess();}catch(_0x5c15e7){logger[_0xea5e('0x20')](_0x5c15e7);await tryNextClassroomNetwork();}};async function tryNextClassroomNetwork(){logger[_0xea5e('0x8')](_0xea5e('0x16'));let _0x1d026a=await getNextNetwork();if(_0x1d026a){logger[_0xea5e('0x8')](_0xea5e('0x5')+_0x1d026a[_0xea5e('0x0')]);await connectToHiddenClassroomNetwork(_0x1d026a);}else{logger[_0xea5e('0x8')](_0xea5e('0x15'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x58a494=null;if(classroomConnection[_0xea5e('0x1d')]<classroomConnection[_0xea5e('0xb')][_0xea5e('0x17')])_0x58a494=classroomConnection[_0xea5e('0xb')][classroomConnection[_0xea5e('0x1d')]++];return _0x58a494;};module['exports']=connection;