const _0x4e16=['getMac','config','split','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','ssid','Gateway\x20found\x20at:\x20','Already\x20connected\x20to\x20classroom\x20network','wifiInterface','eth0','exec','Unable\x20to\x20reach\x20classroom\x20community:\x20','debug','message','Fallback\x20network\x20found:\x20','Connecting\x20classroom\x20socket\x20communication','stdout','fallBackNetwork',':8443/api/v1/connect/','networks','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','trim','substr','./../../utils/wireless','Not\x20connected\x20to\x20classroom\x20network','Not\x20part\x20of\x20the\x20classroom\x20community','fallbackNetwork','status','https://','Wifi\x20interface\x20status:\x20','serial','Next\x20network\x20is:\x20','stringify','wifiStatus','../sockets','join','Storing\x20fallback\x20network','MyBot_Gatekeeper_WiFi','Fusion\x20serial\x20number:\x20','request-promise','Connecting\x20to\x20classroom:\x20','hiddenSSID','No\x20fallback\x20network\x20found','community_access','currentNetwork','passphrase','wifi','hiddenPassword','connected','connectToNetwork','shelljs','data','getmac','Connecting\x20to\x20hidden\x20classroom:\x20','Error\x20connecting\x20to\x20classroom\x20network:\x20'];(function(_0x35e2b0,_0x4e160e){const _0xf75b3c=function(_0x2a755b){while(--_0x2a755b){_0x35e2b0['push'](_0x35e2b0['shift']());}};_0xf75b3c(++_0x4e160e);}(_0x4e16,0x146));const _0xf75b=function(_0x35e2b0,_0x4e160e){_0x35e2b0=_0x35e2b0-0x0;let _0xf75b3c=_0x4e16[_0x35e2b0];return _0xf75b3c;};const config=require(_0xf75b('0x35'));const logger=require('../../utils/logger');const rp=require(_0xf75b('0x24'));const wpa_cli=require('wireless-tools/wpa_cli');const mac=require(_0xf75b('0x31'));const shell=require(_0xf75b('0x2f'));const wireless=require(_0xf75b('0x14'));let classroomConnection={'wifiInterface':config['get']('Wifi_NIC'),'currentNetwork':0x0,'networks':[{'hiddenSSID':_0xf75b('0x22'),'hiddenPassword':'CMMthgilxoBsecure'}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection[_0xf75b('0xe')]=await getFallBackNetwork();classroomConnection[_0xf75b('0x1b')]=await getSerial();classroomConnection[_0xf75b('0x1e')]=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x320c6d,_0x6581c5)=>{mac[_0xf75b('0x34')]({'iface':_0xf75b('0x6')},function(_0x58d5d6,_0x41ebcd){if(_0x58d5d6){return _0x6581c5(_0x58d5d6[_0xf75b('0xa')]);}else{let _0x1856b6=_0x41ebcd[_0xf75b('0x0')](':')[_0xf75b('0x20')]('')[_0xf75b('0x13')](-0x6);logger[_0xf75b('0x9')](_0xf75b('0x23')+_0x1856b6);return _0x320c6d(_0x1856b6);}});});};function getWifiStatus(){return new Promise((_0xf7079b,_0x143abd)=>{wpa_cli[_0xf75b('0x18')](classroomConnection[_0xf75b('0x5')],function(_0x3917e9,_0xba2b7c){if(_0x3917e9){return _0x143abd('Error\x20accessing\x20network\x20interface:\x20'+_0x3917e9);}logger[_0xf75b('0x9')](_0xf75b('0x1a')+JSON[_0xf75b('0x1d')](_0xba2b7c));return _0xf7079b(_0xba2b7c);});});};async function checkCommunityAccess(){const _0x131b4e=_0xf75b('0x1')+classroomConnection[_0xf75b('0x5')]+'\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27';const _0xfbd50f=await shell[_0xf75b('0x7')](_0x131b4e,{'silent':!![]})[_0xf75b('0xd')][_0xf75b('0x12')]();logger[_0xf75b('0x9')](_0xf75b('0x3')+_0xfbd50f);let _0x1bc1e4={'uri':_0xf75b('0x19')+_0xfbd50f+_0xf75b('0xf')+classroomConnection[_0xf75b('0x1b')],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x28c3de=await rp(_0x1bc1e4);logger['debug'](JSON[_0xf75b('0x1d')](_0x28c3de));let _0x5e3746=![];if(_0x28c3de[_0xf75b('0x30')]){_0x5e3746=_0x28c3de[_0xf75b('0x30')][_0xf75b('0x28')];}if(_0x5e3746){let _0xd2b39d={'ssid':_0x28c3de[_0xf75b('0x2b')][_0xf75b('0x2')],'passphrase':_0x28c3de['wifi']['passphrase']};await checkIfOnClassroomNetwork(_0xd2b39d);}else{logger[_0xf75b('0x9')](_0xf75b('0x16'));await tryNextClassroomNetork();}}catch(_0x53bf0b){logger['warn'](_0xf75b('0x8')+_0x53bf0b);await tryNextClassroomNetork();}};async function checkIfOnClassroomNetwork(_0x1276ad){if(classroomConnection[_0xf75b('0x1e')]['ssid']==_0x1276ad['ssid']){logger['debug'](_0xf75b('0x4'));await connectSockets();}else{logger['debug'](_0xf75b('0x15'));await connectToClassroomNetwork(_0x1276ad);}};async function connectSockets(){logger['debug'](_0xf75b('0xc'));await require(_0xf75b('0x1f'));connection[_0xf75b('0x2d')]=!![];};async function connectToClassroomNetwork(_0x3fd13c){try{logger[_0xf75b('0x9')](_0xf75b('0x25')+_0x3fd13c[_0xf75b('0x2')]);let _0x4ab74a={'ssid':_0x3fd13c[_0xf75b('0x2')],'password':_0x3fd13c[_0xf75b('0x2a')],'hidden':![]};await wireless[_0xf75b('0x2e')](_0x4ab74a);await connectSockets();}catch(_0x28d494){logger['warn'](_0xf75b('0x33')+_0x28d494);}};async function getFallBackNetwork(){return new Promise((_0x49103b,_0x39c65b)=>{let _0x149929=null;if(_0x149929){logger[_0xf75b('0x9')](_0xf75b('0x21'));}else{logger[_0xf75b('0x9')](_0xf75b('0x27'));}return _0x49103b(null);});};async function restoreFallBackNetwork(){logger[_0xf75b('0x9')]('Checking\x20for\x20fallback\x20network');if(classroomConnection[_0xf75b('0x17')]){logger[_0xf75b('0x9')](_0xf75b('0xb')+classroomConnection[_0xf75b('0x17')]);}else{logger['debug']('No\x20fallback\x20network\x20found');}};async function connectToHiddenClassroomNetwork(_0x559afb){try{logger[_0xf75b('0x9')](_0xf75b('0x32')+_0x559afb['hiddenSSID']);let _0x3a9e27={'ssid':_0x559afb[_0xf75b('0x26')],'password':_0x559afb[_0xf75b('0x2c')],'hidden':!![]};await wireless[_0xf75b('0x2e')](_0x3a9e27);logger['debug']('On\x20hidden\x20network,\x20rechecking\x20community\x20access');await checkCommunityAccess();}catch(_0x24624c){logger['warn'](_0x24624c);await tryNextClassroomNetork();}};async function tryNextClassroomNetork(){logger['debug']('Trying\x20next\x20hidden\x20classroom\x20network');let _0x2ddbdb=await getNextNetwork();if(_0x2ddbdb){logger[_0xf75b('0x9')](_0xf75b('0x1c')+_0x2ddbdb[_0xf75b('0x26')]);await connectToHiddenClassroomNetwork(_0x2ddbdb);}else{logger[_0xf75b('0x9')](_0xf75b('0x11'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x14959b=null;if(classroomConnection[_0xf75b('0x29')]<classroomConnection[_0xf75b('0x10')]['length'])_0x14959b=classroomConnection['networks'][classroomConnection[_0xf75b('0x29')]++];return _0x14959b;};module['exports']=connection;