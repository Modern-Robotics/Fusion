const _0x782e=['trim','eth0','ssid','\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27','Fusion\x20serial\x20number:\x20','Trying\x20next\x20hidden\x20classroom\x20network','Connecting\x20to\x20hidden\x20classroom:\x20','Not\x20part\x20of\x20the\x20classroom\x20community','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','currentNetwork','join','On\x20hidden\x20network,\x20rechecking\x20community\x20access','split','request-promise','warn','Connecting\x20to\x20classroom:\x20','get','debug','connected','hiddenPassword','Error\x20accessing\x20network\x20interface:\x20','fallbackNetwork','shelljs','config','Checking\x20for\x20fallback\x20network','hiddenSSID','Wifi\x20interface\x20status:\x20','length','Not\x20connected\x20to\x20classroom\x20network','wifiInterface','https://','stringify','connectToNetwork','wireless-tools/wpa_cli','getmac','serial','wifiStatus','networks','message','../../utils/logger','ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27','Wifi_NIC','No\x20fallback\x20network\x20found','wifi','substr','Gateway\x20found\x20at:\x20','getMac','exec','Unable\x20to\x20reach\x20classroom\x20community:\x20',':8443/api/v1/connect/','data','Fallback\x20network\x20found:\x20','passphrase','status'];(function(_0x1dfaf6,_0x782eea){const _0x470046=function(_0x3c3d73){while(--_0x3c3d73){_0x1dfaf6['push'](_0x1dfaf6['shift']());}};_0x470046(++_0x782eea);}(_0x782e,0xe2));const _0x4700=function(_0x1dfaf6,_0x782eea){_0x1dfaf6=_0x1dfaf6-0x0;let _0x470046=_0x782e[_0x1dfaf6];return _0x470046;};const config=require(_0x4700('0xd'));const logger=require(_0x4700('0x1d'));const rp=require(_0x4700('0x3'));const wpa_cli=require(_0x4700('0x17'));const mac=require(_0x4700('0x18'));const shell=require(_0x4700('0xc'));const wireless=require('./../../utils/wireless');let classroomConnection={'wifiInterface':config[_0x4700('0x6')](_0x4700('0x1f')),'currentNetwork':0x0,'networks':[{'hiddenSSID':'MyBot_Gatekeeper_WiFi','hiddenPassword':'CMMthgilxoBsecure'}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection['fallBackNetwork']=await getFallBackNetwork();classroomConnection[_0x4700('0x19')]=await getSerial();classroomConnection['wifiStatus']=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0x5b6d1c,_0x101cef)=>{mac[_0x4700('0x24')]({'iface':_0x4700('0x2d')},function(_0x46482b,_0x3ae54d){if(_0x46482b){return _0x101cef(_0x46482b[_0x4700('0x1c')]);}else{let _0x506423=_0x3ae54d[_0x4700('0x2')](':')[_0x4700('0x0')]('')[_0x4700('0x22')](-0x6);logger['debug'](_0x4700('0x30')+_0x506423);return _0x5b6d1c(_0x506423);}});});};function getWifiStatus(){return new Promise((_0x3732a1,_0x1c59b9)=>{wpa_cli[_0x4700('0x2b')](classroomConnection['wifiInterface'],function(_0x318549,_0x222a0d){if(_0x318549){return _0x1c59b9(_0x4700('0xa')+_0x318549);}logger[_0x4700('0x7')](_0x4700('0x10')+JSON[_0x4700('0x15')](_0x222a0d));return _0x3732a1(_0x222a0d);});});};async function checkCommunityAccess(){const _0x1156b2=_0x4700('0x1e')+classroomConnection[_0x4700('0x13')]+_0x4700('0x2f');const _0x4738d1=await shell[_0x4700('0x25')](_0x1156b2,{'silent':!![]})['stdout'][_0x4700('0x2c')]();logger[_0x4700('0x7')](_0x4700('0x23')+_0x4738d1);let _0x192921={'uri':_0x4700('0x14')+_0x4738d1+_0x4700('0x27')+classroomConnection['serial'],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x5f2646=await rp(_0x192921);logger[_0x4700('0x7')](JSON[_0x4700('0x15')](_0x5f2646));let _0x5b58dd=![];if(_0x5f2646[_0x4700('0x28')]){_0x5b58dd=_0x5f2646['data']['community_access'];}if(_0x5b58dd){let _0x155d25={'ssid':_0x5f2646[_0x4700('0x21')][_0x4700('0x2e')],'passphrase':_0x5f2646[_0x4700('0x21')][_0x4700('0x2a')]};await checkIfOnClassroomNetwork(_0x155d25);}else{logger[_0x4700('0x7')](_0x4700('0x33'));await tryNextClassroomNetork();}}catch(_0x2b88f9){logger['warn'](_0x4700('0x26')+_0x2b88f9);await tryNextClassroomNetork();}};async function checkIfOnClassroomNetwork(_0x3c47ca){if(classroomConnection[_0x4700('0x1a')]['ssid']==_0x3c47ca[_0x4700('0x2e')]){logger[_0x4700('0x7')]('Already\x20connected\x20to\x20classroom\x20network');await connectSockets();}else{logger[_0x4700('0x7')](_0x4700('0x12'));await connectToClassroomNetwork(_0x3c47ca);}};async function connectSockets(){logger[_0x4700('0x7')]('Connecting\x20classroom\x20socket\x20communication');await require('../sockets');connection[_0x4700('0x8')]=!![];};async function connectToClassroomNetwork(_0x49494e){try{logger[_0x4700('0x7')](_0x4700('0x5')+_0x49494e[_0x4700('0x2e')]);let _0x591e56={'ssid':_0x49494e[_0x4700('0x2e')],'password':_0x49494e[_0x4700('0x2a')],'hidden':![]};await wireless[_0x4700('0x16')](_0x591e56);await connectSockets();}catch(_0x2d63b1){logger[_0x4700('0x4')]('Error\x20connecting\x20to\x20classroom\x20network:\x20'+_0x2d63b1);}};async function getFallBackNetwork(){return new Promise((_0x45ef59,_0x4ced7a)=>{let _0xb39d4b=null;if(_0xb39d4b){logger[_0x4700('0x7')]('Storing\x20fallback\x20network');}else{logger['debug']('No\x20fallback\x20network\x20found');}return _0x45ef59(null);});};async function restoreFallBackNetwork(){logger[_0x4700('0x7')](_0x4700('0xe'));if(classroomConnection[_0x4700('0xb')]){logger[_0x4700('0x7')](_0x4700('0x29')+classroomConnection[_0x4700('0xb')]);}else{logger[_0x4700('0x7')](_0x4700('0x20'));}};async function connectToHiddenClassroomNetwork(_0x206463){try{logger[_0x4700('0x7')](_0x4700('0x32')+_0x206463[_0x4700('0xf')]);let _0x58d32c={'ssid':_0x206463[_0x4700('0xf')],'password':_0x206463[_0x4700('0x9')],'hidden':!![]};await wireless[_0x4700('0x16')](_0x58d32c);logger['debug'](_0x4700('0x1'));await checkCommunityAccess();}catch(_0x18744e){logger[_0x4700('0x4')](_0x18744e);await tryNextClassroomNetork();}};async function tryNextClassroomNetork(){logger[_0x4700('0x7')](_0x4700('0x31'));let _0x3375b3=await getNextNetwork();if(_0x3375b3){logger[_0x4700('0x7')]('Next\x20network\x20is:\x20'+_0x3375b3[_0x4700('0xf')]);await connectToHiddenClassroomNetwork(_0x3375b3);}else{logger[_0x4700('0x7')](_0x4700('0x34'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x35f2cf=null;if(classroomConnection[_0x4700('0x35')]<classroomConnection[_0x4700('0x1b')][_0x4700('0x11')])_0x35f2cf=classroomConnection['networks'][classroomConnection[_0x4700('0x35')]++];return _0x35f2cf;};module['exports']=connection;