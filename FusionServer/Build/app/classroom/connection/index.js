const _0x36bb=['MyBot_Gatekeeper_WiFi','fallBackNetwork','Connecting\x20to\x20classroom:\x20','Storing\x20fallback\x20network','Already\x20connected\x20to\x20classroom\x20network','debug','split','community_access','currentNetwork','hiddenSSID','./../../utils/wireless','CMMthgilxoBsecure','connectToNetwork','wifiInterface','networks','No\x20more\x20networks\x20to\x20try.\x20Restoring\x20fallback\x20network','fallbackNetwork','stdout','warn','https://','wifiStatus','Error\x20accessing\x20network\x20interface:\x20','\x20\x20metric\x27\x20|\x20awk\x20\x27{print\x20$3}\x27','connected','stringify','passphrase','Fallback\x20network\x20found:\x20','getmac','substr','Trying\x20next\x20hidden\x20classroom\x20network','trim','eth0','hiddenPassword','shelljs','getMac','Not\x20connected\x20to\x20classroom\x20network','get','data','No\x20fallback\x20network\x20found','serial','ssid','Gateway\x20found\x20at:\x20','exec','../../utils/logger','wifi','Not\x20part\x20of\x20the\x20classroom\x20community','On\x20hidden\x20network,\x20rechecking\x20community\x20access','Connecting\x20classroom\x20socket\x20communication','Checking\x20for\x20fallback\x20network','../sockets','Wifi\x20interface\x20status:\x20','status','request-promise','message','Unable\x20to\x20reach\x20classroom\x20community:\x20','Wifi_NIC'];(function(_0x10c88e,_0x36bbf4){const _0x300b4f=function(_0x50c3b6){while(--_0x50c3b6){_0x10c88e['push'](_0x10c88e['shift']());}};_0x300b4f(++_0x36bbf4);}(_0x36bb,0xaa));const _0x300b=function(_0x10c88e,_0x36bbf4){_0x10c88e=_0x10c88e-0x0;let _0x300b4f=_0x36bb[_0x10c88e];return _0x300b4f;};const config=require('config');const logger=require(_0x300b('0x29'));const rp=require(_0x300b('0x32'));const wpa_cli=require('wireless-tools/wpa_cli');const mac=require(_0x300b('0x19'));const shell=require(_0x300b('0x1f'));const wireless=require(_0x300b('0x8'));let classroomConnection={'wifiInterface':config[_0x300b('0x22')](_0x300b('0x35')),'currentNetwork':0x0,'networks':[{'hiddenSSID':_0x300b('0x36'),'hiddenPassword':_0x300b('0x9')}],'serial':null,'wifiStatus':null,'fallbackNetwork':null};const connection={'connected':![],'connect':async function(){classroomConnection[_0x300b('0x37')]=await getFallBackNetwork();classroomConnection[_0x300b('0x25')]=await getSerial();classroomConnection['wifiStatus']=await getWifiStatus();await checkCommunityAccess();}};function getSerial(){return new Promise((_0xaa239e,_0x16584b)=>{mac[_0x300b('0x20')]({'iface':_0x300b('0x1d')},function(_0x1dee71,_0x17d11a){if(_0x1dee71){return _0x16584b(_0x1dee71[_0x300b('0x33')]);}else{let _0x19a7c6=_0x17d11a[_0x300b('0x4')](':')['join']('')[_0x300b('0x1a')](-0x6);logger[_0x300b('0x3')]('Fusion\x20serial\x20number:\x20'+_0x19a7c6);return _0xaa239e(_0x19a7c6);}});});};function getWifiStatus(){return new Promise((_0x444654,_0x1b9e0d)=>{wpa_cli[_0x300b('0x31')](classroomConnection['wifiInterface'],function(_0xa17b3d,_0x4c34d4){if(_0xa17b3d){return _0x1b9e0d(_0x300b('0x13')+_0xa17b3d);}logger['debug'](_0x300b('0x30')+JSON[_0x300b('0x16')](_0x4c34d4));return _0x444654(_0x4c34d4);});});};async function checkCommunityAccess(){const _0x383d5f='ip\x20route\x20show\x20|\x20grep\x20-i\x20\x27'+classroomConnection[_0x300b('0xb')]+_0x300b('0x14');const _0x976069=await shell[_0x300b('0x28')](_0x383d5f,{'silent':!![]})[_0x300b('0xf')][_0x300b('0x1c')]();logger[_0x300b('0x3')](_0x300b('0x27')+_0x976069);let _0x8cba63={'uri':_0x300b('0x11')+_0x976069+':8443/api/v1/connect/'+classroomConnection[_0x300b('0x25')],'rejectUnauthorized':![],'json':!![],'timeout':0x1388};try{let _0x27491b=await rp(_0x8cba63);logger[_0x300b('0x3')](JSON[_0x300b('0x16')](_0x27491b));let _0x33e9f2=![];if(_0x27491b['data']){_0x33e9f2=_0x27491b[_0x300b('0x23')][_0x300b('0x5')];}if(_0x33e9f2){let _0x595297={'ssid':_0x27491b['wifi'][_0x300b('0x26')],'passphrase':_0x27491b[_0x300b('0x2a')][_0x300b('0x17')]};await checkIfOnClassroomNetwork(_0x595297);}else{logger[_0x300b('0x3')](_0x300b('0x2b'));await tryNextClassroomNetork();}}catch(_0x4cc671){logger[_0x300b('0x10')](_0x300b('0x34')+_0x4cc671);await tryNextClassroomNetork();}};async function checkIfOnClassroomNetwork(_0x3081bb){if(classroomConnection[_0x300b('0x12')][_0x300b('0x26')]==_0x3081bb[_0x300b('0x26')]){logger[_0x300b('0x3')](_0x300b('0x2'));await connectSockets();}else{logger[_0x300b('0x3')](_0x300b('0x21'));await connectToClassroomNetwork(_0x3081bb);}};async function connectSockets(){logger[_0x300b('0x3')](_0x300b('0x2d'));await require(_0x300b('0x2f'));connection[_0x300b('0x15')]=!![];};async function connectToClassroomNetwork(_0x5938ee){try{logger['debug'](_0x300b('0x0')+_0x5938ee[_0x300b('0x26')]);let _0x4630d8={'ssid':_0x5938ee[_0x300b('0x26')],'password':_0x5938ee[_0x300b('0x17')],'hidden':![]};await wireless['connectToNetwork'](_0x4630d8);await connectSockets();}catch(_0x31e159){logger[_0x300b('0x10')]('Error\x20connecting\x20to\x20classroom\x20network:\x20'+_0x31e159);}};async function getFallBackNetwork(){return new Promise((_0x409d88,_0x234879)=>{let _0x528dd0=null;if(_0x528dd0){logger[_0x300b('0x3')](_0x300b('0x1'));}else{logger[_0x300b('0x3')](_0x300b('0x24'));}return _0x409d88(null);});};async function restoreFallBackNetwork(){logger[_0x300b('0x3')](_0x300b('0x2e'));if(classroomConnection[_0x300b('0xe')]){logger[_0x300b('0x3')](_0x300b('0x18')+classroomConnection[_0x300b('0xe')]);}else{logger[_0x300b('0x3')]('No\x20fallback\x20network\x20found');}};async function connectToHiddenClassroomNetwork(_0x28e161){try{logger['debug']('Connecting\x20to\x20hidden\x20classroom:\x20'+_0x28e161[_0x300b('0x7')]);let _0x529b7b={'ssid':_0x28e161[_0x300b('0x7')],'password':_0x28e161[_0x300b('0x1e')],'hidden':!![]};await wireless[_0x300b('0xa')](_0x529b7b);logger[_0x300b('0x3')](_0x300b('0x2c'));await checkCommunityAccess();}catch(_0x134667){logger[_0x300b('0x10')](_0x134667);await tryNextClassroomNetork();}};async function tryNextClassroomNetork(){logger['debug'](_0x300b('0x1b'));let _0x141b46=await getNextNetwork();if(_0x141b46){logger[_0x300b('0x3')]('Next\x20network\x20is:\x20'+_0x141b46['hiddenSSID']);await connectToHiddenClassroomNetwork(_0x141b46);}else{logger['debug'](_0x300b('0xd'));await restoreFallBackNetwork();}};async function getNextNetwork(){let _0x5894f3=null;if(classroomConnection['currentNetwork']<classroomConnection[_0x300b('0xc')]['length'])_0x5894f3=classroomConnection[_0x300b('0xc')][classroomConnection[_0x300b('0x6')]++];return _0x5894f3;};module['exports']=connection;