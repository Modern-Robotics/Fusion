!function(){const t=require("config"),e=require("./../logger"),n=require("shelljs"),i=require("fs-extra"),r=require("os"),o=require("wireless-tools/wpa_cli"),s={networkInterface:t.get("Wifi_NIC"),connectToNetwork:async function(t){if("win32"==r.platform())throw"Windows wifi connecting not supported";const o=t.ssid,s=t.password;let a=0;t.hidden&&(a=1),e.verbose('Connecting to "'+o+'" using password: "'+s+'"');let c="";if(c+="ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev"+r.EOL,c+="update_config=1"+r.EOL,c+="country=US"+r.EOL,c+=""+r.EOL,c+="network={"+r.EOL,c+='\tssid="'+o+'"'+r.EOL,c+="\tscan_ssid="+a+r.EOL,c+='\tpsk="'+s+'"'+r.EOL,c+="\tkey_mgmt=WPA-PSK"+r.EOL,c+="}",e.debug("WPA supplicant data: \n"+c),await i.writeFile("/etc/wpa_supplicant/wpa_supplicant.conf",c),"FAIL"==n.exec("sudo wpa_cli -i "+this.networkInterface+" reconfigure",{silent:!0}).stdout.trim())throw"Invalid SSID or Password";let u=!1,w=null;for(let t=0;t<1e3;t++)if(w=await this.getNetworkStatus(),"COMPLETED"==w.wpa_state&&void 0!==w.ip){e.debug("Attempts: "+t),e.debug(JSON.stringify(w)),u=!0;break}if(!u)throw"Failed to connect to "+o;e.debug("Connected to: "+o)},getNetworkStatus:async function(){return new Promise(((t,e)=>{o.status(this.networkInterface,(function(n,i){return n?e(n):t(i)}))}))}};module.exports=s}();