var _0x6d7a=['post','/api/admin/users','findOne','username','status','send','body','password','generateHash','filepath','generateFileSystem','save','json','/api/admin/powerOff','Shut\x20Down\x20Commencing','sudo','/api/admin/restart','Restart\x20Commencing','reboot','/api/admin/wirelessSettings','platform','win32','../../etc/hostapd.conf','readFile','utf8','Wifi\x20file\x20not\x20found','split','length','ssid','SSID','wpa_passphrase','/etc/hostapd/hostapd.conf','Password','ssid_set.py','pipe','stderr','data','log','stdout','close','Successfully\x20changed\x20wifi\x20settings','/api/admin/wirelessConnections','ctrl_interface=DIR=/var/run/wpa_supplicant\x20GROUP=netdev\x0a','update_config=1\x0a','country=US\x0a\x0a','network={\x0a','\x09scan_ssid=1\x0a','\x09psk=\x22','}\x0a\x0a','exec','wpa_passphrase\x20\x22','\x22\x20\x22','\x20\x20\x20\x20ssid=\x22','\x20\x20\x20\x20key_mgmt=NONE\x0a','writeFile','sudo\x20wpa_cli\x20-i\x20','\x20reconfigure','SCANNING','4WAY_HANDSHAKE','AUTHENTICATING','wpa_state','COMPLETED','\x20assigned','emit','wifi-connection','\x20successfully','Took\x20too\x20long\x20to\x20connect.\x20Something\x20must\x20be\x20wrong.','Error\x20connecting\x20to\x20','sockets','/api/admin/wirelessConnections/disconnect','/etc/wpa_supplicant/wpa_supplicant.conf','SocketVariables','fusion_wifi_access','DISCONNECTED','INACTIVE','indexOf','Error\x20disconnecting','/api/admin/crashReport','.crash','readdir','setHeader','Content-disposition','attachment;\x20filename=','download','../../diagnostics/runRemi.sh','../../diagnostics/diagnosticGUI.py','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','fusion_diagnostics_running','socketId','diagnostics_running','Diagnostic\x20tool\x20started\x20successfully','sudo\x20kill\x20$(ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27)','Diagnostic\x20tool\x20stopped\x20successfully','trim','Diagnostic\x20tool\x20does\x20not\x20run\x20on\x20windows','isAuthenticated','User\x20Unauthenticated','path','shelljs','wireless-tools/wpa_cli','wireless-tools/iwlist','wireless-tools/wpa_supplicant','child_process','spawn','get','Wifi_NIC','exports'];(function(_0x7e93f,_0x4fd51a){var _0x1c9065=function(_0x255fec){while(--_0x255fec){_0x7e93f['push'](_0x7e93f['shift']());}};_0x1c9065(++_0x4fd51a);}(_0x6d7a,0x1a2));var _0x5241=function(_0x33d6bf,_0x25d3d7){_0x33d6bf=_0x33d6bf-0x0;var _0x5c2c01=_0x6d7a[_0x33d6bf];return _0x5c2c01;};var fs=require('fs');var mkdirp=require('mkdirp');var os=require('os');var path=require(_0x5241('0x0'));var shell=require(_0x5241('0x1'));var wpa_cli=require(_0x5241('0x2'));var iwlist=require(_0x5241('0x3'));var wpa_supplicant=require(_0x5241('0x4'));var spawn=require(_0x5241('0x5'))[_0x5241('0x6')];const config=require('config');let nicInterface=config[_0x5241('0x7')](_0x5241('0x8'));module[_0x5241('0x9')]=function(_0xb2f6b5,_0x63a9a4,_0x68386b,_0x3934d7,_0x23dfd5){_0xb2f6b5[_0x5241('0xa')](_0x5241('0xb'),_0x5ed575(),function(_0x169d27,_0x7d8fe5){_0x63a9a4[_0x5241('0xc')]({'username':_0x169d27['body'][_0x5241('0xd')]},function(_0x3ce590,_0x2c16b2){if(_0x3ce590)return _0x7d8fe5[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x3ce590);if(_0x2c16b2){return _0x7d8fe5['status'](0x1f4)[_0x5241('0xf')]('Username\x20already\x20taken.');}else{var _0xc5e66d=new _0x63a9a4(_0x169d27[_0x5241('0x10')]);_0xc5e66d[_0x5241('0xd')]=_0x169d27[_0x5241('0x10')]['username'];_0xc5e66d[_0x5241('0x11')]=_0xc5e66d[_0x5241('0x12')](_0x169d27[_0x5241('0x10')]['password']);_0xc5e66d[_0x5241('0x13')]=_0xc5e66d[_0x5241('0x14')](_0xc5e66d['username']);_0xc5e66d[_0x5241('0x15')](function(_0x1a7a8f){if(_0x1a7a8f)return _0x7d8fe5[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x1a7a8f);return _0x7d8fe5[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':'User\x20created!'});});}});});_0xb2f6b5[_0x5241('0x7')](_0x5241('0x17'),function(_0x142cf0,_0x159748){_0x159748[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':_0x5241('0x18')});var _0x541aab=require(_0x5241('0x5'))['spawn'];var _0x509ad2=_0x541aab(_0x5241('0x19'),['poweroff']);});_0xb2f6b5[_0x5241('0x7')](_0x5241('0x1a'),function(_0x1a7e17,_0xaae749){_0xaae749[_0x5241('0xe')](0xc8)[_0x5241('0xf')](_0x5241('0x1b'));var _0x5ebdfa=require(_0x5241('0x5'))[_0x5241('0x6')];var _0x4d6a61=_0x5ebdfa(_0x5241('0x19'),[_0x5241('0x1c')]);});_0xb2f6b5['get'](_0x5241('0x1d'),function(_0x2fc85d,_0x561d81){var _0x52b88e;var _0xb2ad0=require('os')['EOL'];var _0x2500f3;var _0x36ceff;var _0x90a8e9={};if(os[_0x5241('0x1e')]()==_0x5241('0x1f')){_0x52b88e=_0x5241('0x20');fs[_0x5241('0x21')](_0x52b88e,_0x5241('0x22'),function(_0x826712,_0x236c22){if(_0x826712)_0x561d81[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x5241('0x23'));_0x2500f3=_0x236c22[_0x5241('0x24')]('\x0a');for(var _0x475741=0x0;_0x475741<_0x2500f3[_0x5241('0x25')];_0x475741++){_0x36ceff=_0x2500f3[_0x475741][_0x5241('0x24')]('=');if(_0x36ceff[0x0]==_0x5241('0x26'))_0x90a8e9[_0x5241('0x27')]=_0x36ceff[0x1];else if(_0x36ceff[0x0]==_0x5241('0x28'))_0x90a8e9['Password']=_0x36ceff[0x1];}_0x561d81[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'SSID':_0x90a8e9[_0x5241('0x27')],'Password':_0x90a8e9['Password']});});}else{_0x52b88e=_0x5241('0x29');fs[_0x5241('0x21')](_0x52b88e,_0x5241('0x22'),function(_0x123745,_0x1e61f7){if(_0x123745)_0x561d81[_0x5241('0xe')](0x1f4)[_0x5241('0xf')]('Wifi\x20file\x20not\x20found');_0x2500f3=_0x1e61f7[_0x5241('0x24')](_0xb2ad0);for(var _0x48cf45=0x0;_0x48cf45<_0x2500f3['length'];_0x48cf45++){_0x36ceff=_0x2500f3[_0x48cf45]['split']('=');if(_0x36ceff[0x0]=='ssid')_0x90a8e9[_0x5241('0x27')]=_0x36ceff[0x1];else if(_0x36ceff[0x0]=='wpa_passphrase')_0x90a8e9[_0x5241('0x2a')]=_0x36ceff[0x1];}_0x561d81[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'SSID':_0x90a8e9[_0x5241('0x27')],'Password':_0x90a8e9[_0x5241('0x2a')]});});}});_0xb2f6b5['post'](_0x5241('0x1d'),function(_0x2eda14,_0x3e0911){try{var _0x127271;var _0x1df08f;var _0x227844=path['join']('..','..','etc',_0x5241('0x2b'));if(_0x2eda14[_0x5241('0x10')][_0x5241('0x26')]==null&&_0x2eda14[_0x5241('0x10')][_0x5241('0x11')]==null)_0x1df08f=['python',_0x227844,'-d'];else _0x1df08f=['python',_0x227844,'-s',_0x2eda14[_0x5241('0x10')]['ssid'],'-p',_0x2eda14[_0x5241('0x10')][_0x5241('0x11')]];var _0x21f248=require(_0x5241('0x5'))[_0x5241('0x6')];python_process=_0x21f248(_0x5241('0x19'),_0x1df08f,{'stdio':_0x5241('0x2c')});python_process[_0x5241('0x2d')]['on'](_0x5241('0x2e'),function(_0x4c3b53){console[_0x5241('0x2f')](String(_0x4c3b53));_0x127271=String(_0x4c3b53);});python_process[_0x5241('0x30')]['on'](_0x5241('0x31'),function(_0x532a8d){if(_0x127271)return _0x3e0911[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x127271);else return _0x3e0911[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':_0x5241('0x32')});});}catch(_0x38f896){console[_0x5241('0x2f')](_0x38f896);return _0x3e0911[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x38f896);}});_0xb2f6b5[_0x5241('0x7')](_0x5241('0x33'),function(_0x4fecca,_0x44287d){if(os[_0x5241('0x1e')]()=='win32'){return _0x44287d[_0x5241('0xe')](0xc8)[_0x5241('0xf')]();}else{iwlist['scan'](nicInterface,function(_0x534e29,_0x3f0a2e){if(_0x534e29)return _0x44287d[_0x5241('0xe')](0x1f4)[_0x5241('0xf')]('Wireless\x20interface\x20not\x20found');else return _0x44287d[_0x5241('0xe')](0xc8)['send']({'serverMessage':'Retreived\x20wireless\x20connections','data':_0x3f0a2e});});}});_0xb2f6b5[_0x5241('0xa')]('/api/admin/wirelessConnections',function(_0x16d6ab,_0x385435){var _0x500ddf=undefined;var _0x237057=_0x5241('0x34')+_0x5241('0x35')+_0x5241('0x36');var _0x56b027=_0x5241('0x37')+'\x09ssid=\x22'+_0x16d6ab[_0x5241('0x10')][_0x5241('0x26')]+'\x22\x0a'+_0x5241('0x38')+_0x5241('0x39')+_0x16d6ab[_0x5241('0x10')]['password']+'\x22\x0a'+'\x09key_mgmt=WPA-PSK\x0a'+_0x5241('0x3a');if(_0x16d6ab[_0x5241('0x10')][_0x5241('0x11')]){_0x500ddf=shell[_0x5241('0x3b')](_0x5241('0x3c')+_0x16d6ab['body'][_0x5241('0x26')]+_0x5241('0x3d')+_0x16d6ab['body']['password']+'\x22',{'silent':!![]})[_0x5241('0x30')];}else{_0x500ddf=_0x5241('0x37')+_0x5241('0x3e')+_0x16d6ab[_0x5241('0x10')][_0x5241('0x26')]+'\x22\x0a'+_0x5241('0x3f')+'}\x0a';}let _0x5a1ab9='';if(_0x16d6ab[_0x5241('0x10')]['hiddenNetwork'])_0x5a1ab9=_0x237057+_0x56b027;else _0x5a1ab9=_0x237057+_0x500ddf;fs[_0x5241('0x40')]('/etc/wpa_supplicant/wpa_supplicant.conf',_0x5a1ab9,function(_0x4c9a16){if(_0x4c9a16)return _0x385435[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x4c9a16);shell[_0x5241('0x3b')](_0x5241('0x41')+nicInterface+_0x5241('0x42'),{'silent':!![]});const _0x37246d=0x3a98;var _0x6ca226=0x12c;var _0x8ed2f0=0x0;var _0x4749f4=setInterval(function(){var _0x2a6ff7=[_0x5241('0x43'),_0x5241('0x44'),_0x5241('0x45'),'DISCONNECTED','ASSOCIATING'];wpa_cli[_0x5241('0xe')](nicInterface,function(_0x4cc83c,_0x51c6a3){if(_0x4cc83c)return _0x385435[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x4cc83c);if(_0x51c6a3[_0x5241('0x46')]==_0x5241('0x47')){if(_0x51c6a3['ip']){console['log']('Ip\x20address:\x20'+_0x51c6a3['ip']+_0x5241('0x48'));clearInterval(_0x4749f4);_0x23dfd5['SocketVariables']['fusion_wifi_access']=_0x51c6a3;_0x3934d7['sockets'][_0x5241('0x49')](_0x5241('0x4a'),_0x51c6a3);return _0x385435['status'](0xc8)[_0x5241('0x16')]({'serverMessage':'Connected\x20to\x20'+_0x16d6ab[_0x5241('0x10')]['ssid']+_0x5241('0x4b')});}else if(_0x8ed2f0>_0x37246d){console[_0x5241('0x2f')](_0x5241('0x4c'));clearInterval(_0x4749f4);return _0x385435[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x5241('0x4d')+_0x16d6ab[_0x5241('0x10')][_0x5241('0x26')]);}_0x8ed2f0+=_0x6ca226;}else if(_0x2a6ff7['indexOf'](_0x51c6a3['wpa_state'])==-0x1){clearInterval(_0x4749f4);_0x3934d7[_0x5241('0x4e')][_0x5241('0x49')](_0x5241('0x4a'),_0x51c6a3);return _0x385435['status'](0x1f4)[_0x5241('0xf')]('Error\x20connecting\x20to\x20'+_0x16d6ab[_0x5241('0x10')]['ssid']);}});},_0x6ca226);});});_0xb2f6b5[_0x5241('0x7')](_0x5241('0x4f'),function(_0xc47e95,_0x3fce24){if(os[_0x5241('0x1e')]()=='win32'){_0x3fce24[_0x5241('0xe')](0x1f4)[_0x5241('0xf')]('Disconnect\x20not\x20available\x20on\x20Windows');}else{var _0x23f14f=_0x5241('0x34')+_0x5241('0x35')+_0x5241('0x36');fs[_0x5241('0x40')](_0x5241('0x50'),_0x23f14f,function(_0x224c70){if(_0x224c70)return _0x3fce24['status'](0x1f4)['send'](_0x224c70);shell[_0x5241('0x3b')](_0x5241('0x41')+nicInterface+_0x5241('0x42'),{'silent':!![]});var _0x30cb2d=setInterval(function(){var _0x17c4b8=[];wpa_cli[_0x5241('0xe')](nicInterface,function(_0x5a87aa,_0x3b0aca){if(_0x5a87aa)return _0x3fce24[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x5a87aa);_0x23dfd5[_0x5241('0x51')][_0x5241('0x52')]=_0x3b0aca;_0x3934d7['sockets']['emit']('wifi-connection',_0x3b0aca);if(_0x3b0aca[_0x5241('0x46')]==_0x5241('0x53')||_0x3b0aca[_0x5241('0x46')]==_0x5241('0x54')){clearInterval(_0x30cb2d);_0x3934d7[_0x5241('0x4e')][_0x5241('0x49')](_0x5241('0x4a'),_0x3b0aca);return _0x3fce24[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':'Disconnected\x20successfully'});}else if(connectingStatuses[_0x5241('0x55')](_0x3b0aca[_0x5241('0x46')])==-0x1){clearInterval(_0x30cb2d);_0x3934d7['sockets'][_0x5241('0x49')](_0x5241('0x4a'),_0x3b0aca);return _0x3fce24[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x5241('0x56'));}});},0x12c);});}});_0xb2f6b5[_0x5241('0x7')](_0x5241('0x57'),function(_0x47183c,_0x1b5148){var _0x4dbc9d=_0x5241('0x58');fs[_0x5241('0x59')](_0x4dbc9d,function(_0x24e515,_0x40a6a7){if(_0x24e515)return _0x1b5148[_0x5241('0xe')](0x1f4)[_0x5241('0xf')](_0x24e515);if(_0x40a6a7[_0x5241('0x25')]>0x0){fs[_0x5241('0x21')](_0x4dbc9d+'/'+_0x40a6a7[0x0],_0x5241('0x22'),function(_0xeb6dc9,_0x5d33bd){if(_0xeb6dc9)return status(0x1f4)['send']('Error\x20reading\x20crash\x20file');_0x1b5148[_0x5241('0x5a')](_0x5241('0x5b'),_0x5241('0x5c')+_0x40a6a7[0x0]);return _0x1b5148[_0x5241('0xe')](0xc8)[_0x5241('0x5d')](_0x4dbc9d+'/'+_0x40a6a7[0x0]);});}else{return _0x1b5148[_0x5241('0xe')](0xc8)[_0x5241('0xf')]('No\x20crash\x20files\x20found');}});});var _0x406116=null;_0xb2f6b5[_0x5241('0xa')]('/api/diagnostics/start',function(_0x5d3a75,_0x42cb65){if(os[_0x5241('0x1e')]()!=_0x5241('0x1f')){_0x406116=spawn(_0x5241('0x19'),['sh',_0x5241('0x5e'),_0x5241('0x5f')]);_0x406116[_0x5241('0x30')]['on'](_0x5241('0x2e'),function(_0x358590){console[_0x5241('0x2f')](String(_0x358590));});_0x406116[_0x5241('0x2d')]['on'](_0x5241('0x2e'),function(_0xe113f8){console[_0x5241('0x2f')](String(_0xe113f8));});var _0x4d39f6=0x1;var _0x15c052=0x3;var _0x459f45=setInterval(function(){if(_0x4d39f6<=_0x15c052){var _0x16727f=shell['exec'](_0x5241('0x60'),{'silent':!![]})[_0x5241('0x30')];if(_0x16727f){clearInterval(_0x459f45);_0x23dfd5[_0x5241('0x51')][_0x5241('0x61')]={'process':_0x16727f,'socket':_0x5d3a75[_0x5241('0x10')][_0x5241('0x62')]};_0x3934d7[_0x5241('0x4e')][_0x5241('0x49')](_0x5241('0x63'),_0x23dfd5[_0x5241('0x51')][_0x5241('0x61')]);return _0x42cb65[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':_0x5241('0x64')});}else{_0x4d39f6++;}}else{clearInterval(_0x459f45);return _0x42cb65[_0x5241('0xe')](0x1f4)['send']('Error\x20starting\x20diagnostic\x20tool');}},0x12c);}else{return _0x42cb65[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':'Diagnostic\x20tool\x20does\x20not\x20run\x20on\x20windows'});}});_0xb2f6b5[_0x5241('0x7')]('/api/diagnostics/stop',function(_0x43aef5,_0x398879){if(os['platform']()!=_0x5241('0x1f')){shell[_0x5241('0x3b')](_0x5241('0x65'),{'silent':!![]});shell[_0x5241('0x3b')]('ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27',{'silent':!![]},function(_0x1f34f6,_0x488b85,_0x1d8265){(function(_0xbced26){var _0x36fe22=_0xbced26['trim']();if(_0x36fe22){return _0x398879['status'](0x1f4)['send']('Unable\x20to\x20stop\x20diagnostic\x20tool');}else{_0x23dfd5['SocketVariables'][_0x5241('0x61')]=null;_0x3934d7['sockets'][_0x5241('0x49')](_0x5241('0x63'),_0x23dfd5[_0x5241('0x51')][_0x5241('0x61')]);_0x406116=null;return _0x398879[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':_0x5241('0x66')});}}(_0x488b85[_0x5241('0x67')]()));});}else{return _0x398879[_0x5241('0xe')](0xc8)[_0x5241('0x16')]({'serverMessage':_0x5241('0x68')});}});function _0x5ed575(){return function(_0x159dd5,_0x54cdda,_0x4b83fa){if(_0x159dd5[_0x5241('0x69')]()){return _0x4b83fa();}else{_0x54cdda[_0x5241('0xe')](0x191)['send'](_0x5241('0x6a'));}};}};