var _0x5216=['spawn','bash','scripts/updateFusion.sh','pipe','Restore\x20Finished!','/api/fusion/releaseNotes','isAuthenticated','../../socket','sudo','/api/fusion/update','User\x20Unauthenticated','stderr','Update\x20starting','close','get','status','child_process','split','stdout','json','/api/cookie','replace','--no-merges','--pretty=format:\x22[%cd]\x20(%h)\x20:\x20%s\x22','data','update-output','Error\x20Reading\x20changelog','scripts/restoreFusion.sh','emit','send','info','join','--date=short','git'];(function(_0x56238d,_0x5216c1){var _0xd1055c=function(_0x5e3c04){while(--_0x5e3c04){_0x56238d['push'](_0x56238d['shift']());}};_0xd1055c(++_0x5216c1);}(_0x5216,0x1ce));var _0xd105=function(_0x56238d,_0x5216c1){_0x56238d=_0x56238d-0x0;var _0xd1055c=_0x5216[_0x56238d];return _0xd1055c;};const logger=require('../../utils/logger');const app=require('../../express');const io=require(_0xd105('0x15'));module['exports']=function(){app[_0xd105('0x1c')](_0xd105('0x17'),_0x2ecceb(),function(_0x6b2bfe,_0x3bf862){try{var _0x524166=require('child_process')[_0xd105('0xe')];var _0x3dc302=_0xd105('0x10');var _0x5860ab=_0x524166('sudo',[_0xd105('0xf'),_0x3dc302],{'stdio':_0xd105('0x11')});_0x5860ab['stdout']['on'](_0xd105('0x4'),function(_0x5418e8){logger['info'](String(_0x5418e8));io[_0xd105('0x8')](_0xd105('0x5'),{'output':String(_0x5418e8)});});_0x5860ab[_0xd105('0x19')]['on'](_0xd105('0x4'),function(_0x516193){logger['info'](String(_0x516193));io[_0xd105('0x8')](_0xd105('0x5'),{'output':String(_0x516193)});});_0x5860ab[_0xd105('0x20')]['on'](_0xd105('0x1b'),function(_0x2f5f48){logger['info'](String('Update\x20Finished!'));});}catch(_0x35aec3){logger[_0xd105('0xa')](_0x35aec3);}_0x3bf862[_0xd105('0x1d')](0xc8)['send'](_0xd105('0x1a'));});app[_0xd105('0x1c')]('/api/fusion/restore',_0x2ecceb(),function(_0x610899,_0x681d67){try{var _0x59350d=require('child_process')['spawn'];var _0x57e504=_0xd105('0x7');var _0x30cb34=_0x59350d(_0xd105('0x16'),[_0xd105('0xf'),_0x57e504],{'stdio':_0xd105('0x11')});_0x30cb34[_0xd105('0x20')]['on'](_0xd105('0x4'),function(_0x3df0ce){logger['info'](String(_0x3df0ce));io[_0xd105('0x8')](_0xd105('0x5'),{'output':String(_0x3df0ce)});});_0x30cb34[_0xd105('0x19')]['on']('data',function(_0xf7822d){logger[_0xd105('0xa')](String(_0xf7822d));io[_0xd105('0x8')](_0xd105('0x5'),{'output':String(_0xf7822d)});});_0x30cb34['stdout']['on']('close',function(_0x126df6){logger[_0xd105('0xa')](String(_0xd105('0x12')));});}catch(_0x1dad51){logger[_0xd105('0xa')](_0x1dad51);}_0x681d67[_0xd105('0x1d')](0xc8)['send']('Restore\x20starting');});app['get'](_0xd105('0x13'),function(_0x2726ea,_0x40b05f){var _0x514366=require(_0xd105('0x1e'))['spawn'];var _0x31bf05='';var _0x65ac9e=!![];var _0x35b21b=_0x514366(_0xd105('0xd'),['log',_0xd105('0x3'),_0xd105('0xc'),_0xd105('0x2')],{'stdio':_0xd105('0x11')});_0x35b21b['stdout']['on'](_0xd105('0x4'),function(_0x16dd3f){_0x31bf05+=_0x16dd3f+'\x0a';});_0x35b21b[_0xd105('0x19')]['on'](_0xd105('0x4'),function(_0x36d21b){logger[_0xd105('0xa')](String(_0x36d21b));_0x65ac9e=![];});_0x35b21b[_0xd105('0x20')]['on'](_0xd105('0x1b'),function(_0xd70416){var _0x26fa22=_0x31bf05[_0xd105('0x1f')]('\x0a\x0a');for(var _0x4add98=0x0;_0x4add98<_0x26fa22['length'];_0x4add98++){_0x26fa22[_0x4add98]=_0x26fa22[_0x4add98][_0xd105('0x1')](/"/g,'');}_0x31bf05=_0x26fa22[_0xd105('0xb')]('\x0a');if(_0x65ac9e)_0x40b05f[_0xd105('0x1d')](0xc8)[_0xd105('0x21')]({'data':_0x31bf05});else _0x40b05f[_0xd105('0x1d')](0x1f4)[_0xd105('0x9')](_0xd105('0x6'));});});app[_0xd105('0x1c')](_0xd105('0x0'),_0x2ecceb(),function(_0x46f52f,_0x4d21e1){_0x4d21e1[_0xd105('0x1d')](0xc8)[_0xd105('0x9')](_0x46f52f['user']);});function _0x2ecceb(){return function(_0x4aea0b,_0x117be3,_0x20cc5e){if(_0x4aea0b[_0xd105('0x14')]()){return _0x20cc5e();}else{_0x117be3[_0xd105('0x1d')](0x191)['send'](_0xd105('0x18'));}};}}();