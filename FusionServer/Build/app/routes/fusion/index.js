!function(){const t=require("../../utils/logger"),e=require("../../express"),n=require("../../socket"),i=require("fs-extra"),s=require("path"),r=require("marked"),o=(require("os"),require("shelljs"));module.exports=(e.get("/api/fusion/update",(function(t,e,n){if(t.isAuthenticated())return n();e.status(401).send("User Unauthenticated")}),(function(e,i){try{var s=require("child_process").spawn,r=s("sudo",["bash","scripts/updateFusion.sh"],{stdio:"pipe"});r.stdout.on("data",(function(e){t.info(String(e)),n.emit("update-output",{output:String(e)})})),r.stderr.on("data",(function(e){t.info(String(e)),n.emit("update-output",{output:String(e)})})),r.stdout.on("close",(function(e){t.info(String("Update Finished!"))}))}catch(e){t.info(e)}i.status(200).send("Update starting")})),e.get("/api/fusion/restore",(function(t,e,n){if(t.isAuthenticated())return n();e.status(401).send("User Unauthenticated")}),(function(e,i){try{var s=require("child_process").spawn,r=s("sudo",["bash","scripts/restoreFusion.sh"],{stdio:"pipe"});r.stdout.on("data",(function(e){t.info(String(e)),n.emit("update-output",{output:String(e)})})),r.stderr.on("data",(function(e){t.info(String(e)),n.emit("update-output",{output:String(e)})})),r.stdout.on("close",(function(e){t.info(String("Restore Finished!"))}))}catch(e){t.info(e)}i.status(200).send("Restore starting")})),e.get("/api/fusion/releaseNotes",(async function(e,n){try{let t=o.exec('git log --pretty=format:"[%cd] (%h) : %s" --date=short --no-merges -1'),e=await i.readFile(s.join(__dirname,"./../../../../../README.md"),"utf-8");return n.status(200).json({version:t,changeLog:r(e)})}catch(e){return t.error("Error reading release notes: "+e),n.status(500).send("Error getting release notes")}})),void e.get("/api/cookie",(function(t,e,n){if(t.isAuthenticated())return n();e.status(401).send("User Unauthenticated")}),(function(t,e){e.status(200).send(t.user)})))}();