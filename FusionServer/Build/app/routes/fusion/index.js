const _0x13ae=['close','../../express','/api/cookie','stdout','./../../../../../README.md','1msbemM','child_process','fs-extra','path','1SsSfuj','111707rxnvGb','scripts/updateFusion.sh','322681xYqABa','pipe','spawn','update-output','../../socket','status','user','emit','291423TBrKGm','send','542626JsvmaN','marked','stderr','get','375754mgCjTk','utf-8','Error\x20reading\x20release\x20notes:\x20','info','Update\x20Finished!','data','join','9JFncTB','../../utils/logger','Restore\x20starting','Restore\x20Finished!','1171395uyZDGm','230246zAwYuY','sudo','/api/fusion/restore','json','readFile','isAuthenticated','bash'];const _0x493e=function(_0x4af3c8,_0x15c187){_0x4af3c8=_0x4af3c8-0x18d;let _0x13aed8=_0x13ae[_0x4af3c8];return _0x13aed8;};const _0x5439ac=_0x493e;(function(_0x3e1bf0,_0x4f4234){const _0x50893d=_0x493e;while(!![]){try{const _0x17802f=parseInt(_0x50893d(0x1b8))*parseInt(_0x50893d(0x19c))+parseInt(_0x50893d(0x198))+parseInt(_0x50893d(0x1a8))*parseInt(_0x50893d(0x1b4))+parseInt(_0x50893d(0x1a7))+parseInt(_0x50893d(0x1a3))*-parseInt(_0x50893d(0x1b9))+-parseInt(_0x50893d(0x196))+-parseInt(_0x50893d(0x18e));if(_0x17802f===_0x4f4234)break;else _0x3e1bf0['push'](_0x3e1bf0['shift']());}catch(_0x2d3cac){_0x3e1bf0['push'](_0x3e1bf0['shift']());}}}(_0x13ae,0xab08a));const logger=require(_0x5439ac(0x1a4)),app=require(_0x5439ac(0x1b0)),io=require(_0x5439ac(0x192)),fs=require(_0x5439ac(0x1b6)),path=require(_0x5439ac(0x1b7)),marked=require(_0x5439ac(0x199)),os=require('os'),shell=require('shelljs');module['exports']=function(){const _0x493709=_0x5439ac;app['get']('/api/fusion/update',_0x5129e3(),function(_0x391688,_0x2887fa){const _0x2f8a4d=_0x493e;try{var _0x48777a=require(_0x2f8a4d(0x1b5))[_0x2f8a4d(0x190)],_0x5e6a86=_0x2f8a4d(0x18d),_0x643778=_0x48777a(_0x2f8a4d(0x1a9),[_0x2f8a4d(0x1ae),_0x5e6a86],{'stdio':_0x2f8a4d(0x18f)});_0x643778[_0x2f8a4d(0x1b2)]['on']('data',function(_0x4836f2){const _0x63c83=_0x2f8a4d;logger[_0x63c83(0x19f)](String(_0x4836f2)),io[_0x63c83(0x195)]('update-output',{'output':String(_0x4836f2)});}),_0x643778[_0x2f8a4d(0x19a)]['on'](_0x2f8a4d(0x1a1),function(_0x51f80d){const _0x22ae97=_0x2f8a4d;logger['info'](String(_0x51f80d)),io[_0x22ae97(0x195)](_0x22ae97(0x191),{'output':String(_0x51f80d)});}),_0x643778[_0x2f8a4d(0x1b2)]['on'](_0x2f8a4d(0x1af),function(_0x3c43d2){const _0x13272c=_0x2f8a4d;logger[_0x13272c(0x19f)](String(_0x13272c(0x1a0)));});}catch(_0x220372){logger[_0x2f8a4d(0x19f)](_0x220372);}_0x2887fa[_0x2f8a4d(0x193)](0xc8)['send']('Update\x20starting');}),app[_0x493709(0x19b)](_0x493709(0x1aa),_0x5129e3(),function(_0x31ce17,_0x2877aa){const _0x431828=_0x493709;try{var _0x37a58d=require(_0x431828(0x1b5))['spawn'],_0x3d03b0='scripts/restoreFusion.sh',_0x221e6a=_0x37a58d('sudo',[_0x431828(0x1ae),_0x3d03b0],{'stdio':_0x431828(0x18f)});_0x221e6a[_0x431828(0x1b2)]['on'](_0x431828(0x1a1),function(_0x438298){const _0x368819=_0x431828;logger[_0x368819(0x19f)](String(_0x438298)),io[_0x368819(0x195)](_0x368819(0x191),{'output':String(_0x438298)});}),_0x221e6a[_0x431828(0x19a)]['on'](_0x431828(0x1a1),function(_0x12dbf3){const _0x514035=_0x431828;logger[_0x514035(0x19f)](String(_0x12dbf3)),io[_0x514035(0x195)](_0x514035(0x191),{'output':String(_0x12dbf3)});}),_0x221e6a[_0x431828(0x1b2)]['on'](_0x431828(0x1af),function(_0x33da05){const _0x3ea555=_0x431828;logger[_0x3ea555(0x19f)](String(_0x3ea555(0x1a6)));});}catch(_0xf6c076){logger[_0x431828(0x19f)](_0xf6c076);}_0x2877aa[_0x431828(0x193)](0xc8)[_0x431828(0x197)](_0x431828(0x1a5));}),app['get']('/api/fusion/releaseNotes',async function(_0xc032ed,_0x324bfe){const _0x56c5b4=_0x493709;try{let _0x4f18af=shell['exec']('git\x20log\x20--pretty=format:\x22[%cd]\x20(%h)\x20:\x20%s\x22\x20--date=short\x20--no-merges\x20-1'),_0x1158ec='<div\x20style=\x22border:1px\x20solid\x20gray\x22>'+_0x4f18af+'</div>',_0x1d85f8=await fs[_0x56c5b4(0x1ac)](path[_0x56c5b4(0x1a2)](__dirname,_0x56c5b4(0x1b3)),_0x56c5b4(0x19d));return _0x324bfe['status'](0xc8)[_0x56c5b4(0x1ab)]({'version':_0x4f18af,'changeLog':marked(_0x1d85f8)});}catch(_0x2f56d7){return logger['error'](_0x56c5b4(0x19e)+_0x2f56d7),_0x324bfe['status'](0x1f4)['send']('Error\x20getting\x20release\x20notes');}}),app[_0x493709(0x19b)](_0x493709(0x1b1),_0x5129e3(),function(_0x175a96,_0xce72c7){const _0x2fb77e=_0x493709;_0xce72c7[_0x2fb77e(0x193)](0xc8)[_0x2fb77e(0x197)](_0x175a96[_0x2fb77e(0x194)]);});function _0x5129e3(){return function(_0x3c98c6,_0x496718,_0x180cc6){const _0x37e97d=_0x493e;if(_0x3c98c6[_0x37e97d(0x1ad)]())return _0x180cc6();else _0x496718[_0x37e97d(0x193)](0x191)['send']('User\x20Unauthenticated');};}}();