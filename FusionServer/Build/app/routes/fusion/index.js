var _0x47ac=['pipe','Restore\x20Finished!','status','Restore\x20starting','/api/fusion/releaseNotes','exec','git\x20log\x20--pretty=format:\x22[%cd]\x20(%h)\x20:\x20%s\x22\x20--date=short\x20--no-merges\x20-1','<div\x20style=\x22border:1px\x20solid\x20gray\x22>','</div>','readFile','join','./../../../../../README.md','utf-8','json','error','Error\x20reading\x20release\x20notes:\x20','Error\x20getting\x20release\x20notes','/api/cookie','user','User\x20Unauthenticated','../../express','fs-extra','shelljs','exports','get','child_process','scripts/updateFusion.sh','sudo','bash','stdout','data','info','emit','update-output','stderr','close','send','Update\x20starting','/api/fusion/restore','scripts/restoreFusion.sh'];(function(_0x343526,_0x49d502){var _0x39f34f=function(_0x23ebe8){while(--_0x23ebe8){_0x343526['push'](_0x343526['shift']());}};_0x39f34f(++_0x49d502);}(_0x47ac,0x154));var _0x4c6b=function(_0x235213,_0x4e4b5d){_0x235213=_0x235213-0x0;var _0x2207cf=_0x47ac[_0x235213];return _0x2207cf;};const logger=require('../../utils/logger');const app=require(_0x4c6b('0x0'));const io=require('../../socket');const fs=require(_0x4c6b('0x1'));const path=require('path');const marked=require('marked');const os=require('os');const shell=require(_0x4c6b('0x2'));module[_0x4c6b('0x3')]=function(){app[_0x4c6b('0x4')]('/api/fusion/update',_0x299b42(),function(_0x1419fc,_0x46e372){try{var _0x5a1b8b=require(_0x4c6b('0x5'))['spawn'];var _0x485e85=_0x4c6b('0x6');var _0x331084=_0x5a1b8b(_0x4c6b('0x7'),[_0x4c6b('0x8'),_0x485e85],{'stdio':'pipe'});_0x331084[_0x4c6b('0x9')]['on'](_0x4c6b('0xa'),function(_0x2fda00){logger[_0x4c6b('0xb')](String(_0x2fda00));io[_0x4c6b('0xc')](_0x4c6b('0xd'),{'output':String(_0x2fda00)});});_0x331084[_0x4c6b('0xe')]['on'](_0x4c6b('0xa'),function(_0x1e295c){logger[_0x4c6b('0xb')](String(_0x1e295c));io[_0x4c6b('0xc')](_0x4c6b('0xd'),{'output':String(_0x1e295c)});});_0x331084[_0x4c6b('0x9')]['on'](_0x4c6b('0xf'),function(_0x480254){logger[_0x4c6b('0xb')](String('Update\x20Finished!'));});}catch(_0x266404){logger[_0x4c6b('0xb')](_0x266404);}_0x46e372['status'](0xc8)[_0x4c6b('0x10')](_0x4c6b('0x11'));});app[_0x4c6b('0x4')](_0x4c6b('0x12'),_0x299b42(),function(_0x5d77b1,_0x397f53){try{var _0x4b2b3f=require('child_process')['spawn'];var _0x5449c9=_0x4c6b('0x13');var _0x2391e0=_0x4b2b3f(_0x4c6b('0x7'),[_0x4c6b('0x8'),_0x5449c9],{'stdio':_0x4c6b('0x14')});_0x2391e0[_0x4c6b('0x9')]['on'](_0x4c6b('0xa'),function(_0x50d921){logger['info'](String(_0x50d921));io[_0x4c6b('0xc')](_0x4c6b('0xd'),{'output':String(_0x50d921)});});_0x2391e0[_0x4c6b('0xe')]['on'](_0x4c6b('0xa'),function(_0x1e6595){logger[_0x4c6b('0xb')](String(_0x1e6595));io[_0x4c6b('0xc')](_0x4c6b('0xd'),{'output':String(_0x1e6595)});});_0x2391e0[_0x4c6b('0x9')]['on'](_0x4c6b('0xf'),function(_0x4a3e63){logger[_0x4c6b('0xb')](String(_0x4c6b('0x15')));});}catch(_0x23fe1a){logger[_0x4c6b('0xb')](_0x23fe1a);}_0x397f53[_0x4c6b('0x16')](0xc8)[_0x4c6b('0x10')](_0x4c6b('0x17'));});app[_0x4c6b('0x4')](_0x4c6b('0x18'),async function(_0x4a5f0c,_0x1a9c14){try{let _0x4e1821=shell[_0x4c6b('0x19')](_0x4c6b('0x1a'));let _0x4f4f49=_0x4c6b('0x1b')+_0x4e1821+_0x4c6b('0x1c');let _0x516351=await fs[_0x4c6b('0x1d')](path[_0x4c6b('0x1e')](__dirname,_0x4c6b('0x1f')),_0x4c6b('0x20'));return _0x1a9c14[_0x4c6b('0x16')](0xc8)[_0x4c6b('0x21')]({'version':_0x4e1821,'changeLog':marked(_0x516351)});}catch(_0x461d72){logger[_0x4c6b('0x22')](_0x4c6b('0x23')+_0x461d72);return _0x1a9c14[_0x4c6b('0x16')](0x1f4)[_0x4c6b('0x10')](_0x4c6b('0x24'));}});app[_0x4c6b('0x4')](_0x4c6b('0x25'),_0x299b42(),function(_0x7995ef,_0x2f9238){_0x2f9238[_0x4c6b('0x16')](0xc8)['send'](_0x7995ef[_0x4c6b('0x26')]);});function _0x299b42(){return function(_0xc30159,_0x3a5525,_0x3998c1){if(_0xc30159['isAuthenticated']()){return _0x3998c1();}else{_0x3a5525[_0x4c6b('0x16')](0x191)[_0x4c6b('0x10')](_0x4c6b('0x27'));}};}}();