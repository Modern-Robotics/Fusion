var _0x2c31=['body','generateHash','password','save','json','User\x20created!','get','/api/admin/powerOff','Shut\x20Down\x20Commencing','sudo','poweroff','/api/admin/restart','Restart\x20Commencing','child_process','/api/admin/wirelessSettings','platform','win32','../../etc/config-wap/hostapd.conf__npp.sh','utf8','Wifi\x20file\x20not\x20found','length','ssid','SSID','Password','readFile','split','Not\x20configured..','join','etc','ssid_set.py','python','pipe','stderr','data','info','stdout','close','Successfully\x20changed\x20wifi\x20settings','/api/admin/wirelessConnections','Wireless\x20interface\x20not\x20found','update_config=1\x0a','country=US\x0a\x0a','network={\x0a','\x09psk=\x22','\x09key_mgmt=WPA-PSK\x0a','}\x0a\x0a','exec','wpa_passphrase\x20\x22','\x22\x20\x22','\x20\x20\x20\x20ssid=\x22','hiddenNetwork','writeFile','/etc/wpa_supplicant/wpa_supplicant.conf','sudo\x20wpa_cli\x20-i\x20','\x20reconfigure','SCANNING','4WAY_HANDSHAKE','AUTHENTICATING','ASSOCIATING','wpa_state','COMPLETED','Ip\x20address:\x20','fusion_wifi_access','sockets','Connected\x20to\x20','\x20successfully','Took\x20too\x20long\x20to\x20connect.\x20Something\x20must\x20be\x20wrong.','indexOf','emit','wifi-connection','Error\x20connecting\x20to\x20','/api/admin/wirelessConnections/disconnect','Disconnect\x20not\x20available\x20on\x20Windows','ctrl_interface=DIR=/var/run/wpa_supplicant\x20GROUP=netdev\x0a','SocketVariables','DISCONNECTED','INACTIVE','Disconnected\x20successfully','Error\x20disconnecting','/api/admin/crashReport','.crash','readdir','Error\x20reading\x20crash\x20file','setHeader','attachment;\x20filename=','No\x20crash\x20files\x20found','/api/diagnostics/start','../../diagnostics/runRemi.sh','../../diagnostics/diagnosticGUI.py','ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27','fusion_diagnostics_running','socketId','diagnostics_running','Error\x20starting\x20diagnostic\x20tool','/api/diagnostics/stop','sudo\x20kill\x20$(ps\x20aux\x20|\x20grep\x20\x27[s]udo\x20python\x20../../diagnostics/diagnosticGUI.py\x27\x20|\x20awk\x20\x27{print\x20$2}\x27)','trim','Unable\x20to\x20stop\x20diagnostic\x20tool','Diagnostic\x20tool\x20stopped\x20successfully','Diagnostic\x20tool\x20does\x20not\x20run\x20on\x20windows','/api/autonomous','findOneAndUpdate','Updated\x20successfully','message','User\x20Unauthenticated','fs-extra','mkdirp','path','shelljs','wireless-tools/wpa_cli','wireless-tools/wpa_supplicant','spawn','config','../../models/autonomous','Wifi_NIC','../../socket','../../global/fusionSettings','post','findOne','username','status','send'];(function(_0x3da22e,_0x227d97){var _0x2aae5e=function(_0x5e049f){while(--_0x5e049f){_0x3da22e['push'](_0x3da22e['shift']());}};_0x2aae5e(++_0x227d97);}(_0x2c31,0x69));var _0x3f84=function(_0x4a21c1,_0x546b1e){_0x4a21c1=_0x4a21c1-0x0;var _0x27e223=_0x2c31[_0x4a21c1];return _0x27e223;};var fs=require(_0x3f84('0x0'));var mkdirp=require(_0x3f84('0x1'));var os=require('os');var path=require(_0x3f84('0x2'));var shell=require(_0x3f84('0x3'));var wpa_cli=require(_0x3f84('0x4'));var iwlist=require('wireless-tools/iwlist');var wpa_supplicant=require(_0x3f84('0x5'));var spawn=require('child_process')[_0x3f84('0x6')];const config=require(_0x3f84('0x7'));const autonomous=require(_0x3f84('0x8'));const logger=require('../../utils/logger');let nicInterface=config['get'](_0x3f84('0x9'));const app=require('../../express');const User=require('../../models/user');const io=require(_0x3f84('0xa'));const FusionSettings=require(_0x3f84('0xb'));module['exports']=function(){app[_0x3f84('0xc')]('/api/admin/users',_0x120ef7(),function(_0x1d4c82,_0x5b6b64){User[_0x3f84('0xd')]({'username':_0x1d4c82['body'][_0x3f84('0xe')]},async function(_0xb69cc2,_0x562a0a){if(_0xb69cc2)return _0x5b6b64[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0xb69cc2);if(_0x562a0a){return _0x5b6b64[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')]('Username\x20already\x20taken.');}else{var _0x582251=new User(_0x1d4c82['body']);_0x582251[_0x3f84('0xe')]=_0x1d4c82[_0x3f84('0x11')][_0x3f84('0xe')];_0x582251['password']=_0x582251[_0x3f84('0x12')](_0x1d4c82[_0x3f84('0x11')][_0x3f84('0x13')]);_0x582251['filepath']=await _0x582251['generateFileSystem'](_0x582251['username']);_0x582251[_0x3f84('0x14')](function(_0x3b279e){if(_0x3b279e)return _0x5b6b64[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3b279e);return _0x5b6b64['status'](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x16')});});}});});app[_0x3f84('0x17')](_0x3f84('0x18'),function(_0x1b3c08,_0x28a168){_0x28a168[_0x3f84('0xf')](0xc8)['json']({'serverMessage':_0x3f84('0x19')});var _0x488027=require('child_process')[_0x3f84('0x6')];var _0x1cd05f=_0x488027(_0x3f84('0x1a'),[_0x3f84('0x1b')]);});app[_0x3f84('0x17')](_0x3f84('0x1c'),function(_0x5827f1,_0x57ef80){_0x57ef80['status'](0xc8)[_0x3f84('0x10')](_0x3f84('0x1d'));var _0x4194df=require(_0x3f84('0x1e'))[_0x3f84('0x6')];var _0x38ad7e=_0x4194df(_0x3f84('0x1a'),['reboot']);});app[_0x3f84('0x17')](_0x3f84('0x1f'),function(_0x30b51d,_0x251bc7){var _0x5785c8;var _0x2fb998=require('os')['EOL'];var _0x4cb04e;var _0x1b5fea;var _0x3e18eb={};if(os[_0x3f84('0x20')]()==_0x3f84('0x21')){_0x5785c8=_0x3f84('0x22');fs['readFile'](_0x5785c8,_0x3f84('0x23'),function(_0x307793,_0x52771f){if(_0x307793)_0x251bc7[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3f84('0x24'));_0x4cb04e=_0x52771f['split']('\x0a');for(var _0x55e616=0x0;_0x55e616<_0x4cb04e[_0x3f84('0x25')];_0x55e616++){_0x1b5fea=_0x4cb04e[_0x55e616]['split']('=');if(_0x1b5fea[0x0]==_0x3f84('0x26'))_0x3e18eb[_0x3f84('0x27')]=_0x1b5fea[0x1];else if(_0x1b5fea[0x0]=='wpa_passphrase')_0x3e18eb['Password']=_0x1b5fea[0x1];}_0x251bc7[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'SSID':_0x3e18eb[_0x3f84('0x27')],'Password':_0x3e18eb[_0x3f84('0x28')]});});}else{_0x5785c8='/etc/hostapd/hostapd.conf';fs[_0x3f84('0x29')](_0x5785c8,'utf8',function(_0x209d61,_0x155219){if(_0x209d61)_0x251bc7[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3f84('0x24'));_0x4cb04e=_0x155219['split'](_0x2fb998);for(var _0x4a1b99=0x0;_0x4a1b99<_0x4cb04e['length'];_0x4a1b99++){_0x1b5fea=_0x4cb04e[_0x4a1b99][_0x3f84('0x2a')]('=');if(_0x1b5fea[0x0]==_0x3f84('0x26'))_0x3e18eb[_0x3f84('0x27')]=_0x1b5fea[0x1];else if(_0x1b5fea[0x0]=='wpa_passphrase')_0x3e18eb['Password']=_0x1b5fea[0x1];}if(!_0x3e18eb[_0x3f84('0x27')]){_0x3e18eb[_0x3f84('0x27')]=_0x3f84('0x2b');_0x3e18eb['Password']='';}_0x251bc7[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'SSID':_0x3e18eb[_0x3f84('0x27')],'Password':_0x3e18eb[_0x3f84('0x28')]});});}});app[_0x3f84('0xc')]('/api/admin/wirelessSettings',function(_0x453091,_0x20b29b){try{var _0x5cccb5;var _0x1f2438;var _0x36dc9a=path[_0x3f84('0x2c')]('..','..',_0x3f84('0x2d'),_0x3f84('0x2e'));if(_0x453091[_0x3f84('0x11')]['ssid']==null&&_0x453091[_0x3f84('0x11')][_0x3f84('0x13')]==null)_0x1f2438=[_0x3f84('0x2f'),_0x36dc9a,'-d'];else _0x1f2438=[_0x3f84('0x2f'),_0x36dc9a,'-s',_0x453091[_0x3f84('0x11')][_0x3f84('0x26')],'-p',_0x453091[_0x3f84('0x11')][_0x3f84('0x13')]];var _0x135b4f=require('child_process')[_0x3f84('0x6')];python_process=_0x135b4f(_0x3f84('0x1a'),_0x1f2438,{'stdio':_0x3f84('0x30')});python_process[_0x3f84('0x31')]['on'](_0x3f84('0x32'),function(_0x59c10b){logger[_0x3f84('0x33')](String(_0x59c10b));_0x5cccb5=String(_0x59c10b);});python_process[_0x3f84('0x34')]['on'](_0x3f84('0x35'),function(_0x38392c){if(_0x5cccb5)return _0x20b29b['status'](0x1f4)[_0x3f84('0x10')](_0x5cccb5);else return _0x20b29b[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x36')});});}catch(_0x4ff7c1){logger[_0x3f84('0x33')](_0x4ff7c1);return _0x20b29b['status'](0x1f4)['send'](_0x4ff7c1);}});app[_0x3f84('0x17')](_0x3f84('0x37'),function(_0x41a0e9,_0x1ad48a){if(os['platform']()==_0x3f84('0x21')){return _0x1ad48a[_0x3f84('0xf')](0xc8)['send']();}else{iwlist['scan'](nicInterface,function(_0x399989,_0x44142c){if(_0x399989)return _0x1ad48a['status'](0x1f4)['send'](_0x3f84('0x38'));else return _0x1ad48a['status'](0xc8)[_0x3f84('0x10')]({'serverMessage':'Retreived\x20wireless\x20connections','data':_0x44142c});});}});app[_0x3f84('0xc')](_0x3f84('0x37'),function(_0x47d0e1,_0x5b81a9){var _0x24b97e=undefined;var _0x4d0957='ctrl_interface=DIR=/var/run/wpa_supplicant\x20GROUP=netdev\x0a'+_0x3f84('0x39')+_0x3f84('0x3a');var _0x3e86d8=_0x3f84('0x3b')+'\x09ssid=\x22'+_0x47d0e1[_0x3f84('0x11')][_0x3f84('0x26')]+'\x22\x0a'+'\x09scan_ssid=1\x0a'+_0x3f84('0x3c')+_0x47d0e1[_0x3f84('0x11')]['password']+'\x22\x0a'+_0x3f84('0x3d')+_0x3f84('0x3e');if(_0x47d0e1['body'][_0x3f84('0x13')]){_0x24b97e=shell[_0x3f84('0x3f')](_0x3f84('0x40')+_0x47d0e1['body'][_0x3f84('0x26')]+_0x3f84('0x41')+_0x47d0e1[_0x3f84('0x11')][_0x3f84('0x13')]+'\x22',{'silent':!![]})[_0x3f84('0x34')];}else{_0x24b97e=_0x3f84('0x3b')+_0x3f84('0x42')+_0x47d0e1[_0x3f84('0x11')]['ssid']+'\x22\x0a'+'\x20\x20\x20\x20key_mgmt=NONE\x0a'+'}\x0a';}let _0x4d5b7b='';if(_0x47d0e1['body'][_0x3f84('0x43')])_0x4d5b7b=_0x4d0957+_0x3e86d8;else _0x4d5b7b=_0x4d0957+_0x24b97e;fs[_0x3f84('0x44')](_0x3f84('0x45'),_0x4d5b7b,function(_0x20e141){if(_0x20e141)return _0x5b81a9['status'](0x1f4)[_0x3f84('0x10')](_0x20e141);shell[_0x3f84('0x3f')](_0x3f84('0x46')+nicInterface+_0x3f84('0x47'),{'silent':!![]});const _0x42f686=0x3a98;var _0x296c00=0x12c;var _0x4997bc=0x0;var _0x3e9760=setInterval(function(){var _0x3c53c1=[_0x3f84('0x48'),_0x3f84('0x49'),_0x3f84('0x4a'),'DISCONNECTED',_0x3f84('0x4b')];wpa_cli[_0x3f84('0xf')](nicInterface,function(_0x588d24,_0x4b7ff0){if(_0x588d24)return _0x5b81a9[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x588d24);if(_0x4b7ff0[_0x3f84('0x4c')]==_0x3f84('0x4d')){if(_0x4b7ff0['ip']){logger[_0x3f84('0x33')](_0x3f84('0x4e')+_0x4b7ff0['ip']+'\x20assigned');clearInterval(_0x3e9760);FusionSettings['SocketVariables'][_0x3f84('0x4f')]=_0x4b7ff0;io[_0x3f84('0x50')]['emit']('wifi-connection',_0x4b7ff0);return _0x5b81a9[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x51')+_0x47d0e1[_0x3f84('0x11')][_0x3f84('0x26')]+_0x3f84('0x52')});}else if(_0x4997bc>_0x42f686){logger[_0x3f84('0x33')](_0x3f84('0x53'));clearInterval(_0x3e9760);return _0x5b81a9[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')]('Error\x20connecting\x20to\x20'+_0x47d0e1[_0x3f84('0x11')][_0x3f84('0x26')]);}_0x4997bc+=_0x296c00;}else if(_0x3c53c1[_0x3f84('0x54')](_0x4b7ff0[_0x3f84('0x4c')])==-0x1){clearInterval(_0x3e9760);io['sockets'][_0x3f84('0x55')](_0x3f84('0x56'),_0x4b7ff0);return _0x5b81a9[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3f84('0x57')+_0x47d0e1[_0x3f84('0x11')][_0x3f84('0x26')]);}});},_0x296c00);});});app['get'](_0x3f84('0x58'),function(_0x272db9,_0x554a69){if(os[_0x3f84('0x20')]()=='win32'){_0x554a69[_0x3f84('0xf')](0x1f4)['send'](_0x3f84('0x59'));}else{var _0x2fd879=_0x3f84('0x5a')+_0x3f84('0x39')+_0x3f84('0x3a');fs[_0x3f84('0x44')](_0x3f84('0x45'),_0x2fd879,function(_0x43e203){if(_0x43e203)return _0x554a69[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x43e203);shell[_0x3f84('0x3f')](_0x3f84('0x46')+nicInterface+_0x3f84('0x47'),{'silent':!![]});var _0x54ac1e=setInterval(function(){var _0x336507=[];wpa_cli['status'](nicInterface,function(_0x3e9453,_0x33c700){if(_0x3e9453)return _0x554a69[_0x3f84('0xf')](0x1f4)['send'](_0x3e9453);FusionSettings[_0x3f84('0x5b')][_0x3f84('0x4f')]=_0x33c700;io[_0x3f84('0x50')][_0x3f84('0x55')]('wifi-connection',_0x33c700);if(_0x33c700[_0x3f84('0x4c')]==_0x3f84('0x5c')||_0x33c700[_0x3f84('0x4c')]==_0x3f84('0x5d')){clearInterval(_0x54ac1e);io[_0x3f84('0x50')][_0x3f84('0x55')]('wifi-connection',_0x33c700);return _0x554a69['status'](0xc8)['json']({'serverMessage':_0x3f84('0x5e')});}else if(connectingStatuses[_0x3f84('0x54')](_0x33c700['wpa_state'])==-0x1){clearInterval(_0x54ac1e);io[_0x3f84('0x50')][_0x3f84('0x55')]('wifi-connection',_0x33c700);return _0x554a69[_0x3f84('0xf')](0x1f4)['send'](_0x3f84('0x5f'));}});},0x12c);});}});app[_0x3f84('0x17')](_0x3f84('0x60'),function(_0x36ef83,_0x3b7c83){var _0x2c787a=_0x3f84('0x61');fs[_0x3f84('0x62')](_0x2c787a,function(_0x747131,_0x1f3ecd){if(_0x747131)return _0x3b7c83[_0x3f84('0xf')](0x1f4)['send'](_0x747131);if(_0x1f3ecd['length']>0x0){fs[_0x3f84('0x29')](_0x2c787a+'/'+_0x1f3ecd[0x0],_0x3f84('0x23'),function(_0x542b62,_0x4f0ae4){if(_0x542b62)return status(0x1f4)[_0x3f84('0x10')](_0x3f84('0x63'));_0x3b7c83[_0x3f84('0x64')]('Content-disposition',_0x3f84('0x65')+_0x1f3ecd[0x0]);return _0x3b7c83[_0x3f84('0xf')](0xc8)['download'](_0x2c787a+'/'+_0x1f3ecd[0x0]);});}else{return _0x3b7c83[_0x3f84('0xf')](0xc8)['send'](_0x3f84('0x66'));}});});var _0x4fb7e4=null;app[_0x3f84('0xc')](_0x3f84('0x67'),function(_0x23ff8a,_0x4e9dfc){if(os[_0x3f84('0x20')]()!=_0x3f84('0x21')){_0x4fb7e4=spawn('sudo',['sh',_0x3f84('0x68'),_0x3f84('0x69')]);_0x4fb7e4[_0x3f84('0x34')]['on'](_0x3f84('0x32'),function(_0x2a5ca1){logger[_0x3f84('0x33')](String(_0x2a5ca1));});_0x4fb7e4['stderr']['on'](_0x3f84('0x32'),function(_0xe77f96){logger[_0x3f84('0x33')](String(_0xe77f96));});var _0xd7a6a5=0x1;var _0x1e9ad1=0x3;var _0x513d12=setInterval(function(){if(_0xd7a6a5<=_0x1e9ad1){var _0x14070a=shell['exec'](_0x3f84('0x6a'),{'silent':!![]})[_0x3f84('0x34')];if(_0x14070a){clearInterval(_0x513d12);FusionSettings[_0x3f84('0x5b')][_0x3f84('0x6b')]={'process':_0x14070a,'socket':_0x23ff8a[_0x3f84('0x11')][_0x3f84('0x6c')]};io['sockets'][_0x3f84('0x55')](_0x3f84('0x6d'),FusionSettings[_0x3f84('0x5b')][_0x3f84('0x6b')]);return _0x4e9dfc[_0x3f84('0xf')](0xc8)['json']({'serverMessage':'Diagnostic\x20tool\x20started\x20successfully'});}else{_0xd7a6a5++;}}else{clearInterval(_0x513d12);return _0x4e9dfc[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3f84('0x6e'));}},0x12c);}else{return _0x4e9dfc[_0x3f84('0xf')](0xc8)['json']({'serverMessage':'Diagnostic\x20tool\x20does\x20not\x20run\x20on\x20windows'});}});app[_0x3f84('0x17')](_0x3f84('0x6f'),function(_0x1a005c,_0x43ee5e){if(os[_0x3f84('0x20')]()!='win32'){shell['exec'](_0x3f84('0x70'),{'silent':!![]});shell[_0x3f84('0x3f')](_0x3f84('0x6a'),{'silent':!![]},function(_0x3814f8,_0x55343a,_0xa7f9e3){(function(_0x45985e){var _0x480219=_0x45985e[_0x3f84('0x71')]();if(_0x480219){return _0x43ee5e[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x3f84('0x72'));}else{FusionSettings[_0x3f84('0x5b')]['fusion_diagnostics_running']=null;io[_0x3f84('0x50')][_0x3f84('0x55')](_0x3f84('0x6d'),FusionSettings['SocketVariables'][_0x3f84('0x6b')]);_0x4fb7e4=null;return _0x43ee5e[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x73')});}}(_0x55343a[_0x3f84('0x71')]()));});}else{return _0x43ee5e[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x74')});}});app[_0x3f84('0x17')]('/api/autonomous',async function(_0x38d4a0,_0x4e8c10){try{const _0x237159=await autonomous[_0x3f84('0xd')]()[_0x3f84('0x3f')]();return _0x4e8c10[_0x3f84('0x15')](_0x237159);}catch(_0x2c5b68){return _0x4e8c10['status'](0x1f4)[_0x3f84('0x10')](error['message']);}});app['post'](_0x3f84('0x75'),async function(_0x5d2f31,_0x33e45e){try{const _0x101569=await autonomous[_0x3f84('0x76')]({},_0x5d2f31[_0x3f84('0x11')]);return _0x33e45e[_0x3f84('0xf')](0xc8)[_0x3f84('0x15')]({'serverMessage':_0x3f84('0x77')});}catch(_0x5cb72e){return _0x33e45e[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0x5cb72e[_0x3f84('0x78')]);}});app[_0x3f84('0xc')]('/api/autonomousPrograms',async function(_0xd9fa8c,_0x1edf9a){try{const _0x1c153d=_0xd9fa8c[_0x3f84('0x11')][_0x3f84('0xe')];const _0x175926=_0xd9fa8c['body']['type'];const _0x19d479=await fs[_0x3f84('0x62')]('./app/filesystem/'+_0x1c153d+'/'+_0x175926);return _0x1edf9a[_0x3f84('0xf')](0xc8)['json']({'files':_0x19d479});}catch(_0xe963a8){return _0x1edf9a[_0x3f84('0xf')](0x1f4)[_0x3f84('0x10')](_0xe963a8[_0x3f84('0x78')]);}});function _0x120ef7(){return function(_0x5319cb,_0x4e417e,_0x5c592b){if(_0x5319cb['isAuthenticated']()){return _0x5c592b();}else{_0x4e417e[_0x3f84('0xf')](0x191)[_0x3f84('0x10')](_0x3f84('0x79'));}};}}();