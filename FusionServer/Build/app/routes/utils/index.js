!function(){var e=require("os"),r=require("child_process").spawn,s=require("shelljs");const t=require("../../utils/logger"),o=require("../../express"),n=require("../../socket"),a=require("../../global/fusionSettings");var g;module.exports=(g=null,o.route("/api/util/dataLogger/start").post((function(o,i){if("5.15.0-50-generic"==e.release())return i.status(500).json({serverMessage:"Data Logger does not run on windows"});(g=r("sudo",["sh","../../logging/runRemi.sh","../../logging/dataLogger.py",o.user.username])).stdout.on("data",(function(e){t.info(String(e))})),g.stderr.on("data",(function(e){t.error(String(e))}));var u=1,l=setInterval((function(){if(!(u<=3))return clearInterval(l),i.status(500).send("Error starting data logger");var e=s.exec("ps aux | grep '[s]udo python ../../logging/dataLogger.py' | awk '{print $2}'",{silent:!0}).stdout;if(t.info("process number "+e),e)return t.info("process found"),clearInterval(l),a.SocketVariables.fusion_dataLogger_running={process:e,socket:o.body.socketId},n.sockets.emit("dataLogger_running",a.SocketVariables.fusion_dataLogger_running),i.status(200).json({serverMessage:"Data logger started successfully"});t.info("process not found"),u++}),300)})),void o.route("/api/util/dataLogger/stop").get((function(r,t){if("5.15.0-50-generic"==e.release())return t.status(200).json({serverMessage:"Data Logger does not run on windows"});s.exec("sudo kill $(ps aux | grep '[s]udo python ../../logging/dataLogger.py' | awk '{print $2}')",{silent:!0}),s.exec("ps aux | grep '[s]udo python ../../logging/dataLogger.py' | awk '{print $2}'",{silent:!0},(function(e,r,s){r.trim().trim()?t.status(500).send("Unable to stop data logger"):(a.SocketVariables.fusion_dataLogger_running=null,n.sockets.emit("dataLogger_running",a.SocketVariables.fusion_dataLogger_running),g=null,t.status(200).json({serverMessage:"Data logger stopped successfully"}))}))})))}();