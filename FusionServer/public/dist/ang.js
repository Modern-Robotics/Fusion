"use strict";angular.module("fusionApp",["ui.router","ngMaterial","ui.ace","ngAnimate","ngSanitize","ngFileUpload"]),angular.module("fusionApp").factory("appFactory",["$mdToast","$http","$mdDialog",function(e,t,o){var n={};return n.data={CurrentPageTitle:"",SubTitle:""},n.showToast=function(t,o){t||("error"==o?t="Error communicating with server":"error"==o&&t.length>30&&(t="Error communicating with server"));e.show(e.simple().textContent(t).position("bottom").hideDelay(2e3).capsule(!1).theme(o+"-toast"))},n.showAlert=function(e,t,n){o.show(o.alert().clickOutsideToClose(!0).title(t).htmlContent(n).ariaLabel("Alert Dialog Demo").ok("Ok!").targetEvent(e))},n.PowerOff=function(){return t.get("/api/admin/powerOff").then(function(e){n.showToast(e.data.serverMessage,"success")},function(e){n.showToast(e,"error")})},n.Restart=function(){return t.get("/api/admin/restart").then(function(e){n.showToast(e.data.serverMessage,"success")},function(e){n.showToast(e,"error")})},n.updateFusion=function(){return t.get("/api/fusion/update",{}).then(function(e){n.showToast("Updating...","success")},function(e){n.showToast("Error updating Fusion","error")})},n.restoreFusion=function(){return t.get("/api/fusion/restore",{}).then(function(e){n.showToast("Restoring...","success")},function(e){n.showToast("Error updating Fusion","error")})},n.ChangePageTitle=function(e){n.data.CurrentPageTitle=e},n.ChangePageSubTitle=function(e){n.data.SubTitle=e},n}]),angular.module("fusionApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){o.html5Mode(!0),t.otherwise("/User/Login"),e.state("register",{url:"/User/Register",templateUrl:"app/components/user/register/register.htm",controller:"registerCtrl",data:{NeedsAdmin:!1,NeedsLogin:!1,AllowGuest:!0}}).state("account",{url:"/User/Account",templateUrl:"app/components/user/account/account.htm",controller:"accountCtrl",data:{NeedsAdmin:!1,NeedsLogin:!0,AllowGuest:!1}}).state("login",{url:"/User/Login",templateUrl:"app/components/user/login/login.htm",controller:"loginCtrl",data:{NeedsAdmin:!1,NeedsLogin:!1,AllowGuest:!0}}).state("recover",{url:"/User/Recover",templateUrl:"app/components/user/recover/recover.htm",controller:"recoverCtrl",data:{NeedsAdmin:!1,NeedsLogin:!1,AllowGuest:!0}}).state("home",{url:"/Home",templateUrl:"/app/components/home/home.htm",controller:"homeCtrl",data:{NeedsAdmin:!1,NeedsLogin:!1,AllowGuest:!0}}).state("documentation",{url:"/Documentation",templateUrl:"/app/components/documentation/documentation.htm",controller:"documentationCtrl",data:{NeedsAdmin:!1,NeedsLogin:!1,AllowGuest:!0}}).state("editor",{url:"/Editor",templateUrl:"/app/components/editor/editor.htm",controller:"editorCtrl",data:{NeedsAdmin:!1,NeedsLogin:!0,AllowGuest:!0}}).state("blockly",{url:"/Blockly",templateUrl:"/app/components/blockly/blockly.htm",controller:"blocklyCtrl",data:{NeedsAdmin:!1,NeedsLogin:!0,AllowGuest:!0}}).state("vnc",{url:"/VNC",templateUrl:"/app/components/vnc/vnc.htm",controller:"vncCtrl",data:{NeedsAdmin:!1,NeedsLogin:!0,AllowGuest:!1}}).state("settings",{url:"/Settings",templateUrl:"/app/components/settings/settings.htm",controller:"settingsCtrl",data:{NeedsAdmin:!0,NeedsLogin:!0,AllowGuest:!1}})}]),angular.module("fusionApp").run(["$rootScope","$state","$transitions","userFactory","appFactory","$location",function(e,t,o,n,a,r){n.validateCookie().then(function(e){n.User.username&&r.path(r.path()),o.onStart({to:function(e){return!!e.data.NeedsLogin}},function(e){var t=e.router.stateService;n.User.username||(a.showToast("Must login first","error"),t.go("login"))}),o.onStart({to:function(e){return!e.data.AllowGuest}},function(e){e.router.stateService;if("Guest"==n.User.usergroup)return a.showToast("Guest account not allowed","error"),!1}),o.onStart({to:function(e){return!!e.data.NeedsAdmin}},function(e){var t=e.router.stateService;"Admin"!=n.User.usergroup&&(a.showToast("User does not have access","error"),t.go("home"))})})}]),angular.module("fusionApp").config(["$mdThemingProvider",function(e){e.theme("success-toast"),e.theme("error-toast"),e.theme("info-toast")}]),angular.module("fusionApp").config(["$httpProvider",function(e){e.interceptors.push(["$q","$state",function(e,t){return{request:function(e){return e},requestError:function(t){return e.reject(t)},response:function(e){return e},responseError:function(o){return 401===o.status?(t.go("login"),e.reject(o)):e.reject(o)}}}]),e.defaults.withCredentials=!0}]),angular.module("fusionApp").factory("socketFactory",["appFactory","$rootScope","$state","userFactory","$mdDialog",function(e,t,o,n,a){var r={};return r.data={DisconnectionEvent:null,BatteryLevel:null,VersionNumber:null,InternetAccess:null,ProgramRunning:{running:!1,user:"None"},UpdateAvailable:null,WifiConnection:{ssid:null,ip:null}},r.Socket=null,r.OpenSocketCommunication=function(){r.Socket=io.connect("",{reconnection:!0,reconnectionDelay:1e3,transports:["websocket"]}),r.Socket.on("connect",function(e){r.Socket.emit("join","Hello World from client")}),r.Socket.on("reconnect",function(e){a.hide();n.ChangeUser({username:null,firstname:null,lastname:null,language:null,email:null,defaultprogramminglanguage:null,filepath:null,usergroup:null,workingEditorFiles:[],blocklyProgram:{name:null,xml:null}}),o.go("login")}),r.Socket.on("disconnect",function(t){e.showToast("Disconnected from server.","error"),a.show({template:'<md-dialog>   <md-dialog-content class="md-dialog-content">       <h3>Server down. Attempting to to reconnect.</h3>           <p>Please make sure you are connected to the Fusion\'s wireless network.</p>       <div layout="row" layout-sm="column" layout-align="space-around">           <md-progress-circular md-mode="indeterminate"></md-progress-circular>       </div>   </md-dialog-content></md-dialog>',parent:angular.element(document.body),escapeToClose:!1})}),r.Socket.on("global-message",function(t){e.showToast(t.message,t.type)}),r.Socket.on("battery-level",function(e){r.data.BatteryLevel=e,t.$digest()}),r.Socket.on("version-number",function(e){r.data.VersionNumber="Fusion - "+e,t.$digest()}),r.Socket.on("internet-access",function(e){r.data.InternetAccess=e,t.$digest()}),r.Socket.on("program-running",function(e){r.data.ProgramRunning.running=e.running,r.data.ProgramRunning.user=e.user,t.$digest()}),r.Socket.on("update-available",function(o){0==r.data.UpdateAvailable&&1==o&&e.showToast("Update Available","success"),r.data.UpdateAvailable=o,t.$digest()}),r.Socket.on("wifi-connection",function(e){r.data.WifiConnection.ssid=e.ssid,r.data.WifiConnection.ip=e.ip,t.$digest()})},r}]),angular.module("fusionApp").factory("userFactory",["$http","appFactory","$state",function(e,t,o){var n={};return n.User={username:null,firstname:null,lastname:null,language:null,email:null,defaultprogramminglanguage:null,filepath:null,usergroup:null,workingEditorFiles:[],blocklyProgram:{},blocklySettings:{Mode:"intermediate",ShowCode:!0,ShowConsole:!0}},n.languages=["en-us"],n.userGroups=["Admin","User"],n.allowedUserGroups=[],n.securityQuestions=["Who is your favorite actor, musician, or artist?","What is the name of your favorite pet?","In what city were you born?","What high school did you attend?","What is your favorite movie?"],n.GetAll=function(){return e.get("/api/users").then(function(e){return e.data},function(e){return e})},n.Create=function(a){return e.post("/api/users",a).then(function(e){return t.showToast(e.data.serverMessage,"success"),n.ChangeUser(e.data.user),o.go("home"),e.data},function(e){return t.showToast(e.data,"error"),e})},n.Get=function(t){return e.get("/api/users/"+t).then(function(e){return e.data},function(e){return e})},n.Update=function(o,n){return e.put("/api/users/"+o,n).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data,"error"),e})},n.Delete=function(o){return e.delete("/api/users/"+o).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data,"error"),e})},n.Login=function(a){return e.post("/api/users/login",a).then(function(e){return t.showToast(e.data.serverMessage,"success"),n.ChangeUser(e.data.user),o.go("home"),e.data},function(e){return $("#loginContainer").effect("shake"),t.showToast(e.data,"error"),e})},n.Logout=function(){var a={username:null,firstname:null,lastname:null,language:null,email:null,defaultprogramminglanguage:null,filepath:null,usergroup:null,workingEditorFiles:[],blocklyProgram:{name:null,xml:null}};return e.post("/api/users/logout").then(function(e){return t.showToast(e.data.serverMessage,"success"),n.ChangeUser(a),o.go("login"),e.data},function(e){return t.showToast(e.data,"error"),e})},n.GetSecurityQuestion=function(t){return e.get("/api/recovery/"+t).then(function(e){return e.data},function(e){return e})},n.LoginWithSecurityAnswer=function(a,r){return e.post("/api/recovery",a).then(function(e){return t.showToast(e.data.serverMessage,"success"),n.ChangeUser(e.data.user),o.go("account"),t.showAlert(r,"Reminder","Please update your password"),e.data},function(e){return $("#recoveryContainer").effect("shake"),t.showToast(e.data,"error"),e})},n.GetAllowedGroups=function(){return e.get("/api/allowedUserGroups").then(function(e){n.allowedUserGroups=e.data},function(e){n.allowedUserGroups=e})},n.validateCookie=function(){return e.get("/api/cookie").then(function(e){n.ChangeUser(e.data)},function(e){})},n.ChangeUser=function(e){n.User.username=e.username,n.User.firstname=e.firstname,n.User.lastname=e.lastname,n.User.language=e.language,n.User.email=e.email,n.User.defaultprogramminglanguage=e.defaultprogramminglanguage,n.User.filepath=e.filepath,n.User.usergroup=e.usergroup,n.User.workingEditorFiles=[],n.User.blocklyProgram={Name:null,Code:null},n.User.blocklySettings={Mode:"intermediate",ShowCode:!0,ShowConsole:!0}},n}]),angular.module("fusionApp").factory("settingsFactory",["$http","$interval","appFactory","userFactory",function(e,t,o,n){var a={};return a.CreateUser=function(t){return e.post("/api/admin/users",t).then(function(e){return $("#createUserModal").modal("hide"),o.showToast(e.data.serverMessage,"success"),null},function(e){return o.showToast(e.data,"error"),t})},a.DeleteUser=function(t){return e.delete("/api/users/"+t).then(function(e){return o.showToast(e.data.serverMessage,"success"),e.data},function(e){return o.showToast(e.data,"error"),e})},a.GetWifiSettings=function(){return e.get("/api/admin/wirelessSettings").then(function(e){return e.data},function(e){return o.showToast(e.data,"error"),data})},a.SetWifiSettings=function(t){return e.post("/api/admin/wirelessSettings",t).then(function(e){return o.showToast(e.data.serverMessage,"success"),e.data},function(e){o.showToast(e.serverMessage,"error")})},a.GetWirelessConnections=function(){return e.get("/api/admin/wirelessConnections").then(function(e){return e.data.data},function(e){return o.showToast(e.data,"error"),[]})},a.SetWirelessConnection=function(t){return e.post("/api/admin/wirelessConnections",t).then(function(e){return o.showToast(e.data.serverMessage,"success"),e.data},function(e){return o.showToast(e,"error"),e})},a.getSpartanPiSettings=function(){return e.post(o.data.BaseUrl+"getSettings",{}).then(function(e){return e.data},function(e){toastFactory.showMessage(e.data,"red")})},a.setSpartanPiSettings=function(t,n){var a={wifiName:t,wifiPassword:n};return e.post(o.data.BaseUrl+"setSettings",a).then(function(e){return toastFactory.showMessage("Settings updated successfully","green"),e.data},function(e){toastFactory.showMessage(e.data,"red")})},a.getSpartanPiUsers=function(){},a.getLatestSpartanPiVersion=function(){return e.get(o.data.MriUrl+"SpartanPis/getLatestRelease",{}).then(function(e){return e.data},function(e){toastFactory.showMessage(e.data,"red")})},a}]),angular.module("fusionApp").factory("blocklyFactory",["$http","appFactory","socketFactory",function(e,t,o){var n={};return n.GetPrograms=function(){return e.get("/api/blockly").then(function(e){return 0==e.data.length&&t.showToast("User has no saved programs","error"),e.data},function(e){return e})},n.GetProgram=function(t){return e.get("/api/blockly/"+t).then(function(e){return e.data},function(e){return e})},n.CreateProgram=function(o){return e.post("/api/blockly",o).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},n.DeleteProgram=function(o){return e.delete("/api/blockly/"+o).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},n.UpdateProgram=function(o,n){return e.put("/api/blockly/"+o,n).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},n.StartProgram=function(n){return n.socketId=o.Socket.id,e.post("/api/blockly/start",n).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},n.StopProgram=function(){return e.post("/api/blockly/stop").then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},n.GetExampleCode=function(t){return e.post("/api/blocklySamplePrograms",t).then(function(e){return e.data},function(e){return e})},n}]),angular.module("fusionApp").factory("editorFactory",["$http","appFactory","userFactory","socketFactory",function(e,t,o,n){var a={};return a.programmingLanguages=["Python"],a.GetPrograms=function(){return e.get("/api/programs").then(function(e){return 0==e.data.length&&t.showToast("User has no saved programs","error"),e.data},function(e){return e})},a.GetProgram=function(t){return e.get("/api/programs/"+t).then(function(e){return e.data},function(e){return e})},a.CreateProgram=function(o){return e.post("/api/programs",o).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},a.DeleteProgram=function(o){return e.delete("/api/programs/"+o).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){throw t.showToast(e.data,"error"),"File Does Not Exist"})},a.UpdateProgram=function(o,n){return e.put("/api/programs/"+o,n).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data,"error"),e})},a.StartProgram=function(o){var a={socketId:n.Socket.id};return e.post("/api/programs/start/"+o,a).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data,"error"),e})},a.StopProgram=function(){return e.post("/api/programs/stop").then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data.serverMessage,"error"),e})},a.GetExampleCode=function(t){return e.post("/api/samplePrograms",t).then(function(e){return e.data},function(e){return e})},a.RunExample=function(o){var a={filepath:o,socketId:n.Socket.id};return e.post("api/samplePrograms/run",a).then(function(e){return t.showToast(e.data.serverMessage,"success"),e.data},function(e){return t.showToast(e.data,"error"),e})},a.addToWorkingFiles=function(e){for(var t=0;t<o.User.workingEditorFiles.length;t++)o.User.workingEditorFiles[t].Selected=!1;o.User.workingEditorFiles.push({Name:e.filename,Code:e.code,NeedsSaving:!1,Filepath:o.User.filepath+"/Editor/"+e.filename,Selected:!0})},a.removeFromWorkingFiles=function(e){for(var t=0;t<o.User.workingEditorFiles.length;t++)o.User.workingEditorFiles[t].Name==e&&o.User.workingEditorFiles.splice(t,1)},a}]),angular.module("fusionApp").controller("socketCtrl",["$scope","socketFactory",function(e,t){t.OpenSocketCommunication()}]),angular.module("fusionApp").controller("headerCtrl",["$scope","appFactory","socketFactory","userFactory","$location",function(e,t,o,n,a){e.user=n.User;var r=o.data;e.appData=t.data,e.getBatteryLevelClass=function(){return r.BatteryLevel>78?"fa-battery-full":r.BatteryLevel>55&&r.BatteryLevel<=78?"fa-battery-three-quarters":r.BatteryLevel>33&&r.BatteryLevel<=55?"fa-battery-half":r.BatteryLevel>10&&r.BatteryLevel<=33?"fa-battery-quarter":"fa-battery-empty"},e.getInternetAccessClass=function(){return o.data.InternetAccess?"fa-globe":"fa-exclamation-triangle"},e.getProgramRunningClass=function(){return 1==!o.data.ProgramRunning.running?"fa-stop":"fa-play"},e.getWifiConnectedClass=function(){return"No Connection"==o.data.WifiConnection.ssid?"fa-chain-broken":"fa-wifi"},e.openSidebar=function(){document.getElementById("fusionSidebar").style.display="block",document.getElementById("fusionOverlay").style.display="block"},e.showWifiDetails=function(e){var n="Connection: "+o.data.WifiConnection.ssid;n+="<br>",n+="IP: "+o.data.WifiConnection.ip,t.showAlert(e,"Wireless Details",n)},e.showInternetDetails=function(e){var n="",a="Access: "+(n=o.data.InternetAccess?"Available":"Not Available");t.showAlert(e,"Internet Details",a)},e.showProgramDetails=function(e){void 0==o.data.ProgramRunning.running&&(o.data.ProgramRunning.running=!1),void 0==o.data.ProgramRunning.user&&(o.data.ProgramRunning.user="None");var n="Program Running: "+o.data.ProgramRunning.running;n+="<br>",n+="User: "+o.data.ProgramRunning.user,t.showAlert(e,"Program Details",n)},e.showBatteryDetails=function(e){var n;n=-1==o.data.BatteryLevel?"Battery Level: No Battery Connected":"Battery Level: "+o.data.BatteryLevel+" %",t.showAlert(e,"Battery Details",n)},e.userLoggedIn=function(){return!!e.user.username},e.showLoginHeaderButton=function(){var t=!1;return"/Home"==a.path()&&0==e.userLoggedIn()&&(t=!0),t}}]),angular.module("fusionApp").controller("sidebarCtrl",["$scope","appFactory","userFactory","socketFactory","$mdDialog","$http","$window",function(e,t,o,n,a,r,i){e.user=o.User,e.socketData=n.data,e.releaseNotes,e.logout=function(){o.Logout(),a.hide()},e.powerOff=function(){o.Logout().then(function(e){t.PowerOff()}),a.hide()},e.restart=function(){o.Logout().then(function(e){t.Restart()}),a.hide()},e.showReleaseNotes=function(t){r.get("/api/fusion/releaseNotes").then(function(t){t.data.data;e.releaseNotes=t.data.data,a.show({contentElement:"#releaseNotesDialog",parent:angular.element(document.body),clickOutsideToClose:!0}),e.closeSidebar()},function(e){})},e.showFusionPowerOptions=function(){a.show({contentElement:"#powerOffOptionsDialog",parent:angular.element(document.body),clickOutsideToClose:!0}),e.closeSidebar()},e.takeToDocs=function(){i.open("assets/docs/fusion/","_target"),e.closeSidebar()},e.takeToAbout=function(){i.open("assets/docs/fusion/About/","_target"),e.closeSidebar()},e.displayUserName=function(){var t=e.user.username;return t||"No User"},e.userLoggedIn=function(){return!!e.user.username},e.closeSidebar=function(){document.getElementById("fusionSidebar").style.display="none",document.getElementById("fusionOverlay").style.display="none"}}]),angular.module("fusionApp").controller("registerCtrl",["$scope","userFactory","appFactory",function(e,t,o){o.ChangePageTitle("- Register New User -"),e.languages=t.languages,e.securityQuestions=t.securityQuestions,t.GetAllowedGroups().then(function(){e.userGroups=t.allowedUserGroups}),e.registerUser=function(){if(e.Password!=e.Password2)o.showToast("Passwords do not match","error");else{var n={username:e.UserName,password:e.Password,usergroup:e.UserGroup,securityquestion:e.SecurityQuestion,securityanswer:e.SecurityAnswer};e.Email&&(n.email=e.Email),e.FirstName&&(n.firstname=e.FirstName),e.LastName&&(n.lastname=e.LastName),e.Language&&(n.language=e.Language),t.Create(n)}}}]),angular.module("fusionApp").controller("accountCtrl",["$scope","userFactory","appFactory","$window",function(e,t,o,n){o.ChangePageTitle("- User Account -"),e.user=t.User,e.languages=t.languages,e.userGroups=t.userGroups,e.securityQuestions=t.securityQuestions,e.disableField=function(){return!0},e.updateAccount=function(){var n={};e.NewPassword1!=e.NewPassword2?o.showToast("Passwords do not match","error"):(e.user.username&&(n.username=e.user.username),e.user.email&&(n.email=e.user.email),e.user.firstname&&(n.firstname=e.user.firstname),e.user.lastname&&(n.lastname=e.user.lastname),e.user.language&&(n.language=e.user.language),e.user.usergroup&&(n.usergroup=e.user.usergroup),e.NewPassword1&&(n.password=e.NewPassword1),e.NewSecurityQuestion&&(n.securityquestion=e.NewSecurityQuestion),e.NewSecurityAnswer&&(n.securityanswer=e.NewSecurityAnswer),t.Update(e.user.username,n))},e.returnToPrevious=function(){n.history.back()}}]),angular.module("fusionApp").controller("recoverCtrl",["$scope","userFactory","appFactory","$mdDialog",function(e,t,o,n){e.SecurityQuestion,e.SecurityAnswer,e.SecurityUsername,o.ChangePageTitle("- Recover Account -"),e.getUserSecurityQuestion=function(){t.GetSecurityQuestion(e.SecurityUsername).then(function(t){e.SecurityQuestion=t;var o=n.prompt().title(e.SecurityQuestion).ok("Okay!").cancel("Cancel");n.show(o).then(function(t){e.SecurityAnswer=t,e.validateUserSecurityAnswer()},function(){})})},e.validateUserSecurityAnswer=function(o){var n={username:e.SecurityUsername,password:" ",securityanswer:e.SecurityAnswer};t.LoginWithSecurityAnswer(n,o)}}]),angular.module("fusionApp").controller("loginCtrl",["$scope","userFactory","appFactory",function(e,t,o){e.ShowPassword=!1,e.login=function(){var o={username:e.UserName,password:e.Password};t.Login(o)},e.guestLogin=function(){t.Login({username:"mriguest",password:"mriguest"})},e.showPasswordToggle=function(){e.ShowPassword=!e.ShowPassword;var t=$("input")[1];e.ShowPassword?t.type="text":t.type="password"},e.stylePasswordToggle=function(){return e.ShowPassword?"fa fa-eye-slash":"fa fa-eye"},o.ChangePageTitle("- Login -")}]),angular.module("fusionApp").controller("homeCtrl",["$scope","appFactory","$window","$state","userFactory",function(e,t,o,n,a){t.ChangePageTitle("- Home -"),e.HomePageShortCutDisabled=function(e){var t=!0;switch(e){case"build":case"blockly":case"editor":case"docs":t=!1;break;case"server":t=!0;break;case"settings":t="Admin"!=a.User.usergroup}return t?"f-disabled":""},e.LinkClicked=function(e,t){o.open(e,t)},e.Launch=function(e){n.go(e)}}]),angular.module("fusionApp").controller("documentationCtrl",["$scope","$window","appFactory",function(e,t,o){e.openDocumentation=function(e){e?t.open(e,"_blank"):alert("No documentation yet")},e.blocklyModules=[{ID:1,Name:"Blockly Documentation",Description:"Get started with Blockly.",Image:"/assets/img/documentation/pen-8-256x256.png",Color:"lightpink",Link:"/assets/docs/documentation/blockly/Core_Spartan_Documentation.pdf"},{ID:1,Name:"Blockly Documentation",Description:"Get started with Blockly.",Image:"/assets/img/documentation/pen-8-256x256.png",Color:"lightpink",Link:"/assets/docs/documentation/blockly/Core_Spartan_Documentation.pdf"}],e.editorModules=[],e.pythonModules=[{ID:1,Name:"Full Documentation",Description:"Read the full Python library here!",Image:"/assets/img/documentation/pythonLogo.png",Color:"lightblue",Link:"/assets/docs/documentation/python/Fusion_Lib.pdf"}],e.settingsModules=[]}]),angular.module("fusionApp").controller("blocklyCtrl",["$scope","appFactory","blocklyFactory","$mdDialog","userFactory","socketFactory","$state","$window","Upload","$sce",function(e,t,o,n,a,r,i,s,l,c){function u(e,t,o,n,a,r){this.Name=e,this.Code=t,this.Filepath=n,this.NeedsSaving=o,this.FileType=a,this.PreventUnsavedExit=r}u.prototype.save=function(){var t=this,n=this.Name,a=this.FileType,r={code:this.Code};return new Promise(function(i,s){"example"==a?t.saveAs().then(function(){i()}):"new"==a?t.saveAs().then(function(){i()}):"existing"==a&&o.UpdateProgram(n,r).then(function(t){e.SelectedFile.NeedsSaving=!1,i()})})},u.prototype.saveAs=function(){var a=this.Name;this.FileType,this.Code;return new Promise(function(r,i){var s=n.prompt().title("What would you like to name your file?").ariaLabel("File Name").initialValue(a).ok("Okay!").cancel("Cancel");n.show(s).then(function(n){if(n){var i={filename:e.fixFileName(n),code:e.SelectedFile.Code};o.CreateProgram(i).then(function(t){a==i.filename?(e.SelectedFile.FileType="existing",e.SelectedFile.NeedsSaving=!1):e.OpenBlocklyFile(i.filename),r(t)})}else t.showToast("Must specify file name","error")},function(){i()})})},e.Settings=a.User.blocklySettings,e.CurrentFileName=null,e.BlocklyFile=a.User.blocklyProgram,e.SelectedFile,e.NewFileCounter=1,e.LoadBlocklyWorkSpace=function(){e.BlocklyFile.Name?e.LoadBlockyFile():e.CreateNewBlocklyFile()},e.CreateNewBlocklyFile=function(){o.GetPrograms().then(function(t){var o=e.GenerateNewFileName(t),n=new u(o,'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="fusion_start" id="rm},Hg5r!R|1VJsO3d0;" x="50" y="50"></block></xml>',!0,a.User.filepath+"/Blockly/"+o,"new",!1);a.User.blocklyProgram=n,e.LoadBlockyFile()})},e.LoadBlockyFile=function(){d.clear();var t=Blockly.Xml.textToDom(a.User.blocklyProgram.Code);Blockly.Xml.domToWorkspace(t,d),e.SelectedFile=a.User.blocklyProgram},e.displaySaveSymbol=function(e){return e?"*":""},e.GenerateNewFileName=function(t){var o="Untitled"+e.NewFileCounter+".blk";e.NewFileCounter++;for(var n=!1,a=0;a<t.length;a++)if(t[a]==o){n=!0;break}return n&&(o=e.GenerateNewFileName(t)),o},e.generateToolboxXml=function(e){var t;return"beginner"==e?t='<xml id="toolbox" style="display: none"><category name="Fusion Control" colour="120"><block type="fusion_start"></block><block type="fusion_basic_ledB"></block><block type="fusion_basic_ledY"></block><block type="fusion_basic_ledBY"></block><block type="fusion_basic_ledoff"></block><block type="fusion_basic_wait"></block></category><category name="Move Robot" colour="120"><block type="fusion_basic_forward"></block><block type="fusion_basic_backward"></block><block type="fusion_basic_fast"></block><block type="fusion_basic_medium"></block><block type="fusion_basic_slow"></block></category><category name="Rotate Robot" colour="120"><block type="fusion_basic_right45"></block><block type="fusion_basic_right90"></block><block type="fusion_basic_right180"></block><block type="fusion_basic_left45"></block><block type="fusion_basic_left90"></block><block type="fusion_basic_left180"></block></category></xml>':"intermediate"==e&&(t='<xml id="toolbox" style="display: none"><category id="fusionCategory" colour="0" name="Fusion Control"><block type="fusion_start"></block><block type="fusion_led"><field name="COLOUR">#ffff00</field></block><block type="fusion_led"><field name="COLOUR">#0000ff</field></block><block type="fusion_comment"></block><block type="fusion_end"></block></category><category id="fusionMotorsCategory" colour="0" name="Motors"><block type="fusion_motor"><field name="Motor">M0</field><value name="Power"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="fusion_motor"><field name="Motor">M1</field><value name="Power"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="fusion_drive"><value name="Power"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="fusion_drive_time"><value name="Power"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Time"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="fusion_rotate"><value name="Power"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="Time"><shadow type="math_number"><field name="NUM">1.5</field></shadow></value></block></category><category id="fusionServosCategory" colour="0" name="Servos"><block type="fusion_servo_target"><value name="target"><shadow type="math_number"><field name="NUM">128</field></shadow></value></block></category><category id="fusionSensorsCategory" colour="0" name="Sensors"><category name="Analog/Digital"><block type="fusion_analog_read"><field name="Port">A0</field></block><block type="fusion_digital_read"><field name="Port">D0</field></block><block type="fusion_digital_write"><field name="Port">D0</field></block></category><category name="Compass Sensor"><block type="fusion_compass_heading"></block><block type="fusion_compass_hardIronCalibration"></block><block type="fusion_compass_tiltUp"></block><block type="fusion_compass_tiltDown"></block><block type="fusion_compass_nullAccelerometer"><field name="axis">\'X\'</field></block><block type="fusion_compass_getAccelerometer"><field name="axis">0</field></block><block type="fusion_compass_getMagnetometer"><field name="axis">0</field></block><block type="fusion_compass_scaleAccelerometer"></block></category><category name="Rate Gyro"><block type="fusion_rate_gyro_read"><field name="Port">A0</field></block></category><category name="Integrating Gyro"><block type="fusion_intGyro_calibrate"></block><block type="fusion_intGyro_zero"></block><block type="fusion_intGyro_heading"></block></category><category name="Optical Distance Sensor"><block type="fusion_ods_read"><field name="Port">A0</field></block></category><category name="Touch Sensor"><block type="fusion_touch_read"><field name="Port">D0</field></block></category><category name="Range Sensor"><block type="fusion_range_sensor_us"></block><block type="fusion_range_sensor_ods"></block></category><category name="IR Locator 360Â°"><block type="fusion_locator_heading"></block><block type="fusion_locator_intensity"></block></category><category name="Light Sensor"><block type="fusion_light_read"><field name="Port">A0</field></block></category><category name="Sound Generator"><block type="fusion_sound_generator"><field name="volume">MEDIUM</field><field name="blocking">TRUE</field><value name="pitch"><shadow type="math_number"><field name="NUM">440</field></shadow></value><value name="duration"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="post_pause"><shadow type="math_number"><field name="NUM">0.5</field></shadow></value></block></category><category name="IR Seeker V3"><block type="fusion_seeker_heading"></block><block type="fusion_seeker_intensity"></block></category><category name="Color Sensor"><block type="fusion_color_sensor_setup_init"></block><block type="fusion_color_sensor_color_number"></block><block type="fusion_color_sensor_color_rgb"></block></category><category name="Color Beacon"><block type="fusion_color_beacon_set_color"></block><block type="fusion_color_beacon_set_custom_color"><value name="Red"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Green"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Blue"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block></category><category name="Magnetic Sensor"><block type="fusion_magnetic_read"><field name="Port">A0</field></block></category></category><category id="catTime" name="Time" colour="0"><block type="time_delay"><value name="delay"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></category><category id="catLogic" colour="0" name="Logic"><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="math_number_property"><value name="NUMBER_TO_CHECK"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_null"></block><block type="logic_ternary"></block></category><category id="catLoops" colour="0" name="Loops"><block type="controls_whileUntil"><value name="BOOL"><shadow type="logic_boolean"><field name="Boolean">true</field></shadow></value></block><block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="controls_whileUntil"></block><block type="controls_for"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="controls_forEach"></block><block type="controls_flow_statements"></block></category><category id="catMath" colour="0" name="Math"><block type="math_number"></block><block type="math_arithmetic"><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="math_single"><value name="NUM"><shadow type="math_number"><field name="NUM">9</field></shadow></value></block><block type="math_trig"><value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block><block type="math_constant"></block><block type="math_round"><value name="NUM"><shadow type="math_number"><field name="NUM">3.1</field></shadow></value></block><block type="math_on_list"></block><block type="math_modulo"><value name="DIVIDEND"><shadow type="math_number"><field name="NUM">64</field></shadow></value><value name="DIVISOR"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="math_constrain"><value name="VALUE"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="LOW"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="HIGH"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_float"></block></category><category id="catText" colour="0" name="Text"><block type="text_print"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text"></block><block type="text_join"></block><block type="text_append"><value name="TEXT"><shadow type="text"></shadow></value></block><block type="text_length"><value name="VALUE"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_isEmpty"><value name="VALUE"><shadow type="text"><field name="TEXT"></field></shadow></value></block><block type="text_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value><value name="FIND"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_charAt"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_getSubstring"><value name="STRING"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_changeCase"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_trim"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_prompt_ext"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_prompt_ext"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block></category><category id="catVariables" colour="0" custom="VARIABLE" name="Variables"></category><category id="catFunctions" colour="0" custom="PROCEDURE" name="Functions"></category></xml>'),t},e.fixFileName=function(e){return".blk"!=e.substr(e.length-4)?e+".blk":e},e.NewBlocklyFile=function(){if(e.SelectedFile.NeedsSaving&&e.SelectedFile.PreventUnsavedExit){var t=n.confirm().title("Save changes before opening new file?").ok("Okay!").cancel("No");n.show(t).then(function(t){e.SelectedFile.save().then(function(){e.CreateNewBlocklyFile()})},function(){e.CreateNewBlocklyFile()})}else e.CreateNewBlocklyFile()},e.OpenFileDialog=function(t){if(e.SelectedFile.NeedsSaving){var a=n.confirm().title("Save changes before opening new file?").ok("Okay!").cancel("No");n.show(a).then(function(t){e.SelectedFile.save().then(function(){o.GetPrograms().then(function(t){e.FilesAvailableForOpen=t,n.show({contentElement:"#blocklyOpenFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})})},function(){o.GetPrograms().then(function(t){e.FilesAvailableForOpen=t,n.show({contentElement:"#blocklyOpenFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})})}else o.GetPrograms().then(function(t){e.FilesAvailableForOpen=t,n.show({contentElement:"#blocklyOpenFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})},e.OpenBlocklyFile=function(r){n.hide(),e.SelectedFile.Name!=r?o.GetProgram(r).then(function(t){var o=new u(r,t,!1,a.User.filepath+"/Blockly/"+r,"existing",!0);a.User.blocklyProgram=o,e.LoadBlockyFile()}):t.showToast("File Already Open.","error")},e.SaveBlocklyFile=function(){e.SelectedFile.save()},e.SaveAsDialog=function(t){e.SelectedFile.saveAs()},e.DeleteDialog=function(t){var a=n.confirm().title("Are you sure you want to delete this file?").targetEvent(t).ok("Okay!").cancel("Cancel");n.show(a).then(function(t){o.DeleteProgram(e.SelectedFile.Name).then(function(t){e.CreateNewBlocklyFile()})},function(){})},e.PrintDialog=function(){var t=s.open("","PRINT","height=600,width=800");t.document.write("<html><head><title>"+e.SelectedFile.Name+"</title>"),t.document.write("</head><body >"),t.document.write("<h1>"+e.SelectedFile.Name+"</h1>"),t.document.write(document.getElementById("blocklyDiv").innerHTML),t.document.write("</body></html>"),t.document.close(),t.focus(),t.print()},e.runExistingBlocklyProgram=function(){if(e.blocklyOutputConsole="",e.SelectedFile.NeedsSaving)e.SelectedFile.save().then(function(){var e={code:document.createTextNode(Blockly.Python.workspaceToCode(d)).data};o.StartProgram(e)});else{var t={code:document.createTextNode(Blockly.Python.workspaceToCode(d)).data};o.StartProgram(t)}},e.stopRunningBlocklyProgram=function(){o.StopProgram()},e.UploadFilesDialog=function(){n.show({contentElement:"#blocklyUploadFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})},e.$watch("files",function(){e.upload(e.files)}),e.$watch("file",function(){null!=e.file&&(e.files=[e.file])}),e.log="",e.upload=function(t){if(t&&t.length)for(var o=0;o<t.length;o++){var n=t[o];n.$error||l.upload({url:"/api/programs/import",method:"POST",file:n}).then(function(t){e.log="file: "+t.config.file.name+", Response: "+JSON.stringify(t.data)+"\n"+e.log},function(t){e.log="file: "+t.config.file.name+", Response: "+JSON.stringify(t.data)+"\n"+e.log})}},e.DownloadFilesDialog=function(){o.GetPrograms().then(function(t){e.FilesForDownload=[];for(var o=0;o<t.length;o++)e.FilesForDownload.push({Name:t[o],Selected:!1});n.show({contentElement:"#blocklyDownloadFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})},e.DownloadEditorFiles=function(){for(var t=0;t<e.FilesForDownload.length;t++)e.FilesForDownload[t].Selected&&e.DownloadSingleEditorFile(e.FilesForDownload[t].Name);n.hide()},e.DownloadSingleEditorFile=function(e){o.GetProgram(e).then(function(t){var o=document.createElement("a");o.style.display="none",o.style.backgroundColor="red",o.href="data:attachment/text,"+encodeURI(t),o.target="_blank",o.download=e,o.click()})},e.openExampleProgram=function(t,n){var r={filepath:n};o.GetExampleCode(r).then(function(o){var r=new u(t,o,!1,n,"example",!0);a.User.blocklyProgram=r,e.LoadBlockyFile()})},e.takeToBlocklyDocs=function(){s.open("assets/docs/fusion/Blockly_Topic/","_blank")},e.hideDialog=function(){n.hide()};var d=Blockly.inject(blocklyDiv,{toolbox:e.generateToolboxXml(e.Settings.Mode),grid:{spacing:20,length:3,colour:"#ccc",snap:!0},zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2},trashcan:!0});e.resizeBlockly=function(){if("blockly"==i.current.name){var e=document.getElementsByClassName("f-blockly-toolbar"),t=document.getElementById("blocklyArea"),o=document.getElementById("blocklyDiv");e[0].offsetHeight;o.style.left=t.offsetLeft+"px",o.style.top=t.offsetTop+"px",o.style.width=t.offsetWidth+"px",o.style.height=t.offsetHeight+"px",Blockly.svgResize(d)}},$(window).resize(e.resizeBlockly),e.setToolbox=function(){d.updateToolbox(e.generateToolboxXml(e.Settings.Mode))},e.myUpdateFunction=function(t){$(".f-blockly-code")[0].childNodes[0].innerText=Blockly.Python.workspaceToCode(d);var o=Blockly.Xml.workspaceToDom(d),n=Blockly.Xml.domToText(o);e.SelectedFile.Code!=n&&(e.SelectedFile.Code=n,e.SelectedFile.NeedsSaving=!0,e.SelectedFile.PreventUnsavedExit=!0,e.$apply()),$("pre code").each(function(e,t){hljs.highlightBlock(t)})},d.addChangeListener(e.myUpdateFunction),e.showBlocklyCode=function(){var t,o={display:t=e.Settings.ShowCode?"":"none"};return e.resizeBlockly(),o},e.showBlocklyConsole=function(){var t,o={display:t=e.Settings.ShowConsole?"":"none"};return e.resizeBlockly(),o};var f=document.getElementById("blockly-output-console");r.Socket.on("blockly-console-output",function(t){if((o=t.output).includes("> Program Finished!")){o=t.output;e.blocklyOutputConsole+=o,e.$apply()}else{var o=t.output;e.blocklyOutputConsole=e.blocklyOutputConsole.slice(-(500-o.length))+o,e.$apply(),f.scrollTop=f.scrollHeight}}),t.ChangePageTitle("- Blockly -"),e.LoadBlocklyWorkSpace(),e.resizeBlockly()}]),angular.module("fusionApp").controller("editorCtrl",["$scope","$mdDialog","userFactory","editorFactory","appFactory","socketFactory","$window","Upload","$sce",function(e,t,o,n,a,r,i,s,l){function c(e,t,o,n,a,r,i){this.Selected=a,this.Name=e,this.Code=t,this.Filepath=n,this.NeedsSaving=o,this.FileType=r,this.PreventUnsavedExit=i}c.prototype.save=function(){var t=this,o=this.Name,a=this.FileType,r={code:this.Code};return new Promise(function(i,s){"example"==a?t.saveAs().then(function(){i()}):"new"==a?t.saveAs().then(function(){i()}):"existing"==a&&n.UpdateProgram(o,r).then(function(t){e.SelectedFile.NeedsSaving=!1,i()})})},c.prototype.saveAs=function(){var o=this,r=this.Name;this.FileType,this.Code;return new Promise(function(i,s){var l=t.prompt().title("What would you like to name your file?").ariaLabel("File Name").ok("Okay!").initialValue(r).cancel("Cancel");t.show(l).then(function(t){if(t){var r={filename:e.fixFileName(t),code:e.SelectedFile.Code};n.CreateProgram(r).then(function(t){500!=t.status?"new"==o.FileType?(o.Name=r.filename,o.Code=r.code,o.NeedsSaving=!1,o.FileType="existing",i(t)):e.OpenEditorFile(r.filename).then(function(){i(t)}):s()})}else a.showToast("Must specify file name","error")},function(){s()})})},e.SelectedProgrammingLanguage="python",e.WorkingFiles=o.User.workingEditorFiles,e.SelectedFile,e.NewFileCounter=1,e.outputConsole="",e.LoadWorkSpace=function(){0==e.WorkingFiles.length?e.CreateNewWorkspaceFile():e.LoadLastSelectedFile()},e.CreateNewWorkspaceFile=function(){n.GetPrograms().then(function(t){e.UnselectFiles();var n=e.GenerateNewFileName(t),a=new c(n,"import Fusion\n\nf = Fusion.driver()",!0,o.User.filepath+"/Editor/"+n,!0,"new",!1);e.WorkingFiles.push(a),e.LoadLastSelectedFile()})},e.GenerateNewFileName=function(t){var o="Untitled"+e.NewFileCounter+".py";e.NewFileCounter++;for(var n=!1,a=0;a<t.length;a++)if(t[a]==o){n=!0;break}return n&&(o=e.GenerateNewFileName(t)),o},e.LoadLastSelectedFile=function(){for(var t=0;t<e.WorkingFiles.length;t++)if(e.WorkingFiles[t].Selected){e.SelectedFile=e.WorkingFiles[t];break}},e.displaySaveSymbol=function(e){return e?"*":""},e.isSelectedFile=function(e){return e.Selected?"w3-blue":"w3-light-gray w3-border w3-hover-border-black"},e.UnselectFiles=function(){for(var t=0;t<e.WorkingFiles.length;t++)e.WorkingFiles[t].Selected=!1},e.SelectWorkingFile=function(t){e.SelectedFile!=t&&(e.UnselectFiles(),t.Selected=!0,e.SelectedFile=t)},e.OpenFileDialog=function(o){n.GetPrograms().then(function(o){e.FilesAvailableForOpen=o,t.show({contentElement:"#editorOpenFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})},e.OpenEditorFile=function(r){return t.hide(),new Promise(function(t,i){e.FileInWorkSpace(r)?(a.showToast("File Already Open.","error"),i()):n.GetProgram(r).then(function(n){e.UnselectFiles();var a=new c(n.filename,n.code,!1,o.User.filepath+"/Editor/"+n.filename,!0,"existing",!0);e.WorkingFiles.push(a),e.LoadLastSelectedFile(),t()})})},e.FileInWorkSpace=function(t){for(var o=!1,n=0;n<e.WorkingFiles.length;n++)if(e.WorkingFiles[n].Name==t){o=!0;break}return o},e.CloseFile=function(o){if(o.NeedsSaving&&o.PreventUnsavedExit){var n=t.confirm().title("Save before closing?").ok("Okay!").cancel("No");t.show(n).then(function(t){e.SaveSpecificFileDialog(o),e.ForceCloseFile(o)},function(){e.ForceCloseFile(o)})}else e.SelectedFile==o?(e.WorkingFiles.splice(e.WorkingFiles.indexOf(o),1),0==e.WorkingFiles.length?e.LoadWorkSpace():e.SelectWorkingFile(e.WorkingFiles[0])):e.WorkingFiles.splice(e.WorkingFiles.indexOf(o),1)},e.ForceCloseFile=function(t){e.SelectedFile==t?(e.WorkingFiles.splice(e.WorkingFiles.indexOf(t),1),0==e.WorkingFiles.length?e.LoadWorkSpace():e.SelectWorkingFile(e.WorkingFiles[0])):e.WorkingFiles.splice(e.WorkingFiles.indexOf(t),1)},e.SaveFileDialog=function(){e.SelectedFile.save()},e.SaveSpecificFileDialog=function(t){n.GetPrograms().then(function(o){for(var a=!1,r=0;r<o.length;r++)if(o[r]==t.Name){a=!0;break}if(a){i={code:t.Code};n.UpdateProgram(t.Name,i).then(function(e){t.NeedsSaving=!1})}else{var i={filename:e.fixFileName(t.Name),code:t.Code};n.CreateProgram(i).then(function(e){t.NeedsSaving=!1})}})},e.SaveAllDialog=function(){n.GetPrograms().then(function(t){for(var o=0;o<e.WorkingFiles.length;o++)e.WorkingFiles[o].NeedsSaving&&e.SaveSpecificFileDialog(e.WorkingFiles[o])})},e.SaveAsDialog=function(t){e.SelectedFile.saveAs()},e.DeleteDialog=function(o){var a=t.confirm().title("Are you sure you want to delete this file?").targetEvent(o).ok("Okay!").cancel("Cancel");t.show(a).then(function(t){n.DeleteProgram(e.SelectedFile.Name).then(function(t){e.ForceCloseFile(e.SelectedFile)},function(e){})},function(){})},e.fixFileName=function(e){return".py"!=e.substr(e.length-3)?e+".py":e},e.PrintDialog=function(){var t=i.open("","PRINT","height=400,width=600");t.document.write("<html><head><title>"+e.SelectedFile.Name+"</title>"),t.document.write("</head><body >"),t.document.write("<h1>"+e.SelectedFile.Name+"</h1>"),t.document.write("<pre>"+e.SelectedFile.Code+"</pre>"),t.document.write("</body></html>"),t.document.close(),t.focus(),t.print()},e.UploadFilesDialog=function(){t.show({contentElement:"#editorUploadFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})},e.$watch("files",function(){e.upload(e.files)}),e.$watch("file",function(){null!=e.file&&(e.files=[e.file])}),e.log="",e.upload=function(t){if(t&&t.length)for(var o=0;o<t.length;o++){var n=t[o];n.$error||s.upload({url:"/api/programs/import",method:"POST",file:n}).then(function(t){e.log="file: "+t.config.file.name+", Response: "+JSON.stringify(t.data)+"\n"+e.log},function(t){e.log="file: "+t.config.file.name+", Response: "+JSON.stringify(t.data)+"\n"+e.log})}},e.DownloadFilesDialog=function(){n.GetPrograms().then(function(o){e.FilesForDownload=[];for(var n=0;n<o.length;n++)e.FilesForDownload.push({Name:o[n],Selected:!1});t.show({contentElement:"#editorDownloadFileDialog",parent:angular.element(document.body),clickOutsideToClose:!0})})},e.DownloadEditorFiles=function(){for(var o=0;o<e.FilesForDownload.length;o++)e.FilesForDownload[o].Selected&&e.DownloadSingleEditorFile(e.FilesForDownload[o].Name);t.hide()},e.DownloadSingleEditorFile=function(e){n.GetProgram(e).then(function(t){var o=document.createElement("a");o.style.display="none",o.style.backgroundColor="red",o.href="data:attachment/text,"+encodeURI(t.code),o.target="_blank",o.download=e,o.click()})},e.hideDialog=function(){t.hide()},e.StopRunningEditorFile=function(){n.StopProgram()},e.RunExistingEditorFile=function(){e.outputConsole="","example"!=e.SelectedFile.FileType?e.SelectedFile.NeedsSaving?e.SelectedFile.save().then(function(){n.StartProgram(e.SelectedFile.Name)}):n.StartProgram(e.SelectedFile.Name):e.SelectedFile.NeedsSaving?(e.SelectedFile.NeedsSaving=!1,e.SelectedFile.save()):n.RunExample(e.SelectedFile.Filepath)},e.confirmExit=function(){for(var t=!1,o=0;o<e.WorkingFiles.length;o++)if(e.WorkingFiles[o].NeedsSaving&&e.WorkingFiles[o].PreventUnsavedExit){t=!0;break}return t?"You have attempted to leave this app with unsaved changes. Are you sure you want to exit this page?":void 0},e.takeToEditorDocs=function(){i.open("assets/docs/fusion/Editor_Topic/","_blank")},e.openExampleProgram=function(t,o){var a={filepath:o};n.GetExampleCode(a).then(function(n){var a=new c(t,n.code,!1,o,!0,"example",!1);e.UnselectFiles(),e.WorkingFiles.push(a),e.LoadLastSelectedFile()})},e.aceLoaded=function(e){var t=e.getSession();e.renderer;e.setHighlightActiveLine(!0),e.setShowPrintMargin(!1),t.setUndoManager(new ace.UndoManager),e.$blockScrolling=1/0},e.aceChanged=function(){},e.$watch("WorkingFiles",function(e,t){if(e.length==t.length)for(var o=0;o<e.length;o++)if(e[o].Code!=t[o].Code){e[o].NeedsSaving=!0,0==e[o].PreventUnsavedExit&&(e[o].PreventUnsavedExit=!0);break}},!0);var u=document.getElementById("output-console");r.Socket.on("console-output",function(t){if((o=t.output).includes("> Program Finished!")){o=t.output;e.outputConsole+=o,e.$apply()}else{var o=t.output;e.outputConsole=e.outputConsole.slice(-(500-o.length))+o,e.$apply(),u.scrollTop=u.scrollHeight}}),a.ChangePageTitle("- Editor -"),e.LoadWorkSpace()}]),angular.module("fusionApp").controller("vncCtrl",["$scope","appFactory",function(e,t){t.ChangePageTitle("- VNC -")}]),angular.module("fusionApp").controller("settingsCtrl",["$scope","appFactory","socketFactory","userFactory","$mdDialog","settingsFactory","$state",function(e,t,o,n,a,r,i){e.DisableWirelessSettingChange=!0,e.ShowPasswordToConnect=!1,e.wirelessSettings={},e.newUser,e.editData,e.languages=n.languages,e.userGroups=n.userGroups,e.securityQuestions=n.securityQuestions,e.fusionUserList,e.availableWifiConnections=[],e.allowUpdate=function(){return!o.data.UpdateAvailable||!o.data.InternetAccess},e.allowRestore=function(){return!0},e.changeWifiSettings=function(){var t=e.wirelessSettings.SSID,o=e.wirelessSettings.Password;if(o.length<8)a.show(a.alert().clickOutsideToClose(!0).title("Error").content("Password must be atleast 8 characters").ariaLabel("Alert Dialog Demo").ok("Ok!"));else{a.show(a.alert().clickOutsideToClose(!0).title("Alert").content("Remember to connect to the new network to continue using this interface.").ariaLabel("Alert Dialog Demo").ok("Ok!"));var n={ssid:t,password:o};r.SetWifiSettings(n).then(function(){r.GetWifiSettings().then(function(t){e.wirelessSettings.SSID=t.SSID,e.wirelessSettings.Password=t.Password,e.DisableWirelessSettingChange=!0})})}},e.restoreWifiSettings=function(){a.show(a.alert().clickOutsideToClose(!0).title("Alert").content("Remember to connect to the new network to continue using this interface.").ariaLabel("Alert Dialog Demo").ok("Ok!"));r.SetWifiSettings({ssid:null,password:null}).then(function(){r.GetWifiSettings().then(function(t){e.wirelessSettings.SSID=t.SSID,e.wirelessSettings.Password=t.Password,e.DisableWirelessSettingChange=!0})})},e.wirelessSettingChange=function(){e.DisableWirelessSettingChange=!1},e.refreshUserGrid=function(){n.GetAll().then(function(t){e.fusionUserList=t})},e.refreshWirelessSettings=function(){r.GetWifiSettings().then(function(t){e.wirelessSettings.SSID=t.SSID,e.wirelessSettings.Password=t.Password})},e.refreshWirelessConnections=function(){r.GetWirelessConnections().then(function(t){e.availableWifiConnections=t})},e.connectToNetwork=function(t){if("open"!=t.security)e.SelectedWirelessConnectionSSID=t.ssid,a.show({contentElement:"#settingsConnectNetworkDialog",parent:angular.element(document.body),clickOutsideToClose:!0});else{var o={ssid:t.ssid,password:null};r.SetWirelessConnection(o)}},e.connectToNetworkPassword=function(){var t={ssid:e.SelectedWirelessConnectionSSID,password:e.SelectedWirelessConnectionPassword};e.closeDialog(),r.SetWirelessConnection(t).then(function(t){e.SelectedWirelessConnectionSSID=null,e.SelectedWirelessConnectionPassword=null})},e.togglePasswordShowing=function(){e.ShowPasswordToConnect=!e.ShowPasswordToConnect;var t=$("#selectedWirelessConnectionPasswordInput")[0];e.ShowPasswordToConnect?t.type="text":t.type="password"},e.closeDialog=function(){a.hide()},e.disableField=function(){return!0},e.readyForEdit=function(t){n.Get(t).then(function(t){e.editData=t})},e.createUser=function(){if(e.newUser)if(e.newUser.UserName)if(e.newUser.Password)if(e.newUser.Password!=e.newUser.Password2)t.showToast("Passwords do not match","error");else if(e.newUser.UserGroup)if(e.newUser.SecurityQuestion)if(e.newUser.SecurityAnswer){var o={username:e.newUser.UserName,password:e.newUser.Password,usergroup:e.newUser.UserGroup,securityquestion:e.newUser.SecurityQuestion,securityanswer:e.newUser.SecurityAnswer};e.newUser.Email&&(o.email=e.newUser.Email),e.newUser.FirstName&&(o.firstname=e.newUser.FirstName),e.newUser.LastName&&(o.lastname=e.newUser.LastName),e.newUser.Language&&(o.language=e.newUser.Language),r.CreateUser(o).then(function(t){if(t){var o={UserName:t.UserName,Password:t.Password,UserGroup:t.UserGroup,SecurityQuestion:t.SecurityQuestion,SecurityAnswer:t.SecurityAnswer};e.newUser=o,t.email&&(e.newUser.Email=t.Email),t.firstname&&(e.newUser.FirstName=t.FirstName),t.lastname&&(e.newUser.LastName=t.LastName),t.language&&(e.newUser.Language=t.Language)}else e.newUser=null;e.refreshUserGrid()})}else t.showToast("Must fill Security Answer","error");else t.showToast("Must fill Security Question","error");else t.showToast("Must fill User Group","error");else t.showToast("Must fill Passord","error");else t.showToast("Must fill Username","error");else t.showToast("Must fill in new user data","error")},e.userEdit=function(){var o={};e.NewPassword1!=e.NewPassword2?t.showToast("Passwords do not match","error"):(e.editData.username&&(o.username=e.editData.username),e.editData.email&&(o.email=e.editData.email),e.editData.firstname&&(o.firstname=e.editData.firstname),e.editData.lastname&&(o.lastname=e.editData.lastname),e.editData.language&&(o.language=e.editData.language),e.editData.usergroup&&(o.usergroup=e.editData.usergroup),e.NewPassword1&&(o.password=e.NewPassword1),e.NewSecurityQuestion&&(o.securityquestion=e.NewSecurityQuestion),e.NewSecurityAnswer&&(o.securityanswer=e.NewSecurityAnswer),n.Update(e.editData.username,o).then(function(t){e.NewPassword1=null,e.NewPassword2=null,e.NewSecurityQuestion=null,e.NewSecurityAnswer=null,$("#editUserModal").modal("hide"),e.refreshUserGrid()}))},e.userDelete=function(t,o){var s=a.confirm().title("Are you sure you want to delete: "+o+" ?").targetEvent(t).ok("Okay!").clickOutsideToClose(!0).cancel("Cancel");a.show(s).then(function(t){r.DeleteUser(o).then(function(t){n.User.username==o?i.go("login"):e.refreshUserGrid()})},function(){})},e.updateFusion=function(){t.updateFusion().then(function(e){})},e.restoreFusion=function(){t.restoreFusion().then(function(e){})},e.fixWirelessLinks=function(e){var t=e.ssid.replace(/ /g,"_");return t=t.replace(/,/g,"_"),t=t.replace(/\./g,"_")},e.styleUsedConnection=function(e){return"w3-green"},e.styleOpenConnection=function(e){return"open"!=e.security?"fa-key":"fa-unlock"},t.ChangePageTitle("- Settings -"),e.refreshWirelessSettings(),e.refreshWirelessConnections(),e.refreshUserGrid(),o.Socket.on("update-output",function(t){var o=document.getElementById("update-console");if((n=t.output).includes("Update Finished!")){n=t.output;e.updateConsole+=n,e.$apply()}else{var n=t.output;e.updateConsole+=n,e.$apply(),o.scrollTop=o.scrollHeight}})}]);